{
  "module": "Prix Six Application",
  "generated": "2026-01-31",
  "total_guids": 1030,
  "guids": [
    {
      "guid": "ADMIN_ATTACK_MONITOR-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin security component that displays unacknowledged attack alerts (bot attacks, credential stuffing, distributed attacks) with severity-coded UI and acknowledgement controls.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for an attack alert document from the attack_alerts Firestore collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Human-readable labels for attack type codes, used in alert card headings.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Descriptive text for each attack type, shown as secondary detail in alert cards.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx",
        "functionName": "AttackMonitor"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main exported component that queries unacknowledged attack alerts and renders a severity-coded summary bar with expandable detail cards.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx",
        "functionName": "AttackMonitor"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore query for unacknowledged attack alerts, gated on admin status to prevent permission errors.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Acknowledges a single attack alert by updating its Firestore document with acknowledged=true, the admin's user ID, and a timestamp.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx",
        "functionName": "handleAcknowledge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Acknowledges all currently visible attack alerts in parallel using Promise.all.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx",
        "functionName": "handleAcknowledgeAll"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Splits alerts into critical and warning groups to drive severity-based UI styling (pulsing red vs amber).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ATTACK_MONITOR-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders a single attack alert card with severity-coded styling, attack details (IP, target, attempts), and an acknowledge button.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AttackMonitor.tsx",
        "functionName": "AttackAlertCard"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDIT-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for toggling the global audit logging system on or off via admin_configuration/global Firestore document.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDIT-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for the audit settings shape stored in admin_configuration/global.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditManager.tsx",
        "functionName": "getAuditSettings"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDIT-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Reads the current audit settings from the admin_configuration/global Firestore document, defaulting to disabled.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditManager.tsx",
        "functionName": "getAuditSettings"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDIT-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Writes updated audit settings to the admin_configuration/global Firestore document using merge to preserve other fields.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditManager.tsx",
        "functionName": "updateAuditSettings"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDIT-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main exported component providing a toggle switch and save button for enabling/disabling global audit logging.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditManager.tsx",
        "functionName": "AuditManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDIT-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Loads the current audit settings from Firestore on component mount.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDIT-006",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Persists the current audit logging toggle state to Firestore and shows a success/failure toast.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditManager.tsx",
        "functionName": "handleSave"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDIT-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Updates the local settings state when the toggle switch is changed, without persisting until save.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditManager.tsx",
        "functionName": "handleToggle"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDITLOG-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for viewing the system audit log of user activity and system events.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDITLOG-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for an audit log document from the audit_logs Firestore collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDITLOG-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Props interface for AuditLogViewer, accepting pre-fetched user data to resolve user IDs to display names.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditLogViewer.tsx",
        "functionName": "AuditLogViewer"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDITLOG-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main exported component that displays the last 100 audit log entries with user resolution, action badges, and expandable details.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditLogViewer.tsx",
        "functionName": "AuditLogViewer"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDITLOG-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore query that fetches the 100 most recent audit logs ordered by timestamp descending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDITLOG-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Maps audit log action types to Badge variants for consistent visual styling.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditLogViewer.tsx",
        "functionName": "getActionVariant"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_AUDITLOG-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Resolves a userId to a User object from the pre-fetched allUsers list for display name lookup.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/AuditLogViewer.tsx",
        "functionName": "findUser"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for running data integrity checks across all Firestore collections and displaying results. Validates users, drivers, races, predictions, team coverage, race results, scores, standings, and leagues.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for the component props: receives the preloaded allUsers array and loading flag from the parent admin page.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type alias for the sequential check phases, used to track progress through the validation pipeline.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Human-readable labels for each check phase, displayed above the progress bar during a check run.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Progress percentage for each check phase, used to fill the progress bar proportionally.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-005",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Render a small status icon (green check, yellow warning, red X) based on a check result status.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx",
        "functionName": "getStatusIcon"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-006",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Render a coloured Badge (Pass/Warning/Error) based on a check result status.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx",
        "functionName": "getStatusBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-007",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Render a coloured Badge (Warning/Error) based on an individual issue severity level.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx",
        "functionName": "getSeverityBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-008",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main Consistency Checker component. Orchestrates on-demand data fetching, sequential validation checks across 9 categories, progress display, summary table, score type breakdown, issue details, and export to error_logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx",
        "functionName": "ConsistencyChecker"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Execute the full consistency check pipeline: users, drivers, races, predictions, team coverage, race results, scores, standings, and leagues. Fetches Firestore data on-demand per phase to minimise memory usage.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Export all detected issues to the error_logs Firestore collection with a correlation ID for tracking.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_CONSISTENCY-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Derived count of total issues across all check categories, used to control UI visibility of the Issues Detail card and Export button.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ConsistencyChecker.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for managing the email queue (push, resend, delete) and viewing historical email send logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for a historical email log document from the email_logs Firestore collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for a queued email document from the email_queue collection, including retry state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main exported component providing email queue management (push/resend/delete) and historical email log viewing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "EmailLogManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches all queued emails (including failed) from the /api/email-queue endpoint.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Triggers the initial fetch of queued emails when the admin user is confirmed.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "handlePushEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Sends a single queued email immediately via the /api/email-queue push action.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "handlePushEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-007",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Re-queues a single failed email for another round of retry attempts.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "handleResendEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Deletes a single queued email from the queue, discarding it permanently.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "handleDeleteEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Pushes all pending queued emails for immediate sending in a single batch operation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "handlePushAll"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-010",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Re-queues all failed emails for another round of retry attempts in a single batch operation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "handleResendAllFailed"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Deletes all emails from the queue, clearing it entirely.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "handleDeleteAll"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore query for historical email send logs ordered by timestamp descending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-013",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Maps an email log status to a Badge variant for consistent visual status representation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "getStatusVariant"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-014",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Renders a status badge for a queued email, showing failed state, retry count, or pending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx",
        "functionName": "getQueueStatusBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_EMAILLOG-015",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Computes counts of pending and failed emails for display in the header and button labels.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/EmailLogManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for viewing, searching, filtering, and resolving system error logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for an error log document from the error_logs Firestore collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Maps PX error code prefixes to display colours and labels for visual categorisation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Configuration arrays for the two rows of filter tabs: category filters and view mode filters.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Extracts the PX category prefix from an error code string, falling back to PX-9 (Unknown).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "getErrorCategory"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Small utility component that copies text to the clipboard with visual feedback.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "CopyButton"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-006",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main exported component that provides a full error log viewing interface with filtering, searching, grouping, and resolution tracking.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "ErrorLogViewer"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore query that fetches the 500 most recent error logs ordered by timestamp descending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Applies category, search term, time-based, and resolution status filters to the raw error logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Extracts the error code from a log, checking multiple possible locations in the log structure.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "getLogErrorCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Groups filtered logs by their error code for the \"Grouped\" view mode.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Computes aggregate statistics (total count and per-category counts) across all unfiltered error logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Toggles the expanded/collapsed state of a group in the grouped view.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "toggleGroup"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-013",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders a single error log entry with expandable details, copy-able correlation ID, stack trace, context, and a \"Mark as Resolved\" action.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "ErrorLogItem"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-014",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Marks an error log as resolved by updating the Firestore document with resolved=true and a timestamp.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "handleMarkResolved"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-015",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Safely extracts a Date object from the log's timestamp, handling both Firestore seconds and ISO string formats.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "getTimestamp"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ERRORLOG-016",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Safely serialises the error log's context object to a JSON string for display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ErrorLogViewer.tsx",
        "functionName": "contextString"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for reviewing and managing user-submitted bug reports and feature requests, with filtering, status updates, and deletion.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-001",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Type definition for a feedback item document in the Firestore feedback collection. Includes optional referenceId field (BG-001/FB-001).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Maps feedback status values to Tailwind CSS colour classes for badge styling.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main FeedbackManager component providing a filterable, expandable list of feedback items with status management and deletion.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx",
        "functionName": "FeedbackManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Local state for feedback items, loading flag, and filter selections (type and status).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Sets up a real-time Firestore listener on the feedback collection, ordered by creation date descending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Updates a feedback item's status in Firestore. When resolving, stamps the current app version and resolution timestamp.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx",
        "functionName": "updateStatus"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Permanently deletes a feedback item from the Firestore feedback collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx",
        "functionName": "deleteFeedback"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Formats a Firestore Timestamp into a human-readable UK-locale date string with time.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx",
        "functionName": "formatDate"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Filters the feedback array by the currently selected type and status filters.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-010",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Computes summary statistics (bug count, feature count, new count) for the stats cards display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders a loading skeleton while feedback data is being fetched from Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_FEEDBACK-012",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Renders the complete Feedback Manager UI: stats cards, type/status filter buttons, and an expandable accordion list of feedback items with reference ID badges.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/FeedbackManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for managing the Hot News feed: toggle AI updates, manually edit content, refresh via AI, and optionally email subscribers.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main HotNewsManager component providing AI toggle, content editor, refresh button, and email dispatch controls.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx",
        "functionName": "HotNewsManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-002",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Local state managing the hot news settings, loading/error states, form fields, and operation flags.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches the current hot news settings from Firestore on component mount and populates local state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx",
        "functionName": "fetchSettings"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Saves manual content edits and the AI toggle to Firestore, logs an audit event, and optionally sends emails to all subscribers.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx",
        "functionName": "handleSave"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Conditionally sends hot news content via email to all subscribed users after a successful save.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-006",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Triggers the AI-powered hot news generation flow, updates the textarea content, and persists the result to Firestore. Detects stale Server Action hash (post-deployment cache mismatch) and prompts user to refresh.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx",
        "functionName": "handleRefresh"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders a loading skeleton while hot news settings are being fetched from Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders an error alert when the initial settings fetch fails, blocking access to the editor.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_HOT_NEWS-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders the full Hot News management UI: AI toggle, content textarea, email checkbox, save and refresh buttons.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/HotNewsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for viewing all leagues, their owners, member counts, invite codes, and expandable member lists.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Defines the props contract for LeaguesManager, requiring the full user list and its loading state for team name resolution.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx",
        "functionName": "LeaguesManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main LeaguesManager component rendering a table of all leagues with expandable member details and invite code copy functionality.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx",
        "functionName": "LeaguesManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore query for the entire leagues collection, used by the useCollection hook.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Creates a Map from user ID to team name for efficient lookup when resolving league member and owner names.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx",
        "functionName": "resolveTeamName"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Resolves a user ID to a human-readable team name, with special handling for the system owner.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx",
        "functionName": "resolveTeamName"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Copies a league's invite code to the system clipboard and shows a confirmation toast.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx",
        "functionName": "handleCopyInviteCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Toggles the expanded/collapsed state for a league row to show or hide member details.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx",
        "functionName": "toggleExpand"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_LEAGUES-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders the leagues table with columns for name, owner, member count, invite code, and an expand/collapse control.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/LeaguesManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for monitoring online user sessions and managing Single User Mode (purge all sessions, restrict access to one admin).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Defines the session timeout window; sessions inactive beyond this threshold are considered expired.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for a Firestore presence document, tracking a user's online status and session GUIDs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Defines the props contract for OnlineUsersManager, requiring the full user list and its loading state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for Single User Mode configuration stored in admin_configuration/global.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx",
        "functionName": "logErrorToFirestore"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fire-and-forget helper to log errors to the error_logs Firestore collection with full context.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx",
        "functionName": "logErrorToFirestore"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main OnlineUsersManager component displaying active sessions in a table and providing Single User Mode controls.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx",
        "functionName": "OnlineUsersManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches the current Single User Mode configuration from admin_configuration/global on component mount.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx",
        "functionName": "fetchSingleUserMode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Activates Single User Mode: purges all presence sessions except the current admin's, then sets the flag in admin_configuration.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx",
        "functionName": "activateSingleUserMode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Deactivates Single User Mode: clears the flag in admin_configuration/global so all users can connect normally.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx",
        "functionName": "deactivateSingleUserMode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore query for the entire presence collection, used by the useCollection hook.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Derives the list of users with active sessions by joining presence data with user details, filtering by session timeout.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-012",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Computes the total count of active sessions across all users, only counting sessions within the timeout window.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-013",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Resolves the team name of the admin who activated Single User Mode for display in the warning banner.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_ONLINE_USERS-014",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders the complete Online Users UI: session table, Single User Mode controls, and status banner.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/OnlineUsersManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for entering official F1 race results and managing existing results. Provides a two-step wizard: race selection then driver picker for top-6 positions.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-001",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Normalize a raceId string by stripping GP/Sprint suffixes and replacing spaces with hyphens for consistent matching against prediction raceId format.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "getDriverCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Convert a driver ID (e.g., \"hamilton\") to a 3-letter display code (e.g., \"HAM\") by looking up the driver in F1Drivers static data.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "getDriverCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for a race result document stored in the race_results Firestore collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Type alias for the two-step wizard flow: race selection then result entry.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "ResultsManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main admin component for entering and managing official F1 race results via a two-step wizard (select race, then pick top-6 drivers).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "ResultsManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "State management for the two-step wizard flow, driver selections, submission status, and deletion tracking.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch the count of unique team predictions when a race is selected, to show how many teams will be scored. Counts ALL predictions (carry-forward model).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "fetchSubmissionCount"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore query for fetching all existing race results, ordered by submission date descending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Derived list of F1 drivers not yet placed in any of the 6 result positions, available for selection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleAddDriver"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Add a driver to the first empty position slot in the predictions array.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleAddDriver"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Remove a driver from a specific position slot, making them available again.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleRemoveDriver"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Swap a driver with the adjacent position (up or down) to reorder the result.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleMove"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Transition from step 1 (race selection) to step 2 (driver entry) after validating a race is selected.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleProceedToResults"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-014",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Navigate back to step 1 (race selection) and reset the driver selections.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleBack"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-015",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate all 6 positions are filled and open the confirmation dialog before submitting results.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleSubmitClick"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-016",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a compact text summary of the result (e.g., \"1-HAM, 2-VER, 3-NOR, ...\") for the confirmation dialog.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "getResultSummary"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-017",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Submit the confirmed race results to the server-side /api/calculate-scores endpoint for secure score calculation, then trigger email notifications via /api/send-results-email.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleConfirmedSubmit"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-018",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Delete a race result and its associated scores via the server-side /api/delete-scores endpoint.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "handleDelete"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_RESULTS-019",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Format a Firestore Timestamp or Date to a human-readable en-GB string (DD Mon YYYY, HH:MM).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ResultsManager.tsx",
        "functionName": "formatTimestamp"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SCORING-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Read-only admin component displaying the fixed scoring rules for the Prix Six fantasy league, sourced from SCORING_POINTS and SCORING_DERIVED constants.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ScoringManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SCORING-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main ScoringManager component rendering a card that explains each scoring tier and the maximum possible score.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/ScoringManager.tsx",
        "functionName": "ScoringManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SITE_FUNCTIONS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for toggling global site functions: user login and new user sign-up. Reads and writes admin_configuration/global in Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/SiteFunctionsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SITE_FUNCTIONS-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for the global site settings stored in admin_configuration/global.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/SiteFunctionsManager.tsx",
        "functionName": "SiteFunctionsManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SITE_FUNCTIONS-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main SiteFunctionsManager component providing toggle switches for global site features with save persistence.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/SiteFunctionsManager.tsx",
        "functionName": "SiteFunctionsManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SITE_FUNCTIONS-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches the current global site settings from Firestore on component mount.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/SiteFunctionsManager.tsx",
        "functionName": "fetchSettings"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SITE_FUNCTIONS-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Persists the current toggle states to Firestore and logs an audit event for the change.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/SiteFunctionsManager.tsx",
        "functionName": "handleSave"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SITE_FUNCTIONS-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders a loading skeleton while settings are being fetched from Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/SiteFunctionsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_SITE_FUNCTIONS-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders the site functions card with toggle switches for login and sign-up, plus a save button.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/SiteFunctionsManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_STANDING_DATA-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Read-only admin component displaying standing data: F1 drivers grouped by team and the full race calendar schedule.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/StandingDataManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_STANDING_DATA-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Groups the flat F1Drivers array into a lookup keyed by team name for team-based rendering.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/StandingDataManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_STANDING_DATA-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Maps F1 constructor names to Tailwind CSS background colour classes for visual team badges.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/StandingDataManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_STANDING_DATA-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main StandingDataManager component rendering two cards: F1 Drivers by team and the Race Calendar table.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/StandingDataManager.tsx",
        "functionName": "StandingDataManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_STANDING_DATA-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Formats an ISO date string into a human-readable UK-locale date (e.g., \"Sat, 15 Mar 2026\").",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/StandingDataManager.tsx",
        "functionName": "formatDate"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_STANDING_DATA-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Formats an ISO date string into a human-readable UK-locale time with timezone (e.g., \"14:00 GMT\").",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/StandingDataManager.tsx",
        "functionName": "formatTime"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_STANDING_DATA-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Determines if a race has already occurred by comparing its time to the current date.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/StandingDataManager.tsx",
        "functionName": "isPastRace"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_STANDING_DATA-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders the complete standing data view: driver cards grouped by team and a race calendar table.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/StandingDataManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for managing user teams: view, edit, delete, toggle admin status, and unlock locked accounts.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Defines the props contract for TeamManager, requiring the full user list and its loading state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx",
        "functionName": "TeamManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main TeamManager component that renders a table of all users with edit, admin toggle, and delete actions.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx",
        "functionName": "TeamManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Local state for the edit dialog: tracks which user is selected and what editable fields contain.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Opens the edit dialog and pre-populates form fields with the selected user's current data.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx",
        "functionName": "handleEditClick"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Persists edited user fields (teamName, email, isAdmin) to Firestore and closes the dialog.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx",
        "functionName": "handleSaveChanges"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Toggles a user's admin status between admin and regular user.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx",
        "functionName": "handleToggleAdmin"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Permanently deletes a user and all their data from the system.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx",
        "functionName": "handleDeleteUser"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Resets a locked user's badLoginAttempts counter to zero, unlocking their account.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx",
        "functionName": "handleUnlockUser"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_TEAM-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders the team management UI: a table of users with action buttons and an edit dialog.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/TeamManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin component for managing WhatsApp integration: worker status monitoring, alert configuration, custom message sending, message queue viewing, and alert history.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-001",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Dynamically import QRCode component to avoid SSR issues; includes fallback UI on load failure.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Constants for the WhatsApp proxy API endpoint and message length limit.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for the WhatsApp worker status response, including connection state, groups, and keep-alive health.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for entries in the whatsapp_status_log Firestore collection, tracking connection state changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for messages in the whatsapp_queue Firestore collection, representing messages to be sent by the worker.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Static configuration defining all alert categories and their individual alert types for the Alert Control Panel UI.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main admin component for WhatsApp integration management. Provides worker status monitoring, QR code authentication, alert settings configuration, custom message sending, message queue display, and alert history.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx",
        "functionName": "WhatsAppManager"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "State management for all component concerns: worker status, alert settings, message form, queue, history, status log, and QR code lifecycle.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Retrieve Firebase auth token for authenticated API requests to the WhatsApp proxy.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-010",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Fetch QR code string from the WhatsApp worker via the proxy API for display in the QR scanner UI.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch current worker status (connection, groups, keep-alive) from the WhatsApp proxy API. Auto-selects first matching group.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch WhatsApp alert settings from Firestore and populate local editing state with saved values.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Poll worker status on mount and every 30 seconds to keep the status card up to date.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-014",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Auto-refresh the QR code every 30 seconds while the worker is awaiting QR scan and a QR code is displayed.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-015",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Track QR code age in seconds to display freshness warnings and auto-expire visual feedback.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-016",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch alert settings from Firestore on component mount.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-017",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Real-time Firestore listener for the last 10 messages in whatsapp_queue, ordered by creation time descending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-018",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Real-time Firestore listener for the last 50 entries in whatsapp_alert_history, ordered by creation time descending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-019",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Real-time Firestore listener for the last 25 entries in whatsapp_status_log, ordered by timestamp descending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-020",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Persist alert settings (master switch, test mode, target group, alert toggles) to Firestore and log the change in audit trail.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx",
        "functionName": "handleSaveSettings"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-021",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Queue a custom message for delivery to a WhatsApp group via the worker. Adds to whatsapp_queue and whatsapp_alert_history, and logs an audit event.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx",
        "functionName": "handleSend"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-022",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Toggle an individual alert type on or off in the local editing state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx",
        "functionName": "handleToggleAlert"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-023",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Render a coloured Badge component based on message queue status (PENDING, PROCESSING, SENT, FAILED).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx",
        "functionName": "getStatusBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-024",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Format a Firestore Timestamp to a human-readable en-GB date/time string (DD/MM HH:MM).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx",
        "functionName": "formatTime"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "ADMIN_WHATSAPP-025",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Derived boolean that compares local editing state against last-saved settings to detect unsaved changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/WhatsAppManager.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route that allows an authenticated user to create a secondary team for the fantasy league. Enforces uniqueness, applies late-joiner handicap if the season has started, and registers the team in the global league.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Defines the shape of the incoming secondary team creation request, containing only the desired team name.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main POST handler that authenticates the user, validates the team name, checks for duplicates, creates the secondary team record, registers it in the global league, applies a late-joiner handicap if applicable, and logs audit events.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Authenticates the request by extracting and verifying the Firebase Auth bearer token from the Authorization header.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Parses the request body and validates that the team name meets the minimum length requirement (3 characters).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts",
        "functionName": "data"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Checks that the user exists and does not already have a secondary team. Prevents duplicate secondary team creation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Case-insensitive uniqueness check across all existing primary and secondary team names to prevent duplicate team names in the league.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Writes the secondary team name to the user document and adds the secondary team ID to the global league's member list.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Late-joiner handicap: if the season has already started (scores exist), the new secondary team starts 5 points behind the last-place team. This prevents new teams from having an unfair advantage by joining with zero points mid-season.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Logs the successful secondary team creation in the audit trail and returns a success response with the new team name and ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADD_SECONDARY_TEAM-010",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler that catches any unhandled exception during secondary team creation, logs it with a correlation ID, and returns a 500 response with the correlation ID for user-reportable error tracing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/add-secondary-team/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin API route for deleting a user account \u00e2\u20ac\u201d coordinates removal from Firebase Auth, Firestore users/presence collections, and league memberships with full audit logging.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod schema for validating delete request \u00e2\u20ac\u201d ensures both userId and adminUid are present and non-empty.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "POST handler that orchestrates user deletion: validates input, checks admin permissions, prevents self-deletion, removes Auth + Firestore records, cleans up league memberships, and logs audit events.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Early return on Zod validation failure \u00e2\u20ac\u201d provides field-level errors to the caller.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Verify the requesting user has admin privileges before allowing deletion.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Safety guard \u00e2\u20ac\u201d prevent admins from accidentally deleting their own account.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Capture user data before deletion for inclusion in the audit log.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Delete user from Firebase Auth. If user is already missing from Auth (orphaned Firestore record), proceed with Firestore cleanup only.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-008",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Delete Firestore user and presence documents in a batch. Logs a critical error if Auth was already deleted but Firestore cleanup fails (split-brain state).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-009",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Remove the deleted user's ID from all league memberUserIds arrays. Best-effort \u00e2\u20ac\u201d failure is logged but does not block the response.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Write an audit log entry recording who deleted whom and the deleted user's details.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_DELETE_USER-011",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler \u00e2\u20ac\u201d catches any unhandled exceptions, logs to error_logs, and returns a safe 500 response with correlation ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/delete-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-000",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "Admin API route for fetching F1 timing data from the OpenF1 API and storing it in Firestore. Fetches session metadata, driver list, and lap times, computes best laps, and writes the result to app-settings/pub-chat-timing for the ThePaddockPubChat component. document to render live timing data.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-001",
      "version": 1,
      "logic_category": "VALIDATION",
      "description": "Zod schema for validating the fetch request \u2014 requires sessionKey and adminUid.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "fetchTimingRequestSchema"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-002",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Format a lap duration in seconds to \"M:SS.mmm\" display string.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "formatLapDuration"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-003",
      "version": 1,
      "logic_category": "IO",
      "description": "POST handler that orchestrates the OpenF1 fetch pipeline: validates input, checks admin permissions, fetches session/driver/lap data, computes best laps, and writes to Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-004",
      "version": 1,
      "logic_category": "IO",
      "description": "Verify the requesting user has admin privileges before allowing the fetch.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "adminDoc"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-005",
      "version": 1,
      "logic_category": "IO",
      "description": "Fetch session metadata from OpenF1 to populate the session header in the UI.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "sessionRes"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-006",
      "version": 1,
      "logic_category": "IO",
      "description": "Fetch the meeting metadata to get the meeting name, location, circuit, and country.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "meetingKey"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-007",
      "version": 1,
      "logic_category": "IO",
      "description": "Fetch all drivers who participated in the session.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "driversRes"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-008",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Deduplicate drivers by driver_number (OpenF1 may return duplicates).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "uniqueDrivers"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-009",
      "version": 1,
      "logic_category": "IO",
      "description": "Fetch lap data for each driver in parallel, compute best lap excluding pit-out laps.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "driverResults"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-010",
      "version": 1,
      "logic_category": "IO",
      "description": "Write the computed timing data to Firestore for ThePaddockPubChat to read.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts",
        "functionName": "timingData"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-011",
      "version": 1,
      "logic_category": "IO",
      "description": "Audit log the fetch operation for compliance and traceability.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_FETCH_TIMING_DATA-012",
      "version": 2,
      "logic_category": "ORCHESTRATION",
      "description": "Top-level error handler \u2014 catches any unhandled exceptions, logs to error_logs, and returns a safe 500 response with correlation ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/fetch-timing-data/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_OPENF1_SESSIONS-000",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Admin API route that proxies OpenF1 meetings and sessions endpoints for the PubChatPanel dropdown selectors. Avoids CORS issues and allows admin auth verification.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/openf1-sessions/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_OPENF1_SESSIONS-001",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "GET handler that proxies OpenF1 meetings (when ?year= is provided) or sessions (when ?meetingKey= is provided) to populate admin UI dropdowns.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/openf1-sessions/route.ts",
        "functionName": "GET"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_OPENF1_SESSIONS-002",
      "version": 1,
      "logic_category": "IO",
      "description": "Fetch meetings for a given year from OpenF1.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/openf1-sessions/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_OPENF1_SESSIONS-003",
      "version": 1,
      "logic_category": "IO",
      "description": "Fetch sessions for a given meeting from OpenF1.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/openf1-sessions/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_OPENF1_SESSIONS-004",
      "version": 2,
      "logic_category": "ORCHESTRATION",
      "description": "Top-level error handler \u2014 logs to error_logs and returns safe 500 response.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/openf1-sessions/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin API route for updating user profile fields (email, teamName, isAdmin, mustChangePin) with full validation, deduplication, and downstream propagation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod schema for strict request validation \u00e2\u20ac\u201d prevents mass assignment by only allowing known fields.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "POST handler that orchestrates admin user updates: validates input, checks admin permissions, deduplicates email/teamName, updates Auth + Firestore, propagates teamName to predictions, and logs audit events.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Early return on Zod validation failure \u00e2\u20ac\u201d provides detailed field-level errors to the caller.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Verify the requesting user has admin privileges before allowing any modifications.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Handle email change: normalise to lowercase, check for duplicates in both Firestore and Firebase Auth, then update Auth record.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Handle teamName change: check for case-insensitive duplicates across all users, capture old name for downstream propagation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Persist the validated changes to the Firestore users document with a server timestamp.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Propagate teamName changes to all of the user's prediction documents (Golden Rule #3: Single Source of Truth \u00e2\u20ac\u201d denormalised teamName must stay in sync).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Write a general audit log entry for every admin user update, regardless of which fields changed.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_ADMIN_UPDATE_USER-010",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler \u00e2\u20ac\u201d catches any unhandled exceptions, logs to error_logs, and returns a safe 500 response with correlation ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/admin/update-user/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "AI-powered race prediction analysis API route. Accepts a user's top-6 driver prediction and analysis weight configuration, builds a dynamic weighted prompt, calls Genkit/Gemini AI, and returns structured analysis text covering multiple F1 analysis facets and optional pundit personas.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for a single driver in the user's prediction \u00e2\u20ac\u201d position, driver code, full name, and constructor team.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for analysis weight sliders \u00e2\u20ac\u201d each facet (0-10) controls how much emphasis the AI gives to that analysis dimension. Includes two pundit personas (jackSparrow, rowanHornblower) with extended word budgets.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for the full analysis request payload \u00e2\u20ac\u201d race metadata, driver predictions, weight configuration, and pre-calculated total weight.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Constants defining word budgets per facet type \u00e2\u20ac\u201d standard facets get 50 words each, pundit personas get up to 250 words scaled by weight.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts",
        "functionName": "calculateWordBudgets"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Calculate per-facet word budgets based on weights. Standard facets get a fixed 50 words if active; pundit facets scale linearly from 0-250 words based on weight (0-10).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts",
        "functionName": "calculateWordBudgets"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Build the complete AI prompt dynamically based on race details, user predictions, and weight configuration. Includes facet descriptions with emphasis levels, word budgets, exclusion notes, and formatting rules (British English, headings, verdict).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts",
        "functionName": "buildWeightedPrompt"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-007",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "POST handler that validates weights, builds the prediction list and weighted prompt, calls Genkit AI (Gemini), and returns the analysis text. Includes dedicated error handling for AI generation failures separate from general errors.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-008",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Validate that the total weight across all facets does not exceed the maximum of 77. Prevents abuse and ensures balanced analysis.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-009",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Call Genkit AI (Gemini) with the weighted prompt and configured generation parameters. Dedicated try/catch provides specific AI error handling with detailed logging.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AI_ANALYSIS-010",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Top-level error handler \u00e2\u20ac\u201d catches any unhandled exceptions outside of the AI call (e.g., JSON parse, validation). Logs to error_logs and returns a safe 500 response with a fallback analysis message.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/ai/analysis/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-000",
      "version": 4,
      "logic_category": "IO",
      "description": "Server-side API route that completes the profile for new OAuth users. Mirrors the signup route but skips Firebase Auth user creation (OAuth already created it). Validates the user exists in Auth with an OAuth provider, creates Firestore documents, enrols in global league, applies late-joiner handicap, and sends welcome email. Updates the global league memberUserIds array. Triggers welcome email.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Type contract for the expected JSON body.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts",
        "functionName": "CompleteOAuthProfileRequest"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-002",
      "version": 3,
      "logic_category": "MUTATION",
      "description": "Main POST handler. Validates the OAuth user in Firebase Auth, checks team name uniqueness, creates Firestore user and presence documents, handles late-joiner handicap, global league enrolment, and welcome email. the client-side onAuthStateChanged picks up the new doc and sets user state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate required fields.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate team name length.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Verify the Firebase Auth user exists and has an OAuth provider.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Ensure no Firestore user doc exists yet (prevents double-creation).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts",
        "functionName": "existingDoc"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-007",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Check for duplicate team names (case-insensitive) across both primary and secondary team names.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts",
        "functionName": "allUsersSnapshot"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Check if signups are enabled.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-009",
      "version": 3,
      "logic_category": "MUTATION",
      "description": "Create the Firestore user document and presence document.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts",
        "functionName": "newUser"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Add the new user to the global league.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-011",
      "version": 3,
      "logic_category": "IO",
      "description": "Apply late-joiner handicap if the season has already started.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-012",
      "version": 3,
      "logic_category": "MUTATION",
      "description": "Send welcome email (fire-and-forget).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Log the successful OAuth registration.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_COMPLETE_OAUTH-014",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Top-level error handler for unhandled exceptions.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/complete-oauth-profile/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Server-side API route that authenticates users via email + 6-digit PIN, enforces account lockout after repeated failures, logs all attempts for attack detection, and returns a Firebase custom token on success.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Extract the real client IP address from incoming requests, accounting for various proxy/CDN header conventions.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts",
        "functionName": "getClientIP"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Define the brute-force protection thresholds: max allowed failed attempts and lockout window duration.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Type contract for the expected JSON body of the login request.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main login POST handler. Validates input, checks lockout status, verifies credentials via Firebase Auth REST API, tracks failed/successful attempts, and returns a custom token on success.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-005",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that both email and PIN are present before proceeding with authentication.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Look up the user document in Firestore by normalised email to check lockout status and track login attempts.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Enforce account lockout: if the user has exceeded MAX_LOGIN_ATTEMPTS within the LOCKOUT_DURATION_MS window, reject the login and log the blocked attempt. Also auto-reset the counter once the lockout window expires.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-008",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Look up the user in Firebase Auth by email to confirm the account exists in the auth system, separate from Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-009",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Verify the user's PIN (password) by calling the Firebase Auth REST API (Identity Toolkit signInWithPassword endpoint), since the Admin SDK does not support password verification directly.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-010",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Handle failed credential verification: increment the bad login attempts counter, log the failure for attack detection, write an audit record, and trigger lockout if the threshold is reached.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Handle successful authentication: generate a Firebase custom token, reset the bad login attempts counter, log the success for analytics and auditing, and return the token to the client.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-012",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level catch-all error handler for any unhandled exception during login. Logs the error with full context (excluding the PIN) and returns a generic 500 response with the correlation ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts",
        "functionName": "requestData"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_LOGIN-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Record a logon event in user_logons for session tracking after successful PIN authentication. Includes IP and user agent. Non-blocking \u00e2\u20ac\u201d login succeeds even if tracking fails.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/login/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      },
      "errorProfile": {
        "throws": [
          "PX-6004"
        ],
        "handles": [],
        "emits": {
          "PX-6004": {
            "key": "LOGON_RECORD_FAILED",
            "message": "Failed to record logon event",
            "severity": "warning",
            "recovery": "Non-blocking \u00e2\u20ac\u201d login succeeds even if tracking fails. Session will expire via scheduled function.",
            "failureModes": [
              "Firestore write timeout",
              "Admin SDK initialization failure"
            ]
          }
        }
      }
    },
    {
      "guid": "API_AUTH_RECORD_LOGON-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "POST endpoint that records a user logon event in the user_logons collection for session tracking. Verifies Bearer token, accepts loginMethod, writes via Admin SDK, returns logonId.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/record-logon/route.ts"
      },
      "callChain": {
        "calledBy": [
          "FIREBASE_PROVIDER-061"
        ],
        "calls": []
      },
      "errorProfile": {
        "throws": [
          "PX-6004"
        ],
        "handles": [],
        "emits": {
          "PX-6004": {
            "key": "LOGON_RECORD_FAILED",
            "message": "Failed to record logon event",
            "severity": "error",
            "recovery": "Non-blocking \u00e2\u20ac\u201d OAuth login continues even if logon recording fails.",
            "failureModes": [
              "Token verification failure",
              "Firestore write failure",
              "Invalid loginMethod"
            ]
          }
        }
      }
    },
    {
      "guid": "API_AUTH_RECORD_LOGOUT-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "POST endpoint that records a user logout event by updating the user_logons document with logout timestamp and Logged Out status. Validates document ownership to prevent cross-user spoofing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/record-logout/route.ts"
      },
      "callChain": {
        "calledBy": [
          "FIREBASE_PROVIDER-014"
        ],
        "calls": []
      },
      "errorProfile": {
        "throws": [
          "PX-6005"
        ],
        "handles": [],
        "emits": {
          "PX-6005": {
            "key": "LOGON_LOGOUT_FAILED",
            "message": "Failed to record logout event",
            "severity": "error",
            "recovery": "Non-blocking \u00e2\u20ac\u201d logout proceeds. Session will expire via scheduled function after 24h.",
            "failureModes": [
              "Token verification failure",
              "Logon document not found",
              "Cross-user ownership mismatch",
              "Firestore update failure"
            ]
          }
        }
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Server-side API route that handles PIN reset requests: validates the email, generates a new random 6-digit PIN, updates Firebase Auth, marks the user as mustChangePin, queues a reset email, and logs the action. Returns a generic success message regardless of whether the email exists to prevent enumeration attacks.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Type contract for the expected JSON body of the PIN reset request.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main PIN reset POST handler. Validates the email, looks up the user in Firestore, generates a cryptographically random 6-digit PIN, updates Firebase Auth, flags the user for mandatory PIN change, queues a reset email, and writes audit records. Returns a deliberately ambiguous success message to prevent email enumeration.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that the email field is present in the request body.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Look up the user in Firestore by normalised email. If no user is found, return a generic success message to prevent email enumeration attacks (attacker cannot determine which emails have accounts).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-005",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a cryptographically secure random 6-digit PIN and update the user's password in Firebase Auth. Uses crypto.randomInt for uniform distribution across the 100000-999999 range.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Set the mustChangePin flag on the user's Firestore document so the application forces a PIN change on the user's next successful login.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Queue the PIN reset email by writing to the mail collection (consumed by the email sending service) and log the email to the email_logs collection for auditing and debugging.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Write an audit log entry recording that a PIN reset email was queued for this user, then return the generic success message.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_RESET_PIN-009",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level catch-all error handler for any unhandled exception during PIN reset. Logs the error to error_logs (with fallback to console if logging itself fails) and returns a generic 500 response with correlation ID for support tracing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/reset-pin/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Server-side API route that registers new users: validates input, creates Firebase Auth and Firestore records, enrols the user in the global league, applies late-joiner handicap scoring if the season has started, sends welcome and verification emails, and returns a custom token for immediate sign-in.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "List of commonly guessable 6-digit PINs that are rejected during signup to enforce minimum credential strength.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Constant for the global league document ID, used to add every new user to the shared league.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Type contract for the expected JSON body of the signup request.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main signup POST handler. Validates all input fields (email, team name, PIN strength), checks admin toggle for signup availability, prevents duplicate emails and team names, creates the Firebase Auth user and Firestore documents, handles late-joiner handicap, sends emails, and returns a custom token.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that all required fields (email, team name, PIN) are present.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Validate PIN format (exactly 6 digits) and reject weak/guessable PINs from the WEAK_PINS list.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that the team name is at least 3 characters long.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Check the admin_configuration/site_settings document to determine if new user signups are currently enabled. Allows admins to disable registration without code changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Check for duplicate email addresses in the Firestore users collection to prevent multiple accounts with the same email.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-010",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Check for duplicate team names (case-insensitive) across all existing users to ensure team name uniqueness.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-011",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Create the Firebase Auth user record with the provided email and PIN as password. Handles the auth/email-already-exists error case separately from other auth errors.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      },
      "errorProfile": {
        "throws": [
          "PX-1008"
        ],
        "handles": [],
        "emits": {
          "PX-1008": {
            "key": "AUTH_SIGNIN_VERIFICATION_FAILED",
            "message": "Sign-in verification failed",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          }
        }
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Create the Firestore user document and presence document for the newly registered user. The user document stores profile and state data; the presence document tracks online status.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Add the new user to the global league by appending their uid to the memberUserIds array. Fails silently if the global league document does not exist (non-blocking).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-014",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Apply the late-joiner handicap rule: if the season has already started (scores exist), calculate a starting score of (lowest real score - 5) so the new user starts 5 points behind last place. Skips existing adjustment scores when determining the minimum.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-015",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Send a welcome email and a verification email to the new user via internal API endpoints. Both are fire-and-forget; failures are logged but do not block signup completion.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-016",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Log the successful registration to the audit_logs collection and generate a Firebase custom token so the client can sign in immediately without a second round-trip.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_AUTH_SIGNUP-017",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level catch-all error handler for any unhandled exception during signup. Logs the error to error_logs and returns a generic 500 response with correlation ID for support tracing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/auth/signup/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route that calculates race scores for all teams based on submitted race results and team predictions. Core scoring engine for the Prix Six fantasy league.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Defines the shape of the incoming race result submission from the admin.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Represents a single team's score result for the API response.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Represents a ranked entry in the overall standings returned by the API.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-004",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Normalises a raceId/raceName by stripping GP/Sprint suffixes and collapsing whitespace to hyphens, so predictions filed under the base race name can be matched.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Creates a Firestore document ID for race results that preserves GP vs Sprint distinction (e.g. \"australia-gp\" or \"australia-sprint\").",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts",
        "functionName": "createRaceResultDocId"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-006",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main POST handler that orchestrates the entire scoring pipeline: auth check, admin verification, prediction resolution (including carry-forwards), score calculation, batch write of scores/results/audit, and standings aggregation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-007",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Authenticates the request by verifying the Firebase Auth bearer token and confirms the user has admin privileges.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-008",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Parses and validates the race result request body, ensuring all six driver positions are provided.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts",
        "functionName": "data"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Loads all users to build lookup maps from userId/teamId to team names, including secondary teams, for score attribution.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches all predictions across all users via a collectionGroup query, then organises them by team and race to support the carry-forward resolution logic.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Builds a nested map (teamId -> raceId -> prediction) from all prediction documents, keeping only the latest prediction per team per race. Handles both primary and secondary team predictions.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Resolves each team's effective prediction for the current race by checking for a race-specific prediction first, then falling back to the most recent prediction from any earlier race (carry-forward rule).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-013",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Converts the latestPredictions map into a snapshot-like iterable format to maintain compatibility with the downstream scoring loop which was originally written against Firestore query snapshots.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-014",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Core scoring loop: iterates over each team's prediction, calculates points per driver using the hybrid position-based scoring system (calculateDriverPoints), applies the all-6 bonus, and prepares batch writes for score documents.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-015",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Creates synthetic prediction documents in Firestore for teams whose predictions were carried forward, ensuring the results page can find a prediction document for every scored team on every race.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-016",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Writes the official race result document to the race_results collection, storing the top-6 finishing order. Also creates an audit log entry for the result submission.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-017",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Aggregates all scores across all races to produce updated overall league standings with tie-aware ranking, returned in the API response.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_CALCULATE_SCORES-018",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler that catches any unhandled exception during scoring, logs it with a correlation ID, and returns a 500 response with the correlation ID for user-reportable error tracing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/calculate-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_DELETE_SCORES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route that deletes all scores and the race result document for a given race. Used by admins to undo/re-do scoring.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/delete-scores/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_DELETE_SCORES-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Defines the shape of the incoming delete request, requiring the race identifier and optional display name.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/delete-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_DELETE_SCORES-002",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Normalises a raceId by stripping GP/Sprint suffixes, collapsing whitespace to hyphens, and lowercasing to match the format used when scores are stored.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/delete-scores/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_DELETE_SCORES-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main POST handler that authenticates the admin, queries all score documents for the specified race, batch-deletes them along with the race result document, and logs an audit event.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/delete-scores/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_DELETE_SCORES-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Authenticates the request by verifying the Firebase Auth bearer token and confirms the user has admin privileges before allowing score deletion.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/delete-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_DELETE_SCORES-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Parses the request body and validates that a raceId is provided, then normalises it to match the stored score format.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/delete-scores/route.ts",
        "functionName": "data"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_DELETE_SCORES-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Queries all score documents matching the normalised raceId, deletes them in a batch along with the race result document, and writes an audit log entry -- all committed atomically.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/delete-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_DELETE_SCORES-007",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler that catches any unhandled exception during score deletion, logs it with a correlation ID, and returns a 500 response.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/delete-scores/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_HEALTH-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route that provides an email system health check for admins. Checks Graph API credentials, Firebase Admin connectivity, recent email success/failure rates, and email queue depth.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-health/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_HEALTH-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for the health check response \u00e2\u20ac\u201d structured result with overall status and individual check statuses for Graph credentials, Firebase Admin, recent emails, and queued emails.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-health/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_HEALTH-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "GET handler \u00e2\u20ac\u201d authenticates the caller via Bearer token, checks admin status, then assembles a health report by inspecting Graph API env vars, querying email_logs for failures in the last 24 hours, and checking email_queue for pending items. Returns overall status as healthy/degraded/unhealthy.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-health/route.ts",
        "functionName": "GET"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_QUEUE-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route that manages the email queue \u00e2\u20ac\u201d supports fetching queued/failed emails (GET), sending or re-queuing emails with retry logic (POST), and deleting queued emails (DELETE). Central to the email delivery reliability system.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-queue/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_QUEUE-001",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Retry configuration constants \u00e2\u20ac\u201d limits retry attempts to 3 and spaces retries 5 minutes apart to avoid hammering the Graph API during transient failures.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-queue/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_QUEUE-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for a queued email document \u00e2\u20ac\u201d represents an email in the email_queue Firestore collection with its delivery status, retry metadata, and content.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-queue/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_QUEUE-003",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "GET handler \u00e2\u20ac\u201d fetches queued emails from Firestore. In admin mode (includeAll=true), returns up to 100 emails regardless of status. In normal mode, returns only pending emails whose nextRetryAt has passed (ready to process).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-queue/route.ts",
        "functionName": "GET"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_QUEUE-004",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "POST handler \u00e2\u20ac\u201d processes email queue actions. \"resend\" action re-queues failed emails by resetting their retry count and status to pending. \"push\" action sends pending emails via Graph API, recording successes in email_daily_stats and handling failures with exponential retry logic via handleEmailFailure.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-queue/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_QUEUE-005",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Handles email send failures with retry logic. If the retry count is below MAX_RETRY_ATTEMPTS (3), schedules a retry after RETRY_DELAY_MINUTES (5 min) by updating the queue document. If max retries are exhausted, marks the email as permanently failed.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-queue/route.ts",
        "functionName": "handleEmailFailure"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_EMAIL_QUEUE-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "DELETE handler \u00e2\u20ac\u201d removes queued emails from Firestore. If specific emailIds are provided, deletes those; otherwise deletes all pending emails. Used by admins to clear the queue.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/email-queue/route.ts",
        "functionName": "DELETE"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_LOG_CLIENT_ERROR-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route for receiving and persisting client-side errors to Firestore. Provides a server endpoint so browser-based error handlers can log errors with correlation IDs to the error_logs collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/log-client-error/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_LOG_CLIENT_ERROR-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Initialise Firebase Admin SDK if not already done. Supports both production (Application Default Credentials) and local development (service account file).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/log-client-error/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_LOG_CLIENT_ERROR-002",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface defining the expected shape of client error payloads. Ensures type safety for the request body.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/log-client-error/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_LOG_CLIENT_ERROR-003",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "POST handler that validates the incoming client error payload and writes it to the Firestore error_logs collection. Designed to be resilient \u00e2\u20ac\u201d never returns an error that would worsen the client's already-errored state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/log-client-error/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_LOG_CLIENT_ERROR-004",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Basic validation \u00e2\u20ac\u201d ensures the minimum required fields (correlationId and error message) are present.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/log-client-error/route.ts",
        "functionName": "traced"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_LOG_CLIENT_ERROR-005",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Persist the client error to Firestore error_logs collection with full context, defaulting errorCode to PX-9001 (unknown) if not provided.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/log-client-error/route.ts"
      },
      "errorProfile": {
        "throws": [
          "PX-9001"
        ],
        "handles": [],
        "emits": {
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_LOG_CLIENT_ERROR-006",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Catch-all error handler \u00e2\u20ac\u201d logs to console but returns a simple 500. Intentionally does NOT call logError() to avoid recursive error logging. The client is already in an error state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/log-client-error/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_LOG_CLIENT_ERROR-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Persist a TracedError payload with full diagnostic metadata to error_logs. Stores all four diagnostic answers: where (file, functionName, guid), what (message, context), known failures (recovery, failureModes), and who triggered (calledBy, calls).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/log-client-error/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_HOT_NEWS_EMAIL-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "API route that broadcasts a hot news email to all users who have opted in to the newsFeed email preference. Enforces daily global and per-address rate limits, logs audit events, and tracks email stats.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-hot-news-email/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_HOT_NEWS_EMAIL-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Rate-limiting constants \u00e2\u20ac\u201d caps total daily emails at 30 globally and 5 per individual address to prevent abuse and protect Graph API quotas.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-hot-news-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_HOT_NEWS_EMAIL-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for the incoming request body \u00e2\u20ac\u201d content of the hot news, plus who triggered the update.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-hot-news-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_HOT_NEWS_EMAIL-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for an entry in the email_daily_stats.emailsSent array \u00e2\u20ac\u201d tracks each sent email for rate-limiting and audit.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-hot-news-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_HOT_NEWS_EMAIL-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Returns today's date as an ISO date string (YYYY-MM-DD) for keying the email_daily_stats document.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-hot-news-email/route.ts",
        "functionName": "getTodayDateString"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_HOT_NEWS_EMAIL-005",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "POST handler \u00e2\u20ac\u201d orchestrates the entire hot news email broadcast: validates input, logs audit event, checks rate limits, queries opted-in users, sends emails (including to verified secondary addresses), updates daily stats, and logs a summary audit event.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-hot-news-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_HOT_NEWS_EMAIL-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Builds the HTML email body for hot news notifications, converting newline-separated content into styled HTML paragraphs with Prix Six branding.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-hot-news-email/route.ts",
        "functionName": "buildHotNewsEmailHtml"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_PROVIDER_LINKED_EMAIL-000",
      "version": 4,
      "logic_category": "IO",
      "description": "API route that sends a confirmation email when a user links a Google or Apple sign-in provider to their account. Sends to primary email and secondary email (if verified). Fire-and-forget from the client.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-provider-linked-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_PROVIDER_LINKED_EMAIL-001",
      "version": 3,
      "logic_category": "IO",
      "description": "Map provider IDs to human-readable names for the email body.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-provider-linked-email/route.ts",
        "functionName": "providerDisplayName"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_PROVIDER_LINKED_EMAIL-002",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "POST handler \u2014 validates required fields, builds a branded confirmation email, and sends to primary (and optionally secondary) email addresses.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-provider-linked-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_RESULTS_EMAIL-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "API route that sends race results emails to all users who have opted in (or not opted out) of results notifications. Each email is personalised with the user's prediction, score, and current standings.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-results-email/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_RESULTS_EMAIL-001",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Helper to obtain the Firestore db instance, wrapping getFirebaseAdmin for backwards compatibility.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-results-email/route.ts",
        "functionName": "getAdminDb"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_RESULTS_EMAIL-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for the incoming request body \u00e2\u20ac\u201d identifies the race, its official result, per-team scores, and current season standings.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-results-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_RESULTS_EMAIL-003",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "POST handler \u00e2\u20ac\u201d queries all users who have not opted out of results notifications, builds a personalised results email for each (showing their prediction, score, race scores table, and season standings), sends via Graph API, and records delivery in email-tracking.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-results-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_RESULTS_EMAIL-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Builds the full HTML email body for race results, including the user's score hero section, official result table, user prediction, race scores table (sorted by points, user highlighted), and season standings table (user highlighted).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-results-email/route.ts",
        "functionName": "buildResultsEmailHtml"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_SECONDARY_VERIFICATION-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "API route that sends a verification email for a user's secondary email address. Validates that the secondary email matches the user record, generates a CSPRNG token, stores it in Firestore with a 2-hour expiry, and sends a branded verification email via Graph API.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-secondary-email-verification/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_SECONDARY_VERIFICATION-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Generates a cryptographically secure 32-byte hex token for secondary email verification links.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-secondary-email-verification/route.ts",
        "functionName": "generateVerificationToken"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_SECONDARY_VERIFICATION-002",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "POST handler \u00e2\u20ac\u201d validates required fields (uid, secondaryEmail), checks Graph API config, verifies user exists and secondary email matches their record, generates a verification token with 2-hour expiry, stores it in Firestore, builds a branded verification email with CTA button, sends via Graph API, and logs an audit event on success.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-secondary-email-verification/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_VERIFICATION_EMAIL-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "API route that sends a primary email verification link to a user. Generates a CSPRNG token, stores it in Firestore with a 2-hour expiry, builds a branded HTML email, and sends via Graph API.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-verification-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_VERIFICATION_EMAIL-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Generates a cryptographically secure 32-byte hex token for email verification links.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-verification-email/route.ts",
        "functionName": "generateVerificationToken"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_VERIFICATION_EMAIL-002",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "POST handler \u00e2\u20ac\u201d validates required fields (uid, email), checks Graph API config, generates a verification token with 2-hour expiry, stores it in Firestore, builds a branded verification email with CTA button, sends via Graph API, and logs an audit event on success.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-verification-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_WELCOME_EMAIL-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "API route that sends a welcome email to a newly registered user with their team name and PIN.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-welcome-email/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SEND_WELCOME_EMAIL-001",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "POST handler \u00e2\u20ac\u201d validates required fields (toEmail, teamName, pin), delegates to sendWelcomeEmail, and returns the result.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/send-welcome-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SUBMIT_PREDICTION-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route that accepts and stores a user's top-6 driver prediction for a specific race and team. Enforces server-side lockout rules (results exist, qualifying started).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/submit-prediction/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SUBMIT_PREDICTION-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Defines the shape of the incoming prediction submission from the user.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/submit-prediction/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SUBMIT_PREDICTION-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main POST handler that authenticates the user, validates the prediction payload, enforces server-side lockout rules (race results exist or qualifying has started), and atomically writes the prediction and audit log to Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/submit-prediction/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SUBMIT_PREDICTION-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Authenticates the request by verifying the Firebase Auth bearer token and confirms the authenticated user matches the userId in the request body (prevents submitting on behalf of another user).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/submit-prediction/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SUBMIT_PREDICTION-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Validates that all required fields are present and that the predictions array contains exactly 6 driver IDs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/submit-prediction/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SUBMIT_PREDICTION-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Server-side lockout enforcement: checks if race results already exist in Firestore (locks predictions once results are entered) and if qualifying has started based on the RaceSchedule (time-based lockout). Two independent checks provide defence-in-depth.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/submit-prediction/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SUBMIT_PREDICTION-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Atomically writes the prediction document to the user's predictions subcollection (using merge to allow updates) and creates an audit log entry, committed as a single batch.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/submit-prediction/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_SUBMIT_PREDICTION-007",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler that catches any unhandled exception during prediction submission, logs it with a correlation ID, and returns a 500 response.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/submit-prediction/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_TEAM_NAME_SUGGESTIONS-000",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Public GET endpoint that returns 50 shuffled F1-themed team name suggestions, filtered against existing team names (both primary and secondary) in Firestore. the signup page is public.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/team-name-suggestions/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_TEAM_NAME_SUGGESTIONS-001",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "GET handler that fetches all existing team names from Firestore and returns 50 filtered, shuffled suggestions from the curated pool. so the client can fall back gracefully.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/team-name-suggestions/route.ts",
        "functionName": "GET"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route for adding, updating, or removing a user's secondary (communications) email address. Validates format, prevents duplicate/same-as-primary usage, resets verification status on change, and logs all changes to audit_logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Regex for basic email format validation \u00e2\u20ac\u201d ensures the input looks like a valid email before database operations.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "POST handler that orchestrates secondary email management: validates uid, handles removal (null/empty), validates email format, checks for same-as-primary and in-use conflicts, updates Firestore, and logs audit events.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that uid is present in the request.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Verify the user exists in Firestore before attempting any updates.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Handle removal of secondary email \u00e2\u20ac\u201d deletes both secondaryEmail and secondaryEmailVerified fields from the user document, logs removal to audit_logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Validate email format using regex, check secondary email is not the same as the primary email, and check it is not already in use as another user's primary email.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-007",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Persist the new secondary email (normalised to lowercase) and reset verification status to false, then log the change to audit_logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_UPDATE_SECONDARY_EMAIL-008",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler \u00e2\u20ac\u201d catches any unhandled exceptions, logs to error_logs, and returns a safe 500 response with correlation ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/update-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_EMAIL-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route for verifying a user's primary email address via a token-based verification link. Validates the token, marks email as verified in both Firestore and Firebase Auth, and logs an audit event.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_EMAIL-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "POST handler that validates an email verification token (constant-time comparison), checks expiry and re-use, updates both Firestore and Firebase Auth verified status, marks the token as used, and writes an audit log.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_EMAIL-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that both required fields (token and uid) are present in the request.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_EMAIL-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Retrieve the verification token document and perform security checks: existence, constant-time token comparison (prevents timing attacks), re-use check, and expiry check.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_EMAIL-004",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Mark the user's email as verified in Firestore users collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_EMAIL-005",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Also mark as verified in Firebase Auth for consistency (Golden Rule #3). Auth failure is non-fatal \u00e2\u20ac\u201d Firestore was already updated.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_EMAIL-006",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Mark the verification token as used to prevent re-use, and write an audit log entry.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_EMAIL-007",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler \u00e2\u20ac\u201d catches any unhandled exceptions, logs to error_logs, and returns a safe 500 response with correlation ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_SECONDARY_EMAIL-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "API route for verifying a user's secondary (communications) email address via a token-based verification link. Similar to primary email verification but operates on the secondary_email_verification_tokens collection and does NOT update Firebase Auth.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_SECONDARY_EMAIL-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "POST handler that validates a secondary email verification token (constant-time comparison), checks expiry and re-use, verifies the secondary email has not changed since the token was issued, updates Firestore verified status, marks the token as used, and writes an audit log.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-secondary-email/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_SECONDARY_EMAIL-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that both required fields (token and uid) are present in the request.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_SECONDARY_EMAIL-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Retrieve the secondary email verification token document and perform security checks: existence, constant-time token comparison (prevents timing attacks), re-use check, and expiry check.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_SECONDARY_EMAIL-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Verify the user still exists and their secondary email has not changed since the verification token was issued. Prevents verifying a stale email address.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_SECONDARY_EMAIL-005",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Mark the user's secondary email as verified in Firestore. NOTE: Does NOT update Firebase Auth \u00e2\u20ac\u201d secondary email is for communications only, not login.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_SECONDARY_EMAIL-006",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Mark the verification token as used to prevent re-use, and write an audit log entry.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_VERIFY_SECONDARY_EMAIL-007",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Top-level error handler \u00e2\u20ac\u201d catches any unhandled exceptions, logs to error_logs, and returns a safe 500 response with correlation ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/verify-secondary-email/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "HTTPS-to-HTTP proxy for the WhatsApp worker running on Azure Container Instances. Bridges the browser (HTTPS-only) to the internal HTTP-only WhatsApp worker, with admin auth, endpoint whitelisting, and HMAC request signing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Internal URL constant for the WhatsApp worker \u00e2\u20ac\u201d HTTP-only, not exposed to browsers. Traffic flows: Browser -> this proxy (HTTPS) -> worker (HTTP).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts",
        "functionName": "signRequest"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Generate HMAC SHA-256 signature for outgoing worker requests so the worker can verify requests originate from this trusted proxy.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts",
        "functionName": "signRequest"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "GET handler \u00e2\u20ac\u201d proxies read-only requests to the WhatsApp worker. Verifies admin auth, whitelists allowed endpoints (health, status, qr), signs the request, and returns the worker's response. QR endpoint returns plain text; others return JSON.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts",
        "functionName": "GET"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Verify the caller has a valid Firebase Auth token and is an admin user. Two-step check: token verification then Firestore isAdmin lookup.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Extract and validate the endpoint query parameter against a whitelist of allowed GET endpoints. Prevents arbitrary endpoint access on the worker.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Forward the validated GET request to the WhatsApp worker with HMAC signature. Handles QR endpoint as plain text, all others as JSON.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-007",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Catch-all error handler for GET requests \u00e2\u20ac\u201d logs to console and returns a generic proxy error.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-008",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "POST handler \u00e2\u20ac\u201d proxies write requests to the WhatsApp worker. Verifies admin auth, whitelists allowed POST endpoints (ping, trigger-test), signs the request, and returns the worker's JSON response.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts",
        "functionName": "POST"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-009",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Verify the caller has a valid Firebase Auth token and is an admin user. Same two-step check as GET handler.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-010",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Extract and validate the endpoint query parameter against a whitelist of allowed POST endpoints. Prevents arbitrary write operations on the worker.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Forward the validated POST request to the WhatsApp worker with HMAC signature and return the JSON response.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "API_WHATSAPP_PROXY-012",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Catch-all error handler for POST requests \u00e2\u20ac\u201d logs to console and returns a generic proxy error.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/api/whatsapp-proxy/route.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_ADMIN_TAB-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Import statement for BackupHealthDashboard component in the admin page. Lazy-loaded by Next.js when the admin route is visited.",
      "dependencies": [
        "BACKUP_DASHBOARD-000"
      ],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": [
          "BACKUP_DASHBOARD-000"
        ]
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Root module for BackupHealthDashboard.tsx. Admin-only React component that subscribes to backup_status/latest in real-time and renders three cards: Backup Status, Immutability Lock, Smoke Test.",
      "dependencies": [
        "BACKUP_DASHBOARD-001",
        "BACKUP_DASHBOARD-002",
        "BACKUP_DASHBOARD-003",
        "BACKUP_DASHBOARD-004",
        "BACKUP_DASHBOARD-007",
        "BACKUP_DASHBOARD-010"
      ],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_ADMIN_TAB-001"
        ],
        "calls": [
          "BACKUP_DASHBOARD-001",
          "BACKUP_DASHBOARD-002",
          "BACKUP_DASHBOARD-003",
          "BACKUP_DASHBOARD-004",
          "BACKUP_DASHBOARD-007",
          "BACKUP_DASHBOARD-010"
        ]
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "BackupStatus TypeScript interface mirroring the Firestore document shape written by Cloud Functions. All fields optional to handle partial population and first-run state. Includes lastBackupSizeBytes for backup size display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-000"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "TimestampDisplay component: renders Firestore Timestamps as relative time ('3 hours ago') with absolute ISO timestamp on hover tooltip. Falls back to 'Never' when no timestamp exists.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx",
        "functionName": "TimestampDisplay"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-000",
          "BACKUP_DASHBOARD-021",
          "BACKUP_DASHBOARD-023"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "CopyButton component: one-click clipboard copy for correlation IDs. Shows green check for 2 seconds as visual confirmation. Used by ops to paste IDs into Cloud Logging search.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-000",
          "BACKUP_DASHBOARD-021",
          "BACKUP_DASHBOARD-023"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "StatusBadge component: renders colour-coded badge for SUCCESS (green), FAILED (red), or No data (outline). Used in Backup Status and Smoke Test card headers.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx",
        "functionName": "StatusBadge"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-000",
          "BACKUP_DASHBOARD-021",
          "BACKUP_DASHBOARD-023"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Trigger a manual backup via the manualBackup callable Cloud Function.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx",
        "functionName": "returns"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Trigger a manual smoke test via the manualSmokeTest callable Cloud Function. Same error handling pattern as handleBackupNow. and the dashboard updates in real-time.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx",
        "functionName": "handleSmokeTestNow"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "formatBytes utility: converts a byte count to a human-readable string (e.g. '14.2 MB'). Used by the Backup Status card to display lastBackupSizeBytes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx",
        "functionName": "formatBytes"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-000"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "BackupHealthDashboard main component. Handles four states: loading (skeleton cards), error (PX-7001 alert), first-run (info alert), and normal (three-column card grid). Subscribes to backup_status/latest via useDoc.",
      "dependencies": [
        "BACKUP_DASHBOARD-011",
        "BACKUP_DASHBOARD-012",
        "BACKUP_DASHBOARD-013",
        "BACKUP_DASHBOARD-014",
        "BACKUP_DASHBOARD-020"
      ],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "errorProfile": {
        "throws": [
          "PX-7001"
        ],
        "handles": [],
        "emits": {
          "PX-7001": {
            "key": "BACKUP_STATUS_READ_FAILED",
            "message": "Failed to read backup status",
            "severity": "critical",
            "recovery": "Check backup_status/latest document in Firestore.",
            "failureModes": [
              "backup_status collection missing",
              "Permissions error on read"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [
          "BACKUP_ADMIN_TAB-003",
          "BACKUP_DASHBOARD-000"
        ],
        "calls": [
          "BACKUP_DASHBOARD-011",
          "BACKUP_DASHBOARD-012",
          "BACKUP_DASHBOARD-013",
          "BACKUP_DASHBOARD-014",
          "BACKUP_DASHBOARD-020"
        ]
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoized DocumentReference for backup_status/latest. Returns null if Firestore isn't ready or user isn't admin, preventing unnecessary subscriptions.",
      "dependencies": [
        "BACKUP_FUNCTIONS-005"
      ],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-010",
          "BACKUP_FUNCTIONS-005",
          "BACKUP_RULES-001"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-005"
        ]
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Loading state: renders 3 skeleton cards matching the three-column layout to prevent layout shift during Firestore subscription establishment.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-010"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-013",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Error state: creates PX-7001 (BACKUP_STATUS_READ_FAILED) with correlation ID and renders a destructive Alert with copyable error details. Client-side only \u00e2\u20ac\u201d does not write to error_logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "errorProfile": {
        "throws": [
          "PX-7001"
        ],
        "handles": [],
        "emits": {
          "PX-7001": {
            "key": "BACKUP_STATUS_READ_FAILED",
            "message": "Failed to read backup status",
            "severity": "critical",
            "recovery": "Check backup_status/latest document in Firestore.",
            "failureModes": [
              "backup_status collection missing",
              "Permissions error on read"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-010",
          "BACKUP_ERRORS-001"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-014",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "First-run state: handles the case where backup_status/latest doesn't exist yet (dailyBackup hasn't run). Shows info alert with deployment instructions. useDoc subscription remains active so it auto-updates when the doc is created.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-010"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-020",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Normal state renderer: three-column responsive grid (1 col mobile, 3 col desktop) containing Backup Status, Immutability Lock, and Smoke Test cards.",
      "dependencies": [
        "BACKUP_DASHBOARD-021",
        "BACKUP_DASHBOARD-022",
        "BACKUP_DASHBOARD-023"
      ],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-010"
        ],
        "calls": [
          "BACKUP_DASHBOARD-021",
          "BACKUP_DASHBOARD-022",
          "BACKUP_DASHBOARD-023"
        ]
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-030",
      "version": 3,
      "logic_category": "STATE",
      "description": "Type definition for BackupHistoryEntry interface representing a document in the backup_history Firestore collection. Each entry records one backup run with timestamp, status, path, sizeBytes, correlationId, trigger, and optional error.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-031"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-031",
      "version": 3,
      "logic_category": "DATA_READ",
      "description": "Memoized Firestore query for backup_history collection ordered by timestamp descending. Gated on admin status. Feeds useCollection hook for real-time backup history table.",
      "dependencies": [
        "BACKUP_DASHBOARD-030"
      ],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-010"
        ],
        "calls": [
          "BACKUP_RULES-002"
        ]
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-032",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "handleBackfill callback \u00e2\u20ac\u201d triggers listBackupHistory callable Cloud Function to backfill backup_history from existing GCS backup folders. Error paths now use PX-7008 (BACKUP_BACKFILL_FAILED) with correlation ID and selectable copyable text per Golden Rule #1.",
      "dependencies": [
        "BACKUP_FUNCTIONS-055"
      ],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-033"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-055"
        ]
      }
    },
    {
      "guid": "BACKUP_DASHBOARD-034",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "BACKUP_DASHBOARD code block BACKUP_DASHBOARD-034",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/BackupHealthDashboard.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_ERRORS-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "PX-7xxx error code definitions for backup & recovery system. Seven codes covering status read failure (dashboard), export failures (Firestore and Auth), smoke test failure, restore failure, cleanup failure, and heartbeat absence (Dead Man's Switch).",
      "dependencies": [
        "BACKUP_DASHBOARD-013",
        "BACKUP_FUNCTIONS-015",
        "BACKUP_FUNCTIONS-026"
      ],
      "location": {
        "filePath": "app/src/lib/error-codes.ts"
      },
      "errorProfile": {
        "throws": [
          "PX-7001",
          "PX-7002",
          "PX-7007",
          "PX-7003",
          "PX-7004",
          "PX-7005",
          "PX-7006",
          "PX-8001",
          "PX-8002",
          "PX-8003",
          "PX-8004",
          "PX-9001",
          "PX-9002"
        ],
        "handles": [],
        "emits": {
          "PX-7001": {
            "key": "BACKUP_STATUS_READ_FAILED",
            "message": "Failed to read backup status",
            "severity": "critical",
            "recovery": "Check backup_status/latest document in Firestore.",
            "failureModes": [
              "backup_status collection missing",
              "Permissions error on read"
            ]
          },
          "PX-7002": {
            "key": "BACKUP_EXPORT_FAILED",
            "message": "Firestore backup export failed",
            "severity": "critical",
            "recovery": "Check Cloud Function logs. Verify IAM roles for Firestore export.",
            "failureModes": [
              "Missing IAM role",
              "GCS bucket not found",
              "Export timeout"
            ]
          },
          "PX-7007": {
            "key": "BACKUP_HEARTBEAT_FAILED",
            "message": "Backup heartbeat missing - backup may not be running",
            "severity": "critical",
            "recovery": "",
            "failureModes": []
          },
          "PX-7003": {
            "key": "BACKUP_AUTH_EXPORT_FAILED",
            "message": "Auth data backup export failed",
            "severity": "critical",
            "recovery": "Check Cloud Function logs. Verify Auth Admin SDK permissions.",
            "failureModes": [
              "Missing Auth admin permissions",
              "Too many users for export"
            ]
          },
          "PX-7004": {
            "key": "BACKUP_SMOKE_TEST_FAILED",
            "message": "Backup smoke test failed",
            "severity": "critical",
            "recovery": "Check lastBackupPath exists in backup_status/latest. Verify IAM roles.",
            "failureModes": [
              "No backup exists yet",
              "Missing IAM role",
              "Import timeout"
            ]
          },
          "PX-7005": {
            "key": "BACKUP_RESTORE_FAILED",
            "message": "Backup restore failed",
            "severity": "critical",
            "recovery": "",
            "failureModes": []
          },
          "PX-7006": {
            "key": "BACKUP_CLEANUP_FAILED",
            "message": "Backup cleanup failed",
            "severity": "critical",
            "recovery": "",
            "failureModes": []
          },
          "PX-8001": {
            "key": "ATTACK_LOG_FAILED",
            "message": "Failed to log login attempt",
            "severity": "error",
            "recovery": "Check login_attempts collection permissions. Non-blocking -- login still succeeds.",
            "failureModes": [
              "Firestore write permission denied",
              "Collection missing"
            ]
          },
          "PX-8002": {
            "key": "ATTACK_ALERT_FAILED",
            "message": "Failed to create attack alert",
            "severity": "error",
            "recovery": "Check attack_alerts collection permissions. Non-blocking.",
            "failureModes": [
              "Firestore write permission denied"
            ]
          },
          "PX-8003": {
            "key": "ATTACK_LOG_WRITE_FAILED",
            "message": "Failed to write login attempt to database",
            "severity": "error",
            "recovery": "Check Firestore connectivity. Login continues even if logging fails.",
            "failureModes": [
              "Network timeout",
              "Firestore unavailable"
            ]
          },
          "PX-8004": {
            "key": "ATTACK_CHECK_FAILED",
            "message": "Attack detection check failed",
            "severity": "error",
            "recovery": "Check attack-detection.ts. Login continues even if detection fails.",
            "failureModes": [
              "Query timeout on login_attempts",
              "Malformed query"
            ]
          },
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          },
          "PX-9002": {
            "key": "NETWORK_ERROR",
            "message": "Network error - please check your connection",
            "severity": "error",
            "recovery": "Check internet connection. Retry after a moment.",
            "failureModes": [
              "Client offline",
              "DNS resolution failure",
              "Server unreachable"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": [
          "BACKUP_DASHBOARD-013",
          "BACKUP_FUNCTIONS-015",
          "BACKUP_FUNCTIONS-026"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Firebase Admin SDK initialisation at cold-start. Required before any getFirestore()/getAuth() call. Runs once per Cloud Function instance lifecycle.",
      "dependencies": [],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-000"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-002",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Centralised configuration constants: project IDs, bucket name, region, status collection/doc path. Single point of change if the project is forked or renamed.",
      "dependencies": [],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-000",
          "BACKUP_FUNCTIONS-005",
          "BACKUP_FUNCTIONS-010",
          "BACKUP_FUNCTIONS-020"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generates unique correlation IDs (prefix_timestamp36_random6) for end-to-end tracing across Cloud Functions, Firestore status doc, GCS metadata, and admin dashboard.",
      "dependencies": [],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-010",
          "BACKUP_FUNCTIONS-020"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generates date-based GCS folder names (YYYY-MM-DD or YYYY-MM-DD-SUNDAY). Sunday suffix is cosmetic only \u00e2\u20ac\u201d retention is identical for all days.",
      "dependencies": [],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-010"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Merges partial status fields into backup_status/latest Firestore doc using set(merge:true). Allows dailyBackup and runRecoveryTest to independently update their own fields without clobbering each other.",
      "dependencies": [
        "BACKUP_FUNCTIONS-002",
        "BACKUP_DASHBOARD-011"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-011",
          "BACKUP_FUNCTIONS-010",
          "BACKUP_FUNCTIONS-013",
          "BACKUP_FUNCTIONS-015",
          "BACKUP_FUNCTIONS-020",
          "BACKUP_FUNCTIONS-021",
          "BACKUP_FUNCTIONS-025",
          "BACKUP_FUNCTIONS-026",
          "BACKUP_RULES-001"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-002",
          "BACKUP_DASHBOARD-011"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-009",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "BACKUP_FUNCTIONS code block BACKUP_FUNCTIONS-009",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-010",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "dailyBackup scheduled Cloud Function (02:00 UTC daily). Orchestrates Firestore managed export, Auth JSON pagination export, status write, and BACKUP_HEARTBEAT structured log emission. Heartbeat emitted on both success and failure to prevent Dead Man's Switch double-alerting.",
      "dependencies": [
        "BACKUP_FUNCTIONS-002",
        "BACKUP_FUNCTIONS-003",
        "BACKUP_FUNCTIONS-004",
        "BACKUP_FUNCTIONS-005",
        "BACKUP_FUNCTIONS-011",
        "BACKUP_FUNCTIONS-012",
        "BACKUP_FUNCTIONS-013",
        "BACKUP_FUNCTIONS-014",
        "BACKUP_FUNCTIONS-015"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-000"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-002",
          "BACKUP_FUNCTIONS-003",
          "BACKUP_FUNCTIONS-004",
          "BACKUP_FUNCTIONS-005",
          "BACKUP_FUNCTIONS-011",
          "BACKUP_FUNCTIONS-012",
          "BACKUP_FUNCTIONS-013",
          "BACKUP_FUNCTIONS-014",
          "BACKUP_FUNCTIONS-015"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-011",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Firestore managed export via FirestoreAdminClient.exportDocuments() (v1 admin API). The regular Firestore data client does NOT have exportDocuments() or databasePath() \u00e2\u20ac\u201d must use the admin client from @google-cloud/firestore v1 namespace.",
      "dependencies": [
        "PROVISION_RECOVERY-062",
        "PROVISION_RECOVERY-064"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-010",
          "PROVISION_RECOVERY-062",
          "PROVISION_RECOVERY-064"
        ],
        "calls": [
          "PROVISION_RECOVERY-062",
          "PROVISION_RECOVERY-064"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-012",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Auth user export via Admin SDK listUsers() pagination (1000/page). Serialises user metadata (uid, email, displayName, providers, customClaims) to JSON in GCS. Does NOT include password hashes \u00e2\u20ac\u201d Firebase Auth does not expose them.",
      "dependencies": [
        "PROVISION_RECOVERY-063"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-010",
          "PROVISION_RECOVERY-063"
        ],
        "calls": [
          "PROVISION_RECOVERY-063"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Writes SUCCESS status to backup_status/latest after both Firestore and Auth exports complete. Explicitly nulls lastBackupError to clear any previous failure state. Now also writes lastBackupSizeBytes from BACKUP_FUNCTIONS-018.",
      "dependencies": [
        "BACKUP_FUNCTIONS-005",
        "BACKUP_FUNCTIONS-018"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-010"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-005",
          "BACKUP_FUNCTIONS-018"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-014",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Emits BACKUP_HEARTBEAT structured JSON log on the success path. This log feeds the log-based metric backup_heartbeat_count, which the Dead Man's Switch MQL alert monitors for absence >25 hours.",
      "dependencies": [],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-010"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-015",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Error handler for dailyBackup. Writes FAILED status to backup_status/latest, emits BACKUP_HEARTBEAT with severity:ERROR (to prevent DMS double-alert), then re-throws so Cloud Functions marks the invocation as failed.",
      "dependencies": [
        "BACKUP_FUNCTIONS-005"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_ERRORS-001",
          "BACKUP_FUNCTIONS-010"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-005"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-016",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "BACKUP_FUNCTIONS code block BACKUP_FUNCTIONS-016",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-017",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Call performBackup and return structured success/failure response. On failure, include correlationId and errorCode (PX-7002) so the frontend can display a Golden Rule #1 compliant error with copyable details. The correlationId is extracted from the error object where performBackup attaches it before re-throwing.",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-018",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Calculates total backup size by listing all GCS objects under the backup folder prefix and summing their sizes. Result stored in lastBackupSizeBytes for admin dashboard display.",
      "dependencies": [],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-013"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-020",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "runRecoveryTest scheduled Cloud Function (04:00 UTC Sundays). Imports the latest backup into a disposable recovery project, verifies critical documents exist, cleans up, and writes smoke test result to status doc.",
      "dependencies": [
        "BACKUP_FUNCTIONS-002",
        "BACKUP_FUNCTIONS-003",
        "BACKUP_FUNCTIONS-005",
        "BACKUP_FUNCTIONS-021",
        "BACKUP_FUNCTIONS-022",
        "BACKUP_FUNCTIONS-023",
        "BACKUP_FUNCTIONS-024",
        "BACKUP_FUNCTIONS-025",
        "BACKUP_FUNCTIONS-026"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-000"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-002",
          "BACKUP_FUNCTIONS-003",
          "BACKUP_FUNCTIONS-005",
          "BACKUP_FUNCTIONS-021",
          "BACKUP_FUNCTIONS-022",
          "BACKUP_FUNCTIONS-023",
          "BACKUP_FUNCTIONS-024",
          "BACKUP_FUNCTIONS-025",
          "BACKUP_FUNCTIONS-026"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-021",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Reads lastBackupPath from backup_status/latest. Guards against the case where no backup has ever run \u00e2\u20ac\u201d fails loudly so ops investigates rather than silently skipping the smoke test.",
      "dependencies": [
        "BACKUP_FUNCTIONS-005"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-020"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-005"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-022",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Imports the Firestore export into the recovery project via FirestoreAdminClient.importDocuments() (v1 admin API). Must use the admin client, not the data client. Recovery project is ephemeral and cleaned up after verification.",
      "dependencies": [
        "PROVISION_RECOVERY-065"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-020",
          "PROVISION_RECOVERY-065"
        ],
        "calls": [
          "PROVISION_RECOVERY-065"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-023",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Smoke test verification using the regular Firestore data client (not admin client \u00e2\u20ac\u201d data reads use collection/doc/get). Checks system_status/heartbeat exists AND users collection has at least one document. Both failing = backup is empty or corrupt.",
      "dependencies": [
        "PROVISION_RECOVERY-066"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-020",
          "PROVISION_RECOVERY-066"
        ],
        "calls": [
          "PROVISION_RECOVERY-066"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-024",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Post-verification cleanup: deletes all data in the recovery project Firestore. Non-fatal \u00e2\u20ac\u201d cleanup failure is logged but does not fail the smoke test because the primary goal (verification) has already succeeded.",
      "dependencies": [
        "BACKUP_FUNCTIONS-030"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-020"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-030"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-025",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Writes SUCCESS smoke test status to backup_status/latest and emits SMOKE_TEST_COMPLETE structured log with verification results.",
      "dependencies": [
        "BACKUP_FUNCTIONS-005"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-020"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-005"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-026",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Error handler for runRecoveryTest. Writes FAILED status to backup_status/latest with the error message, then re-throws.",
      "dependencies": [
        "BACKUP_FUNCTIONS-005"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_ERRORS-001",
          "BACKUP_FUNCTIONS-020"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-005"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-030",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "deleteAllCollections: enumerates all top-level collections in recovery Firestore and batch-deletes every document. Errors are caught and logged (non-fatal by design \u00e2\u20ac\u201d next import overwrites anyway).",
      "dependencies": [
        "BACKUP_FUNCTIONS-031"
      ],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-024"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-031"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-031",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "deleteCollection: batch-deletes all documents in a single collection using batches of 500 (Firestore maximum). Loops until collection is empty. Does not recurse into subcollections.",
      "dependencies": [],
      "location": {
        "filePath": "functions/src/index.ts"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-030"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-040",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "BACKUP_FUNCTIONS code block BACKUP_FUNCTIONS-040",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-050",
      "version": 3,
      "logic_category": "DATA_WRITE",
      "description": "Writes a SUCCESS history entry to backup_history collection after a successful backup, recording timestamp, status, path, sizeBytes, correlationId, and trigger type.",
      "dependencies": [
        "BACKUP_FUNCTIONS-002"
      ],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-009"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-051",
      "version": 3,
      "logic_category": "DATA_WRITE",
      "description": "Writes a FAILED history entry to backup_history collection when a backup fails, recording timestamp, status, correlationId, trigger, and error message for audit trail.",
      "dependencies": [
        "BACKUP_FUNCTIONS-002"
      ],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-009"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-055",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "listBackupHistory callable Cloud Function. Admin-only. Backfills backup_history collection from existing GCS backup folder prefixes. Lists all top-level prefixes in gs://prix6-backups/, sums file sizes per prefix, writes to backup_history if not already present, returns full list. On failure returns PX-7008 with correlationId and writes failure record to backup_history.",
      "dependencies": [
        "BACKUP_FUNCTIONS-002",
        "BACKUP_FUNCTIONS-056"
      ],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_DASHBOARD-032"
        ],
        "calls": [
          "BACKUP_FUNCTIONS-056"
        ]
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-056",
      "version": 3,
      "logic_category": "DATA_READ",
      "description": "Lists all top-level folder prefixes in the backup GCS bucket using delimiter-based listing. Each prefix represents one backup run.",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [
          "BACKUP_FUNCTIONS-055"
        ],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-057",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Process a single GCS prefix: check if already backfilled, sum file sizes with paginated listing, parse timestamp, and write the history entry. Returns the entry object.",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js",
        "functionName": "processPrefix"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-058",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Process prefixes in parallel batches of 10 to stay well within the 540s Cloud Functions timeout. A deadline guard ensures we return a partial result instead of being killed by Cloud Run mid-flight. results if deadline approached. Caller can re-invoke to pick up remaining prefixes.",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js",
        "functionName": "BATCH_SIZE"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-060",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Write smoke test history entry so admins can see all past smoke test runs alongside backups in the history table.",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "BACKUP_FUNCTIONS-061",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Write smoke test failure history entry for audit trail.",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_APP_SIDEBAR-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Main application sidebar component providing navigation links, admin panel access,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/layout/AppSidebar.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_APP_SIDEBAR-001",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Static menu item configuration defining all navigation routes available to regular users.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/layout/AppSidebar.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_APP_SIDEBAR-002",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Exported sidebar component that renders the full navigation sidebar including header",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/layout/AppSidebar.tsx",
        "functionName": "AppSidebar"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_APP_SIDEBAR-003",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Handles user logout by first setting the Firestore presence document to offline,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/layout/AppSidebar.tsx",
        "functionName": "for"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Full-screen cinematic intro animation for the About page. Plays a 24-second F1-themed sequence through four phases: Grid Entry (version display), Telemetry (live stats), Module Tour (feature showcase), and Finish (chequered flag + logo). First-time visitors see this automatically; returning visitors can replay it.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Props interface for CinematicIntro. Receives live data (totalTeams, onlineUsers) and a completion callback.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "F1 brand red colour constant used throughout the intro for visual consistency.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Timing configuration for the four animation phases. Each phase has a start and end time in milliseconds, controlling the overall 24-second animation timeline.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Static data for the module tour phase (Phase 3). Each entry has a Lucide icon, display name, and short description representing a key app feature.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Animated number counter that eases from 0 to a target value over a specified duration. Used in the telemetry phase to display live stats with a dramatic count-up effect.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx",
        "functionName": "AnimatedCounter"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Drives the count-up animation using setInterval at ~60fps. Applies a cubic ease-out curve for a decelerating effect.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx",
        "functionName": "for"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Text component that periodically applies a brief RGB-shift glitch effect, creating a cyberpunk/HUD aesthetic for the version number display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx",
        "functionName": "GlitchText"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Renders a CSS perspective grid with horizontal and vertical lines, creating a retro F1 starting grid / Tron-like visual. Horizontal lines animate downward when isMoving is true.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx",
        "functionName": "PerspectiveGrid"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Heads-Up Display overlay with vignette darkening, scan lines, corner brackets, and status readouts. Creates an immersive cockpit/telemetry screen aesthetic.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx",
        "functionName": "HUDOverlay"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Animated chequered flag pattern that sweeps across the screen from left to right during the finish phase, signalling the end of the intro sequence.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx",
        "functionName": "ChequeredFlag"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "SVG logo for \"PRIX SIX\" with animated path drawing. Each letter (P, R, I, X) is drawn sequentially using Framer Motion's pathLength animation, followed by a fade-in \"SIX\" text element.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx",
        "functionName": "PrixSixLogo"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-012",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main CinematicIntro component. Orchestrates the 4-phase animation sequence using timed state transitions. Renders a full-screen black overlay with phase-specific content, a skip button, and a progress bar.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx",
        "functionName": "CinematicIntro"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Skip handler allowing users to bypass the intro at any point. Sets phase to 'done' and immediately calls onComplete.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-014",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Master timeline orchestrator. Schedules all phase transitions, module cycling, flag display, and completion using setTimeout calls based on PHASE_TIMINGS. All timers are cleaned up on unmount.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CINEMATIC_INTRO-015",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main render: full-screen fixed overlay with AnimatePresence managing phase transitions. Each phase renders its own motion.div with entry/exit animations. Skip button and progress bar are always visible.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/_components/CinematicIntro.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CONVERSION_BANNER-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Dismissable banner that prompts PIN-only users to link a Google or Apple account. Similar pattern to EmailVerificationBanner but with blue/purple theme. Shows only when the user's providerData contains only 'password'. Auto-hides on successful link. Dismissable for the current session.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/ConversionBanner.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CONVERSION_BANNER-001",
      "version": 3,
      "logic_category": "PRESENTATION",
      "description": "Main exported component. Renders only for PIN-only users (no OAuth provider linked). Provides Link Google and Link Apple buttons with loading and success states. the user's providers list, causing this banner to auto-hide.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/ConversionBanner.tsx",
        "functionName": "ConversionBanner"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CONVERSION_BANNER-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Link Google account to the current user.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/ConversionBanner.tsx",
        "functionName": "handleLinkGoogle"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_CONVERSION_BANNER-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Link Apple account to the current user.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/ConversionBanner.tsx",
        "functionName": "handleLinkApple"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_DASHBOARD_CLIENT-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Client-side dashboard component providing real-time countdown to qualifying,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/DashboardClient.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_DASHBOARD_CLIENT-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Determines deadline urgency level based on time remaining until qualifying.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/DashboardClient.tsx",
        "functionName": "getDeadlineWarning"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_DASHBOARD_CLIENT-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for the countdown time breakdown (days/hours/minutes/seconds).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/DashboardClient.tsx",
        "functionName": "to"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_DASHBOARD_CLIENT-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Pure function to compute remaining time from now until targetDate.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/DashboardClient.tsx",
        "functionName": "to"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_DASHBOARD_CLIENT-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main client dashboard component \u00e2\u20ac\u201d renders countdown timer, deadline warnings,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/DashboardClient.tsx",
        "functionName": "DashboardClient"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_DASHBOARD_CLIENT-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Memoised prediction document ID constructed from user ID and race ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/DashboardClient.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_DASHBOARD_CLIENT-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore document reference for the user's prediction for this race.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/DashboardClient.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_DASHBOARD_CLIENT-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Recurring 1-second timer that recalculates the countdown to qualifying.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/DashboardClient.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_EMAIL_BANNER-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Dismissable banner component that prompts unverified users to verify their email address.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/EmailVerificationBanner.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_EMAIL_BANNER-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main exported component that renders the email verification banner with send/refresh",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/EmailVerificationBanner.tsx",
        "functionName": "EmailVerificationBanner"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_EMAIL_BANNER-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Triggers the verification email send flow with loading state and result feedback.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/EmailVerificationBanner.tsx",
        "functionName": "handleSendVerification"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_EMAIL_BANNER-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Refreshes the email verification status by reloading the Firebase Auth user.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/EmailVerificationBanner.tsx",
        "functionName": "handleRefresh"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_OAUTH_ICONS-000",
      "version": 3,
      "logic_category": "PRESENTATION",
      "description": "SVG icon components for Google and Apple sign-in buttons. Match lucide-react API (className, size props) for consistent use with Button components.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/icons/OAuthIcons.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_OAUTH_ICONS-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Google \"G\" logo SVG matching the official brand colour palette.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/icons/OAuthIcons.tsx",
        "functionName": "GoogleIcon"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_OAUTH_ICONS-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Apple logo SVG in currentColor for theme compatibility.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/icons/OAuthIcons.tsx",
        "functionName": "AppleIcon"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "PredictionEditor component: the core prediction interface where users select, reorder, and submit their top-6 driver predictions for a race. Also provides AI-powered analysis with configurable weights, countdown timer, apply-to-all-teams option, and a change log.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Configuration array defining the 11 AI analysis facets (9 data-driven + 2 personality-driven). Each facet has a key matching AnalysisWeights, a display label, icon emoji, and description.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Default weight values for each AI analysis facet. Data facets default to 7, personality facets to 5.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "DEFAULT_WEIGHTS"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Maximum total weight budget (11 facets x 7 = 77). Enforces a constraint so users must trade off emphasis between facets.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Props interface for PredictionEditor. Receives driver list, lock state, initial predictions, race metadata, team info, and circuit name.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main PredictionEditor component. Manages prediction grid state, countdown timer, submission flow, AI analysis, and change history.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "PredictionEditor"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Load user's saved AI analysis weights from Firestore on mount. Overrides DEFAULT_WEIGHTS if the user has previously customised and saved their preferences.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Memoised calculation of the sum of all current weight values, used for budget enforcement and display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Countdown timer that updates every second, showing time remaining until qualifying (the prediction deadline). Displays days/hours/minutes/seconds format and shows \"CLOSED\" when past.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "updateCountdown"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Computed list of drivers not yet selected in the prediction grid, sorted alphabetically. Powers the \"Available Drivers\" panel.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "addChangeToHistory"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Appends a change description to the history log (max 5 entries). Optionally includes a timestamp for significant actions like submissions.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "addChangeToHistory"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Adds a driver to the first empty slot in the prediction grid. No-op if the grid is locked.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "handleAddDriver"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Removes a driver from a specific position in the prediction grid, setting that slot to null. No-op if the grid is locked.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "handleRemoveDriver"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Swaps a driver with the adjacent slot (up or down) to reorder predictions. No-op if locked or at grid boundary.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "handleMove"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-014",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Submits the prediction to the server via /api/submit-prediction. Supports multi-team submission when \"Apply to All\" is checked. Validates grid completeness and user authentication before sending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "handleSubmit"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-015",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Handles weight slider changes with budget enforcement. Caps the new value if it would exceed MAX_TOTAL_WEIGHT.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "handleWeightChange"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-016",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Resets all analysis weights back to DEFAULT_WEIGHTS values.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "resetWeights"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-017",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Persists the current AI analysis weights to the user's Firestore document. Fire-and-forget: failure is logged but not shown to the user.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "saveWeights"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-018",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Requests AI-powered race analysis from /api/ai/analysis with the current predictions and weights. Validates grid completeness first. Handles errors with correlation IDs and user-copyable error toasts per Golden Rule #1.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx",
        "functionName": "handleAnalysis"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_PREDICTION_EDITOR-019",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main render: two-column layout with prediction grid card (left/top) and sidebar (right/bottom) containing available drivers, change log, and AI analysis panel. Full-width AI result card spans below both columns when analysis is active.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/_components/PredictionEditor.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_SECURITY_UPGRADE-000",
      "version": 3,
      "logic_category": "PRESENTATION",
      "description": "Card component that prompts PIN-only users to link a Google or Apple account for improved security. Uses the AccountLinker facade to perform the upgrade. Displays idle, loading, success, and error states. via Firebase Auth. On success, onAuthStateChanged syncs providers to Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/SecurityUpgradeCard.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_SECURITY_UPGRADE-001",
      "version": 3,
      "logic_category": "PRESENTATION",
      "description": "Main exported component. Shows upgrade prompt for PIN-only users, with Google and Apple link buttons. Renders a success confirmation after linking. happens automatically via onAuthStateChanged in the background.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/SecurityUpgradeCard.tsx",
        "functionName": "SecurityUpgradeCard"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_SECURITY_UPGRADE-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Handle the upgrade action for a given provider.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/components/SecurityUpgradeCard.tsx",
        "functionName": "handleUpgrade"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_VERSION_HISTORY-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Developer-facing version history component that displays a timeline of git commits",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/dev/_components/VersionHistory.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_VERSION_HISTORY-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for a single commit entry matching the structure in commit-history.json.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/dev/_components/VersionHistory.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_VERSION_HISTORY-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main exported component that renders the version history card with commit timeline,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/dev/_components/VersionHistory.tsx",
        "functionName": "VersionHistory"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_VERSION_HISTORY-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Classifies a commit message into a display category (FEATURE, FIX, PERF, CHORE, UPDATE)",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/dev/_components/VersionHistory.tsx",
        "functionName": "getCommitType"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_VERSION_HISTORY-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Strips the conventional commit prefix (feat:, fix:, chore:, etc.) and version prefix",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/dev/_components/VersionHistory.tsx",
        "functionName": "cleanMessage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_WELCOME_CTA-000",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "Dismissible welcome CTA card for the dashboard. Encourages new users to visit the onboarding checklist at /onboarding. Persists dismiss state in localStorage.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/WelcomeCTA.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_WELCOME_CTA-001",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "localStorage key for persisting the dismissed state of the welcome CTA.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/WelcomeCTA.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_WELCOME_CTA-002",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "Main WelcomeCTA component. Shows a gradient-bordered card with shimmer effect that links to /onboarding. Fades in on mount and animates out on dismiss.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/WelcomeCTA.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "COMPONENT_WELCOME_CTA-003",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Dismiss handler \u2014 persists to localStorage and triggers exit animation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/_components/WelcomeCTA.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FEATURE_ACCOUNT_LINKER-000",
      "version": 3,
      "logic_category": "IO",
      "description": "Facade module for upgrading a PIN-only account to an OAuth-linked account. Wraps the authService linking functions into a single `upgradeToOAuth` call that resolves the correct provider and delegates to the appropriate linker. which add the provider to Firebase Auth providerData. The onAuthStateChanged listener in FirebaseProvider then syncs providers[] to Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/features/auth/AccountLinker.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FEATURE_ACCOUNT_LINKER-001",
      "version": 3,
      "logic_category": "PRESENTATION",
      "description": "Upgrade the current user's account by linking an OAuth provider. Accepts a providerId string ('google.com' or 'apple.com') and the Auth instance, then delegates to the correct authService linking function. Throws on failure so the caller can display the error message.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/features/auth/AccountLinker.ts",
        "functionName": "upgradeToOAuth"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Central Firebase context provider that manages authentication state, user profile data,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Defines the shape of user email notification preferences stored in Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Defines AI analysis weight sliders for race prediction assistance.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Extended user profile interface combining Firebase Auth identity with Firestore profile data.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Standard return type for all authentication operations (login, signup, PIN changes, etc.).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Full type definition for the Firebase context, exposing all Firebase services, user state,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "React context instance that holds the full Firebase state and auth operations.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "FirebaseContext"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Root provider component that initialises Firebase auth listener, manages user profile",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [
          "FIREBASE_PROVIDER-050",
          "FIREBASE_PROVIDER-051"
        ],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-008",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Sets up a two-layer real-time listener: (1) Firebase Auth state changes trigger",
      "security_notes": "Auth state race condition documented. firebaseUser may be set before user profile loads.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [
          "FIREBASE_PROVIDER-029",
          "FIREBASE_PROVIDER-030"
        ],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-009",
      "version": 5,
      "logic_category": "VALIDATION",
      "description": "Authenticates a user via server-side PIN verification API, then signs in using the",
      "security_notes": "No CSRF token sent with login POST. Relies on SameSite cookies and CORS. Inline correlation IDs replaced with generateClientCorrelationId().",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "login"
      },
      "errorProfile": {
        "throws": [
          "PX-1008",
          "PX-1007",
          "PX-1009",
          "PX-9001"
        ],
        "handles": [],
        "emits": {
          "PX-1008": {
            "key": "AUTH_SIGNIN_VERIFICATION_FAILED",
            "message": "Sign-in verification failed",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-1007": {
            "key": "AUTH_PERMISSION_DENIED",
            "message": "Permission denied",
            "severity": "error",
            "recovery": "Check Firestore security rules and user permissions.",
            "failureModes": [
              "Firestore rules deny access",
              "User role downgraded"
            ]
          },
          "PX-1009": {
            "key": "AUTH_LOGIN_TIMEOUT",
            "message": "Login verification timed out",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-010",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Registers a new user via server-side API (which uses Admin SDK for Firestore writes",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "signup"
      },
      "errorProfile": {
        "throws": [
          "PX-9002"
        ],
        "handles": [],
        "emits": {
          "PX-9002": {
            "key": "NETWORK_ERROR",
            "message": "Network error - please check your connection",
            "severity": "error",
            "recovery": "Check internet connection. Retry after a moment.",
            "failureModes": [
              "Client offline",
              "DNS resolution failure",
              "Server unreachable"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-011",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Admin-only operation to update a user's profile via server-side API. Handles both",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "updateUser"
      },
      "errorProfile": {
        "throws": [
          "PX-9002"
        ],
        "handles": [],
        "emits": {
          "PX-9002": {
            "key": "NETWORK_ERROR",
            "message": "Network error - please check your connection",
            "severity": "error",
            "recovery": "Check internet connection. Retry after a moment.",
            "failureModes": [
              "Client offline",
              "DNS resolution failure",
              "Server unreachable"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-012",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Admin-only operation to delete a user via server-side API. Removes both the Firestore",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "deleteUser"
      },
      "errorProfile": {
        "throws": [
          "PX-9002"
        ],
        "handles": [],
        "emits": {
          "PX-9002": {
            "key": "NETWORK_ERROR",
            "message": "Network error - please check your connection",
            "severity": "error",
            "recovery": "Check internet connection. Retry after a moment.",
            "failureModes": [
              "Client offline",
              "DNS resolution failure",
              "Server unreachable"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Allows the current authenticated user to create a secondary team via server-side API.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "addSecondaryTeam"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-014",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Signs out the current user, clears local state, and redirects to the login page.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "logout"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-015",
      "version": 5,
      "logic_category": "TRANSFORMATION",
      "description": "Initiates a server-side PIN reset for the given email address. The API generates a",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "resetPin"
      },
      "errorProfile": {
        "throws": [
          "PX-1006"
        ],
        "handles": [],
        "emits": {
          "PX-1006": {
            "key": "AUTH_PIN_RESET_FAILED",
            "message": "PIN reset failed",
            "severity": "error",
            "recovery": "Try again. If persistent, check Firebase Auth custom claims and user record.",
            "failureModes": [
              "Firebase Auth rate limiting",
              "User record locked"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-016",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Changes the current user's PIN (password) via Firebase Auth, clears the mustChangePin",
      "security_notes": "Raw e.message no longer returned to UI. Generic error message with PX code used instead.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "changePin"
      },
      "errorProfile": {
        "throws": [
          "PX-1006"
        ],
        "handles": [],
        "emits": {
          "PX-1006": {
            "key": "AUTH_PIN_RESET_FAILED",
            "message": "PIN reset failed",
            "severity": "error",
            "recovery": "Try again. If persistent, check Firebase Auth custom claims and user record.",
            "failureModes": [
              "Firebase Auth rate limiting",
              "User record locked"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-017",
      "version": 5,
      "logic_category": "VALIDATION",
      "description": "Sends a primary email verification via the custom Graph API endpoint (not Firebase's",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "sendVerificationEmail"
      },
      "errorProfile": {
        "throws": [
          "PX-3001"
        ],
        "handles": [],
        "emits": {
          "PX-3001": {
            "key": "EMAIL_SEND_FAILED",
            "message": "Failed to send email",
            "severity": "error",
            "recovery": "Check Microsoft Graph API credentials and sender email. Verify Azure AD token.",
            "failureModes": [
              "Azure AD token expired",
              "Sender email not configured",
              "Graph API rate limit"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-018",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Reloads the Firebase Auth user to check if email has been verified externally (e.g.,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "refreshEmailVerificationStatus"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-019",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Updates or removes the user's secondary email address via server-side API.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "updateSecondaryEmail"
      },
      "errorProfile": {
        "throws": [
          "PX-9002"
        ],
        "handles": [],
        "emits": {
          "PX-9002": {
            "key": "NETWORK_ERROR",
            "message": "Network error - please check your connection",
            "severity": "error",
            "recovery": "Check internet connection. Retry after a moment.",
            "failureModes": [
              "Client offline",
              "DNS resolution failure",
              "Server unreachable"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-020",
      "version": 5,
      "logic_category": "VALIDATION",
      "description": "Sends a verification email to the user's secondary email address via the dedicated",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "sendSecondaryVerificationEmail"
      },
      "errorProfile": {
        "throws": [
          "PX-3004",
          "PX-3001"
        ],
        "handles": [],
        "emits": {
          "PX-3004": {
            "key": "EMAIL_CONFIG_MISSING",
            "message": "Email service not configured",
            "severity": "error",
            "recovery": "Set GRAPH_* secrets in Firebase App Hosting. Grant access to backend.",
            "failureModes": [
              "Missing GRAPH_TENANT_ID",
              "Missing GRAPH_CLIENT_SECRET",
              "Secret not granted to backend"
            ]
          },
          "PX-3001": {
            "key": "EMAIL_SEND_FAILED",
            "message": "Failed to send email",
            "severity": "error",
            "recovery": "Check Microsoft Graph API credentials and sender email. Verify Azure AD token.",
            "failureModes": [
              "Azure AD token expired",
              "Sender email not configured",
              "Graph API rate limit"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-021",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Computed boolean that merges Firebase Auth and Firestore email verification status.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-022",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised context value object that bundles all Firebase services, user state, and",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-023",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Primary hook for accessing the full Firebase context. Throws if used outside the provider.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "useFirebase"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-024",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Convenience hook that extracts only auth-related fields and operations from the context.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "useAuth"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-025",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Typed hook that returns the Firestore instance, throwing if unavailable.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "useFirestore"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-026",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Typed hook that returns the FirebaseApp instance, throwing if unavailable.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "useFirebaseApp"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-027",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Typed hook that returns the Firebase Storage instance, throwing if unavailable.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "useStorage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-028",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Typed hook that returns the Firebase Functions instance, throwing if unavailable.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "useFunctions"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-029",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Sync provider list from Firebase Auth to Firestore on initial load. Also syncs photoUrl from Google/Apple if user has none set.",
      "dependencies": [
        "FIREBASE_PROVIDER-008"
      ],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": [
          "FIREBASE_PROVIDER-008"
        ]
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-030",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "When a Firebase Auth user exists but no Firestore doc is found, check if this is an OAuth user and redirect to /complete-profile.",
      "dependencies": [
        "FIREBASE_PROVIDER-008"
      ],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": [
          "FIREBASE_PROVIDER-008"
        ]
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-031",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Handle redirect results from OAuth flows (mobile sign-in and linking). Resolves pending credential after redirect-based OAuth flow.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-032",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Wrapper functions for OAuth sign-in and provider linking that call the authService module and manage pending credential state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "signInWithGoogle"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-050",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Link Google to current account and send confirmation email on success.",
      "dependencies": [
        "FIREBASE_PROVIDER-007"
      ],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "linkGoogle"
      },
      "callChain": {
        "calledBy": [],
        "calls": [
          "FIREBASE_PROVIDER-007"
        ]
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-051",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Link Apple to current account and send confirmation email on success.",
      "dependencies": [
        "FIREBASE_PROVIDER-007"
      ],
      "location": {
        "filePath": "app/src/firebase/provider.tsx",
        "functionName": "linkApple"
      },
      "callChain": {
        "calledBy": [],
        "calls": [
          "FIREBASE_PROVIDER-007"
        ]
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-060",
      "version": 3,
      "logic_category": "STATE_MANAGEMENT",
      "description": "State variables for logon session tracking: currentLogonId (tracks the active user_logons document ID for logout recording) and pendingLoginMethod (set before OAuth calls for method detection in onAuthStateChanged).",
      "dependencies": [
        "FIREBASE_PROVIDER-007"
      ],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "FIREBASE_PROVIDER-061",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Record logon event for OAuth logins in the onAuthStateChanged first snapshot. Fires when currentLogonId is null (OAuth path). Uses pendingLoginMethod or falls back to provider detection. Fire-and-forget \u00e2\u20ac\u201d does not block auth state resolution.",
      "dependencies": [
        "FIREBASE_PROVIDER-008",
        "API_AUTH_RECORD_LOGON-000"
      ],
      "location": {
        "filePath": "app/src/firebase/provider.tsx"
      },
      "callChain": {
        "calledBy": [
          "FIREBASE_PROVIDER-008"
        ],
        "calls": [
          "API_AUTH_RECORD_LOGON-000"
        ]
      },
      "errorProfile": {
        "throws": [
          "PX-6004"
        ],
        "handles": [],
        "emits": {
          "PX-6004": {
            "key": "LOGON_RECORD_FAILED",
            "message": "Failed to record logon event",
            "severity": "warning",
            "recovery": "Non-blocking \u00e2\u20ac\u201d OAuth login continues. Session will expire via scheduled function.",
            "failureModes": [
              "Token fetch failure",
              "Network error calling record-logon API"
            ]
          }
        }
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Attack detection system that identifies bot attacks, credential stuffing, and distributed login attacks against the authentication layer.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-001",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Defines numeric thresholds for each attack type (bot, credential stuffing, distributed) including attempt counts and time windows.",
      "security_notes": "Thresholds tightened: BOT 10->5, STUFFING 5->3 accounts, DISTRIBUTED 5->3 IPs / 8->5 failures.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts",
        "functionName": "ATTACK_THRESHOLDS"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-002",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Defines TypeScript types for attack classifications and severity levels used across the detection system and admin UI.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-003",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Defines the shape of a login attempt record stored in the login_attempts Firestore collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-004",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Defines the shape of an attack alert record stored in the attack_alerts Firestore collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-005",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Persists a login attempt (successful or failed) to the login_attempts Firestore collection for later analysis.",
      "security_notes": "Firestore write wrapped in try/catch to prevent login flow crash. Email normalized to lowercase before storage.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts",
        "functionName": "logLoginAttempt"
      },
      "callChain": {
        "calledBy": [
          "LIB_ATTACK_DETECTION-011"
        ],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-006",
      "version": 5,
      "logic_category": "VALIDATION",
      "description": "Orchestrates all three attack detection checks (bot, credential stuffing, distributed) and creates alerts for newly detected attacks, deduplicating against existing unacknowledged alerts.",
      "security_notes": "Email normalized to lowercase before passing to detection checks. Entire check wrapped in try/catch.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts",
        "functionName": "checkForAttack"
      },
      "errorProfile": {
        "throws": [
          "PX-8004"
        ],
        "handles": [],
        "emits": {
          "PX-8004": {
            "key": "ATTACK_CHECK_FAILED",
            "message": "Attack detection check failed",
            "severity": "error",
            "recovery": "Check attack-detection.ts. Login continues even if detection fails.",
            "failureModes": [
              "Query timeout on login_attempts",
              "Malformed query"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-007",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Detects bot attacks by counting failed login attempts from a single IP within the configured time window (10+ in 5 minutes).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts",
        "functionName": "checkBotAttack"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-008",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Detects credential stuffing by counting unique email addresses targeted from a single IP within the configured time window (5+ accounts in 5 minutes).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts",
        "functionName": "checkCredentialStuffing"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-009",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Detects distributed attacks by counting unique IPs targeting a single email with sufficient failures within the configured time window (5+ IPs and 8+ failures in 10 minutes).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts",
        "functionName": "checkDistributedAttack"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-010",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Persists a detected attack alert to the attack_alerts Firestore collection and logs a console warning for server-side monitoring.",
      "dependencies": [],
      "security_notes": "Wrapped in try/catch -- alert creation failure no longer crashes the login flow.",
      "location": {
        "filePath": "app/src/lib/attack-detection.ts",
        "functionName": "createAttackAlert"
      },
      "errorProfile": {
        "throws": [
          "PX-8002"
        ],
        "handles": [],
        "emits": {
          "PX-8002": {
            "key": "ATTACK_ALERT_FAILED",
            "message": "Failed to create attack alert",
            "severity": "error",
            "recovery": "Check attack_alerts collection permissions. Non-blocking.",
            "failureModes": [
              "Firestore write permission denied"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ATTACK_DETECTION-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Normalize email to lowercase before storing login attempt to ensure consistent querying in detection functions.",
      "dependencies": [
        "LIB_ATTACK_DETECTION-005"
      ],
      "location": {
        "filePath": "app/src/lib/attack-detection.ts"
      },
      "errorProfile": {
        "throws": [
          "PX-8003"
        ],
        "handles": [],
        "emits": {
          "PX-8003": {
            "key": "ATTACK_LOG_WRITE_FAILED",
            "message": "Failed to write login attempt to database",
            "severity": "error",
            "recovery": "Check Firestore connectivity. Login continues even if logging fails.",
            "failureModes": [
              "Network timeout",
              "Firestore unavailable"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": [
          "LIB_ATTACK_DETECTION-005"
        ]
      }
    },
    {
      "guid": "LIB_AUDIT-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Client-side audit logging module providing session correlation IDs, Firestore audit event logging, automatic navigation tracking, and permission error reporting.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/audit.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_AUDIT-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Module-level singleton storing the session correlation ID, ensuring all audit events within a single browser session share the same traceable identifier.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/audit.ts",
        "functionName": "generateGuid"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_AUDIT-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generates a RFC 4122 v4 GUID string using Math.random for use as session correlation IDs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/audit.ts",
        "functionName": "generateGuid"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_AUDIT-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Returns the current session's correlation ID, lazily generating one on first access to ensure all audit events in a session are linkable.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/audit.ts",
        "functionName": "getCorrelationId"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_AUDIT-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Module-level flag intended to control whether audit logging is enabled, allowing future integration with a global configuration system.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/audit.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_AUDIT-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Writes an audit event to the audit_logs Firestore collection as a fire-and-forget operation, attaching user ID, action description, details, correlation ID, and server timestamp.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/audit.ts",
        "functionName": "logAuditEvent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_AUDIT-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "React hook that automatically logs page navigation events to the audit trail, distinguishing between initial page load and subsequent route changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/audit.ts",
        "functionName": "useAuditNavigation"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_AUDIT-007",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Logs Firestore permission errors to console only (not to Firestore) to avoid circular permission failures when the user lacks write access to audit_logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/audit.ts",
        "functionName": "logPermissionError"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-000",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Central consistency-checking library for the Prix Six application.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "returns"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Define the set of domain categories that consistency checks cover.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "and"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-002",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Severity levels for individual issues found during consistency checks.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "based"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Overall status of a single category check, derived from the worst severity among its issues.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "based"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Represents a single validation issue found during a consistency check.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "when"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Aggregate counts of each scoring type across all validated scores.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Standard return type for every consistency check function.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-007",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Top-level summary of all consistency checks run in a single audit session.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-008",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Lightweight representation of a user record for consistency validation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-009",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Lightweight representation of a prediction record for consistency validation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-010",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Lightweight representation of an official race result for consistency validation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-011",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Lightweight representation of a score record for consistency validation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-012",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Lightweight representation of a league record for consistency validation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-013",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Simple email format validation regex. Checks for non-whitespace characters",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-014",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a unique correlation ID for a consistency check audit session.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "generateConsistencyCorrelationId"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-015",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Normalize a race name or ID to a canonical lowercase-hyphenated format.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "normalizeRaceId"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-016",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Build a Set of all valid driver IDs from the static F1Drivers reference data.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "getValidDriverIds"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-017",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Build a Set of all valid race names from the static RaceSchedule reference data.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "needing"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-018",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Build a Set of all valid race IDs in normalized form (lowercase, hyphenated)",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "to"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-019",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Validate the entire users collection for data integrity. Checks:",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-020",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate the static F1Drivers array from data.ts for completeness and uniqueness.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "checkDrivers"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-021",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate the static RaceSchedule array from data.ts for completeness and correctness.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "checkRaces"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-022",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Helper function to validate whether a given ID represents a valid user",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "to"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-023",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate all prediction documents for structural integrity and referential",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-024",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that all registered teams (both primary and secondary) have at",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "checkTeamCoverage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-025",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Validate all race result documents for structural integrity. Checks:",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "checkRaceResults"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-026",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Local scoring constants derived from the shared scoring-rules.ts module.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-027",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Recalculate the expected score for a single prediction against a race result,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "intentionally"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-028",
      "version": 7,
      "logic_category": "VALIDATION",
      "description": "The most comprehensive check function. Validates all score documents against race results and predictions. predictionMap stores PredictionData[] per key to handle Sprint/GP prediction collisions. v07 adds comprehensive double cross-check: breakdown math verification, ghost point detection, per-driver point accuracy (reverse Team\u00e2\u2020\u2019Admin), forward Admin\u00e2\u2020\u2019Team check, and bonus verification.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-029",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Validate that standings (cumulative points per user) are internally consistent.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "checkStandings"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-030",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Validate all league documents for structural integrity and referential",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_CONSISTENCY-031",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Aggregate all individual CheckResult objects into a single ConsistencyCheckSummary.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/consistency.ts",
        "functionName": "generateSummary"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Provides standing data for F1 drivers and race schedule used throughout the app.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Define the shape of a Driver object used across the application.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Master list of all F1 drivers for the 2026 season with their team assignments,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Resolve a driver ID to their profile image URL via the placeholder images lookup.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts",
        "functionName": "getDriverImage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Resolve a driver ID (lowercase) to their display name (proper case).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts",
        "functionName": "getDriverName"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Derive a 3-letter uppercase code from a driver ID (e.g., \"hamilton\" -> \"HAM\").",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts",
        "functionName": "getDriverCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Convert an array of driver IDs into a comma-separated string of display names.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts",
        "functionName": "formatDriverPredictions"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Define the shape of a Race object including timing, location, sprint flag, and results.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Master race calendar for the 2026 F1 season (24 races). Defines qualifying deadlines",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_DATA-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Find the next upcoming race based on the current date by comparing qualifying times.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/data.ts",
        "functionName": "findNextRace"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Server-side email sending module using Microsoft Graph API via Azure AD credentials. Provides welcome emails and generic email dispatch with rate-limiting, queuing, and Firestore logging.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Initialise and return a Firebase Admin Firestore instance for server-side email logging. Uses service account credentials if available, otherwise falls back to default project initialisation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts",
        "functionName": "getAdminDb"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-002",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Admin email address constant used as the default sender fallback.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts",
        "functionName": "generateGuid"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a RFC 4122 v4-style GUID for uniquely identifying each email sent, enabling tracking and audit trail lookup.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts",
        "functionName": "generateGuid"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Create and return an authenticated Microsoft Graph API client using Azure AD client credentials (tenant ID, client ID, client secret). This client is used to send emails via the Graph /sendMail endpoint.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts",
        "functionName": "getGraphClient"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for the result returned by email-sending functions, indicating success/failure, the tracking GUID, optional error detail, and whether the email was queued due to rate limiting.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-006",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for the parameters required to send a welcome email, including recipient, team name, PIN, and optional Firestore instance for rate-limit tracking.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-007",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Send a branded welcome email to a newly registered user containing their team name and 6-digit PIN. Enforces rate limiting via email-tracking, queues if rate-limited, logs success/failure to email_logs collection, and returns a tracking GUID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts",
        "functionName": "sendWelcomeEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-008",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for generic email parameters (recipient, subject, HTML content) used by the general-purpose sendEmail function.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts",
        "functionName": "sendEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL-009",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Send a generic email with arbitrary HTML content via Microsoft Graph API. Appends a standard footer with tracking GUID and Prix Six branding. Logs success/failure to email_logs collection for admin audit.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email.ts",
        "functionName": "sendEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Client-side email tracking and rate-limiting module. Manages daily email statistics, enforces global and per-address send limits, provides email queuing for rate-limited messages, and generates daily summary HTML reports.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Rate-limit constants defining the maximum number of emails allowed per day globally and per individual recipient address.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for daily email statistics stored in the email_daily_stats Firestore collection, tracking total sent count, individual email log entries, and whether the daily summary has been dispatched.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for an individual email log entry within the daily stats, capturing recipient, subject, type, team, tracking GUID, timestamp, and delivery status.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for a queued email document stored in the email_queue Firestore collection when rate limits prevent immediate sending.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Return today's date as a YYYY-MM-DD string for use as the Firestore document ID in email_daily_stats.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "getTodayDateString"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Retrieve or create the daily email statistics document for today from the email_daily_stats Firestore collection. If no document exists for today, initialises one with zero counts.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "getDailyStats"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Count how many emails have been sent to a specific email address today, using case-insensitive matching against the daily stats log.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "getEmailCountForAddress"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Check whether the system is allowed to send an email to the given address by validating against the daily global limit and per-address limit. The admin email is exempt from per-address limits.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "canSendEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Record a successfully sent email in today's daily stats document by incrementing the total count and appending the log entry to the emailsSent array.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "recordSentEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-010",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Queue an email for later sending when rate limits prevent immediate dispatch. Creates a document in the email_queue Firestore collection with pending status.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "queueEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Retrieve the list of all email log entries recorded in today's daily stats, for use in generating the daily summary report.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "getTodayEmailList"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Mark the daily summary email as sent in today's stats document to prevent duplicate summary emails within the same day.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "markSummarySent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Check whether the daily summary email has already been sent today, to prevent duplicate summaries.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "isSummarySent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-014",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Retrieve all pending queued emails from the email_queue Firestore collection for batch processing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "or"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-015",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Update the status of a queued email document after processing (sent or failed), recording the processing timestamp and optional error message.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "updateQueuedEmailStatus"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_EMAIL_TRACKING-016",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a styled HTML email body for the daily email summary report, showing counts of sent, queued, and failed emails in a table format with statistics boxes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/email-tracking.ts",
        "functionName": "generateDailySummaryHtml"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ERROR_CODES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Central error code registry and error handling utilities for the Prix Six application.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/error-codes.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ERROR_CODES-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Master registry of all application error codes organised by category.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/error-codes.ts"
      },
      "errorProfile": {
        "throws": [
          "PX-1001",
          "PX-1002",
          "PX-1003",
          "PX-1004",
          "PX-1005",
          "PX-1006",
          "PX-1007",
          "PX-1010",
          "PX-1011",
          "PX-1012",
          "PX-1013",
          "PX-1014",
          "PX-1015",
          "PX-1016",
          "PX-1017",
          "PX-1008",
          "PX-1009",
          "PX-2001",
          "PX-2002",
          "PX-2003",
          "PX-2004",
          "PX-2005",
          "PX-2010",
          "PX-2011",
          "PX-3001",
          "PX-3002",
          "PX-3003",
          "PX-3004",
          "PX-3101",
          "PX-3201",
          "PX-3202",
          "PX-3203",
          "PX-4001",
          "PX-4002",
          "PX-4003",
          "PX-4004",
          "PX-4005",
          "PX-5001",
          "PX-5002",
          "PX-5003",
          "PX-5004",
          "PX-5005",
          "PX-5006",
          "PX-5007",
          "PX-5008",
          "PX-5009",
          "PX-6001",
          "PX-6002",
          "PX-6003"
        ],
        "handles": [],
        "emits": {
          "PX-1001": {
            "key": "AUTH_INVALID_TOKEN",
            "message": "Invalid or missing authentication token",
            "severity": "error",
            "recovery": "User should log out and log in again. Check token expiry.",
            "failureModes": [
              "Token expired",
              "Token malformed",
              "Clock skew between client and server"
            ]
          },
          "PX-1002": {
            "key": "AUTH_ADMIN_REQUIRED",
            "message": "Admin access required",
            "severity": "error",
            "recovery": "Verify user has isAdmin: true in Firestore users collection.",
            "failureModes": [
              "User document missing isAdmin field",
              "isAdmin set to false"
            ]
          },
          "PX-1003": {
            "key": "AUTH_USER_NOT_FOUND",
            "message": "User not found",
            "severity": "error",
            "recovery": "Check users collection for the UID. May need to re-create profile.",
            "failureModes": [
              "User deleted from Firestore but still in Firebase Auth",
              "UID mismatch"
            ]
          },
          "PX-1004": {
            "key": "AUTH_SESSION_EXPIRED",
            "message": "Session expired - please log in again",
            "severity": "error",
            "recovery": "Redirect to login page. Clear local auth state.",
            "failureModes": [
              "Session cookie expired",
              "Server restarted"
            ]
          },
          "PX-1005": {
            "key": "AUTH_DOMAIN_NOT_ALLOWED",
            "message": "Domain not allowlisted for email verification",
            "severity": "error",
            "recovery": "Add the domain to Firebase Auth authorized domains list.",
            "failureModes": [
              "New domain not added to Firebase Console",
              "Typo in domain"
            ]
          },
          "PX-1006": {
            "key": "AUTH_PIN_RESET_FAILED",
            "message": "PIN reset failed",
            "severity": "error",
            "recovery": "Try again. If persistent, check Firebase Auth custom claims and user record.",
            "failureModes": [
              "Firebase Auth rate limiting",
              "User record locked"
            ]
          },
          "PX-1007": {
            "key": "AUTH_PERMISSION_DENIED",
            "message": "Permission denied",
            "severity": "error",
            "recovery": "Check Firestore security rules and user permissions.",
            "failureModes": [
              "Firestore rules deny access",
              "User role downgraded"
            ]
          },
          "PX-1010": {
            "key": "AUTH_OAUTH_POPUP_BLOCKED",
            "message": "Sign-in popup was blocked by the browser",
            "severity": "error",
            "recovery": "User should allow popups for prix6.win in browser settings.",
            "failureModes": [
              "Browser popup blocker active",
              "Ad blocker interfering"
            ]
          },
          "PX-1011": {
            "key": "AUTH_OAUTH_POPUP_CLOSED",
            "message": "Sign-in popup was closed before completing",
            "severity": "error",
            "recovery": "User should retry and complete the sign-in flow without closing the popup.",
            "failureModes": [
              "User manually closed popup",
              "Popup timeout"
            ]
          },
          "PX-1012": {
            "key": "AUTH_OAUTH_ACCOUNT_EXISTS",
            "message": "An account already exists with a different sign-in method",
            "severity": "error",
            "recovery": "User should sign in with their original method first, then link the new provider.",
            "failureModes": [
              "Email already registered via different OAuth provider",
              "Email/PIN account exists"
            ]
          },
          "PX-1013": {
            "key": "AUTH_OAUTH_LINK_FAILED",
            "message": "Failed to link sign-in provider",
            "severity": "error",
            "recovery": "Sign out, sign in with original provider, then try linking again.",
            "failureModes": [
              "Provider linking conflict",
              "Token expired during linking"
            ]
          },
          "PX-1014": {
            "key": "AUTH_OAUTH_REDIRECT_FAILED",
            "message": "Sign-in redirect failed",
            "severity": "error",
            "recovery": "Try popup-based sign-in instead. Check browser compatibility.",
            "failureModes": [
              "Browser does not support redirect flow",
              "Network interruption during redirect"
            ]
          },
          "PX-1015": {
            "key": "AUTH_OAUTH_APPLE_NONCE",
            "message": "Apple sign-in nonce verification failed",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-1016": {
            "key": "AUTH_OAUTH_PROFILE_INCOMPLETE",
            "message": "Profile incomplete \u00e2\u20ac\u201d please enter your team name",
            "severity": "error",
            "recovery": "User needs to complete their profile (enter team name) to continue.",
            "failureModes": [
              "OAuth profile missing display name",
              "First-time OAuth user"
            ]
          },
          "PX-1017": {
            "key": "AUTH_OAUTH_PROVIDER_ERROR",
            "message": "Sign-in provider error",
            "severity": "error",
            "recovery": "Try a different sign-in method or retry later.",
            "failureModes": [
              "OAuth provider outage",
              "Invalid OAuth configuration"
            ]
          },
          "PX-1008": {
            "key": "AUTH_SIGNIN_VERIFICATION_FAILED",
            "message": "Sign-in verification failed",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-1009": {
            "key": "AUTH_LOGIN_TIMEOUT",
            "message": "Login verification timed out",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-2001": {
            "key": "VALIDATION_MISSING_FIELDS",
            "message": "Missing required fields",
            "severity": "warning",
            "recovery": "Check request body includes all required fields.",
            "failureModes": [
              "Missing raceId",
              "Missing userId",
              "Empty request body"
            ]
          },
          "PX-2002": {
            "key": "VALIDATION_INVALID_FORMAT",
            "message": "Invalid data format",
            "severity": "warning",
            "recovery": "Validate input format matches expected schema.",
            "failureModes": [
              "Invalid date format",
              "Malformed JSON",
              "Wrong field types"
            ]
          },
          "PX-2003": {
            "key": "VALIDATION_DUPLICATE_ENTRY",
            "message": "Duplicate entry detected",
            "severity": "warning",
            "recovery": "Check for existing entries before submitting.",
            "failureModes": [
              "Duplicate prediction submission",
              "Race scored twice"
            ]
          },
          "PX-2004": {
            "key": "VALIDATION_SECONDARY_EMAIL_SAME",
            "message": "Secondary email cannot be the same as primary email",
            "severity": "warning",
            "recovery": "",
            "failureModes": []
          },
          "PX-2005": {
            "key": "VALIDATION_SECONDARY_EMAIL_IN_USE",
            "message": "This email is already in use",
            "severity": "warning",
            "recovery": "",
            "failureModes": []
          },
          "PX-2010": {
            "key": "VALIDATION_NULL_DRIVER",
            "message": "Race result contains null or empty driver",
            "severity": "warning",
            "recovery": "Verify race results have no null/empty drivers. Check admin entry.",
            "failureModes": [
              "Admin submitted partial results",
              "Data corruption in race results"
            ]
          },
          "PX-2011": {
            "key": "VALIDATION_DUPLICATE_DRIVER",
            "message": "Race result contains duplicate drivers",
            "severity": "warning",
            "recovery": "Verify race results have no duplicate drivers. Check admin entry.",
            "failureModes": [
              "Same driver entered twice",
              "Copy-paste error in results"
            ]
          },
          "PX-3001": {
            "key": "EMAIL_SEND_FAILED",
            "message": "Failed to send email",
            "severity": "error",
            "recovery": "Check Microsoft Graph API credentials and sender email. Verify Azure AD token.",
            "failureModes": [
              "Azure AD token expired",
              "Sender email not configured",
              "Graph API rate limit"
            ]
          },
          "PX-3002": {
            "key": "EMAIL_RATE_LIMITED",
            "message": "Email rate limit exceeded",
            "severity": "error",
            "recovery": "Wait before retrying. Check rate limit window in email-tracking.ts.",
            "failureModes": [
              "Too many emails in short window",
              "Per-recipient limit reached"
            ]
          },
          "PX-3003": {
            "key": "EMAIL_DAILY_LIMIT",
            "message": "Daily email limit reached",
            "severity": "error",
            "recovery": "Wait 24 hours for daily limit to reset. Check EMAIL_DAILY_LIMIT constant.",
            "failureModes": [
              "Daily email quota exhausted"
            ]
          },
          "PX-3004": {
            "key": "EMAIL_CONFIG_MISSING",
            "message": "Email service not configured",
            "severity": "error",
            "recovery": "Set GRAPH_* secrets in Firebase App Hosting. Grant access to backend.",
            "failureModes": [
              "Missing GRAPH_TENANT_ID",
              "Missing GRAPH_CLIENT_SECRET",
              "Secret not granted to backend"
            ]
          },
          "PX-3101": {
            "key": "AI_GENERATION_FAILED",
            "message": "AI content generation failed",
            "severity": "error",
            "recovery": "Check AI API key and quota. May need to retry.",
            "failureModes": [
              "AI API rate limited",
              "Invalid API key",
              "Model unavailable"
            ]
          },
          "PX-3201": {
            "key": "OPENF1_FETCH_FAILED",
            "message": "OpenF1 API request failed",
            "severity": "error",
            "recovery": "Check OpenF1 API status. May be race weekend outage.",
            "failureModes": [
              "OpenF1 API down",
              "Network timeout",
              "Invalid session key"
            ]
          },
          "PX-3202": {
            "key": "OPENF1_NO_DATA",
            "message": "No timing data returned from OpenF1",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-3203": {
            "key": "OPENF1_PARSE_FAILED",
            "message": "Failed to parse OpenF1 response",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-4001": {
            "key": "FIRESTORE_READ_FAILED",
            "message": "Failed to read from database",
            "severity": "error",
            "recovery": "Check Firestore connectivity and security rules.",
            "failureModes": [
              "Network timeout",
              "Permission denied",
              "Collection does not exist"
            ]
          },
          "PX-4002": {
            "key": "FIRESTORE_WRITE_FAILED",
            "message": "Failed to write to database",
            "severity": "error",
            "recovery": "Check Firestore write permissions and document size limits.",
            "failureModes": [
              "Permission denied",
              "Document too large",
              "Rate limited"
            ]
          },
          "PX-4003": {
            "key": "FIRESTORE_BATCH_FAILED",
            "message": "Batch operation failed",
            "severity": "error",
            "recovery": "Reduce batch size or retry. Check for document conflicts.",
            "failureModes": [
              "Batch exceeds 500 operations",
              "Contention on hot documents"
            ]
          },
          "PX-4004": {
            "key": "FIRESTORE_INDEX_REQUIRED",
            "message": "Database index required",
            "severity": "error",
            "recovery": "Create the required composite index in Firebase Console.",
            "failureModes": [
              "Missing composite index for query"
            ]
          },
          "PX-4005": {
            "key": "FIRESTORE_COLLECTION_GROUP_FAILED",
            "message": "Collection group query failed",
            "severity": "error",
            "recovery": "Verify collectionGroup index exists for the queried collection.",
            "failureModes": [
              "Missing collectionGroup index",
              "Permission denied on subcollections"
            ]
          },
          "PX-5001": {
            "key": "RACE_NOT_FOUND",
            "message": "Race not found",
            "severity": "error",
            "recovery": "Verify race ID exists in the races collection.",
            "failureModes": [
              "Race ID typo",
              "Race not yet created",
              "Race deleted"
            ]
          },
          "PX-5002": {
            "key": "RACE_ALREADY_SUBMITTED",
            "message": "Race results already submitted",
            "severity": "error",
            "recovery": "Use delete-scores to remove existing results before re-scoring.",
            "failureModes": [
              "Admin submitted results twice without deleting first"
            ]
          },
          "PX-5003": {
            "key": "SCORE_CALCULATION_FAILED",
            "message": "Score calculation failed",
            "severity": "error",
            "recovery": "Check scoring.ts for validation errors. Review race results data.",
            "failureModes": [
              "Invalid race results",
              "Missing prediction data",
              "Scoring rule mismatch"
            ]
          },
          "PX-5004": {
            "key": "PREDICTION_LOCKED",
            "message": "Predictions are locked for this race",
            "severity": "error",
            "recovery": "Wait for the next race or contact admin if deadline is wrong.",
            "failureModes": [
              "Race deadline passed",
              "Race already scored"
            ]
          },
          "PX-5005": {
            "key": "PREDICTION_INCOMPLETE",
            "message": "Prediction is incomplete",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-5006": {
            "key": "SCORE_WRITE_FAILED",
            "message": "Failed to write score to database",
            "severity": "error",
            "recovery": "Retry score submission. Check Firestore write permissions.",
            "failureModes": [
              "Firestore write permission denied",
              "Network timeout during write"
            ]
          },
          "PX-5007": {
            "key": "SCORE_DELETE_FAILED",
            "message": "Failed to delete score from database",
            "severity": "error",
            "recovery": "Retry deletion. Check admin permissions.",
            "failureModes": [
              "Firestore delete permission denied",
              "Score document already deleted"
            ]
          },
          "PX-5008": {
            "key": "SCORE_STANDINGS_FAILED",
            "message": "Failed to calculate standings",
            "severity": "error",
            "recovery": "Check standings calculation logic. Verify all scores exist.",
            "failureModes": [
              "Missing scores for some users",
              "Corrupt score data"
            ]
          },
          "PX-5009": {
            "key": "SCORE_USER_LOOKUP_FAILED",
            "message": "Failed to look up user data during scoring",
            "severity": "error",
            "recovery": "Check users collection. User may have been deleted.",
            "failureModes": [
              "User document missing",
              "UID mismatch between scores and users"
            ]
          },
          "PX-6001": {
            "key": "SESSION_INVALID",
            "message": "Invalid session",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-6002": {
            "key": "SESSION_TIMEOUT",
            "message": "Session timed out due to inactivity",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          },
          "PX-6003": {
            "key": "SESSION_CONFLICT",
            "message": "Session conflict detected",
            "severity": "error",
            "recovery": "",
            "failureModes": []
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ERROR_CODES-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Derive a union type of all valid error code keys for type-safe error code references.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/error-codes.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ERROR_CODES-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Define the shape of a structured application error with all four pillars",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/error-codes.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ERROR_CODES-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a unique client-side correlation ID for error tracking.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/error-codes.ts",
        "functionName": "generateClientCorrelationId"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ERROR_CODES-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Factory function to create a fully populated AppError object from an error code key,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/error-codes.ts",
        "functionName": "to"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ERROR_CODES-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Format an AppError into title, description, and copyable text for UI display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/error-codes.ts",
        "functionName": "formatErrorForDisplay"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_ERROR_CODES-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Heuristically map a raw error message string to the most appropriate ErrorCode key.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/error-codes.ts",
        "functionName": "mapErrorToCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FILE_UPLOAD-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Client-side file upload utility module for profile photo management. Provides image validation, upload with progress tracking to Firebase Storage, deletion of old photos, and client-side image compression using canvas.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/file-upload.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FILE_UPLOAD-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Constants defining the allowed image MIME types and maximum file size (5MB) for profile photo uploads.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/file-upload.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FILE_UPLOAD-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for the result of file validation, indicating whether the file passes constraints and an optional error message if not.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/file-upload.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FILE_UPLOAD-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for upload progress state, providing a percentage (0-100) and a state indicator used to update the UI progress bar.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/file-upload.ts",
        "functionName": "validateImageFile"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FILE_UPLOAD-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Validate a File object against allowed MIME types and maximum file size before attempting upload. Returns a ValidationResult indicating pass/fail with a user-friendly error message.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/file-upload.ts",
        "functionName": "validateImageFile"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FILE_UPLOAD-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Upload a profile photo to Firebase Storage under profile-photos/{userId}/{timestamp}.{ext}, with real-time progress reporting via an optional callback. Validates the file first, then uses resumable upload for reliability.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/file-upload.ts",
        "functionName": "uploadProfilePhoto"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FILE_UPLOAD-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Delete a profile photo from Firebase Storage by extracting the storage path from the download URL and calling deleteObject. Silently fails if the photo does not exist or the URL is external, as this is a best-effort cleanup.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/file-upload.ts",
        "functionName": "deleteProfilePhoto"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FILE_UPLOAD-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Compress an image file client-side by resizing it to a maximum width (default 400px) while maintaining aspect ratio, and re-encoding as JPEG at a configurable quality level (default 0.8). Uses HTML5 Canvas for image manipulation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/file-upload.ts",
        "functionName": "compressImage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FIREBASE_ADMIN-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Server-side Firebase Admin SDK initialisation and shared utilities for authentication verification, correlation ID generation, and centralised error logging.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/firebase-admin.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FIREBASE_ADMIN-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Module-level singleton cache for the Firebase Admin SDK app, Firestore instance, FieldValue, and Timestamp to avoid re-initialisation on every request.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/firebase-admin.ts",
        "functionName": "getFirebaseAdmin"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FIREBASE_ADMIN-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Lazily initialises the Firebase Admin SDK (choosing between explicit service account credentials for local dev or Application Default Credentials for Google Cloud) and returns the Firestore instance, FieldValue, and Timestamp utilities.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/firebase-admin.ts",
        "functionName": "getFirebaseAdmin"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FIREBASE_ADMIN-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Verifies a Firebase ID token from an Authorization header and returns the decoded user identity (uid and email), or null if invalid/missing.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/firebase-admin.ts",
        "functionName": "verifyAuthToken"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FIREBASE_ADMIN-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generates a unique correlation ID for error tracking, combining a base-36 timestamp with a random suffix to ensure uniqueness.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/firebase-admin.ts",
        "functionName": "generateCorrelationId"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_FIREBASE_ADMIN-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Persists error details (message, stack trace, context, correlation ID) to the error_logs Firestore collection for centralised error tracking and debugging.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/firebase-admin.ts",
        "functionName": "fails"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Client-side league management module providing CRUD operations for custom leagues. Handles league creation, joining via invite codes, leaving, member removal, renaming, invite code regeneration, and deletion. All operations interact with the leagues Firestore collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a cryptographically random invite code of INVITE_CODE_LENGTH characters using an alphabet that excludes visually ambiguous characters (I, O, 0, 1) to reduce user input errors.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "generateInviteCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Create a new custom league in Firestore with the requesting user as owner and sole initial member. Enforces the maximum leagues-per-user limit before creation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "createLeague"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Join an existing league by looking up its invite code (case-insensitive), validating membership limits and duplicate membership, then adding the user's team ID to the league's memberUserIds array.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "joinLeagueByCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Remove the requesting user from a league's memberUserIds array. Prevents leaving the global league and prevents the league owner from leaving (they must transfer ownership or delete instead).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "leaveLeague"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Query and return all leagues that contain the given userId (or teamId) in their memberUserIds array, using Firestore's array-contains query.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "getUserLeagues"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch a single league document by its Firestore document ID, returning null if not found.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "getLeague"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a new invite code for an existing league, replacing the old one. Only the league owner is authorised to perform this action, invalidating any previously shared invite codes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "regenerateInviteCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Update the display name of a league. Only the league owner is authorised to rename. Trims whitespace from the new name before saving.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "updateLeagueName"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Remove a specified member from a league's memberUserIds array. Only the league owner can remove members, and the owner cannot remove themselves.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "removeMember"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_LEAGUES-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Permanently delete a league document from Firestore. Only the league owner can delete, and the global league is protected from deletion.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/leagues.ts",
        "functionName": "deleteLeague"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_NORMALIZE_RACE_ID-000",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Single source of truth for race ID normalisation. Exports normalizeRaceId() (canonical, preserves case) and normalizeRaceIdForComparison() (lowercased, for cross-collection matching). Eliminates duplicated logic across scoring.ts, consistency.ts, calculate-scores/route.ts, delete-scores/route.ts, and ResultsManager.tsx.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/normalize-race-id.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_PLACEHOLDER_IMAGES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Provides typed access to driver placeholder image data loaded from a JSON file.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/placeholder-images.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_PLACEHOLDER_IMAGES-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Define the TypeScript shape for an image placeholder entry, ensuring type safety",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/placeholder-images.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_PLACEHOLDER_IMAGES-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Export the full array of placeholder images from the JSON catalogue, typed as ImagePlaceholder[].",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/placeholder-images.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-000",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Shared types, constants, and pure functions for race results display. Extracted from results/page.tsx so both /results and /my-results pages can share scoring display logic without duplication. to both pages simultaneously.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-001",
      "version": 1,
      "logic_category": "VALIDATION",
      "description": "Score type enum for colour-coded display \u2014 maps position difference to grade (A=exact, E=miss).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "ScoreType"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-002",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Type for a single driver within a team's prediction \u2014 includes predicted/actual positions, points scored, and the score type grade for colour coding.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "DriverPrediction"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-003",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Type for the official race result document \u2014 stores the actual top-6 driver finish order.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "RaceResult"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-004",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Type for a score document associated with a team's race performance.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "Score"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-005",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Type for a team's complete result for a race.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "TeamResult"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-006",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Type for a race event entry in the events list (GP or Sprint).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "RaceEvent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-007",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Build a flat list of all race events (GP + Sprint) from the RaceSchedule.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "buildRaceEvents"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-008",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "Module-level constant of all race events \u2014 avoids recomputation on every render.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "allRaceEvents"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-009",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Map a predicted vs actual position difference to a score type grade (A-E).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "getScoreType"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-010",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Map score type grades (A-E) to Tailwind CSS colour classes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "getScoreTypeColor"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-011",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Parse a team's raw predictions and compare against actual top-6 results to produce per-driver scoring with points and score types. Pure function \u2014 no hooks.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "parsePredictions"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-012",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Calculate bonus points \u2014 awards 10 points if all 6 predicted drivers are in the top 6.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "calculateBonus"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-013",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Calculate effective points for a team \u2014 uses stored score if available, otherwise calculates from predictions + bonus when race results exist.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "getEffectivePoints"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-014",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Format a Firestore timestamp into a human-readable UK date-time string.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "formatResultTimestamp"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-015",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Convert a full event ID (with -GP or -Sprint suffix) to the base race ID matching how predictions are stored in Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "getBaseRaceId"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_RESULTS_UTILS-016",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "Race rank badge component for 1st, 2nd, 3rd place finishers. Pure presentational.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/results-utils.tsx",
        "functionName": "RaceRankBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Orchestration module for race score calculation, persistence, and standings",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-001",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Define the shape of a race result document containing the top 6 finishing",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-002",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Define the shape of a user prediction document containing the raceId,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-003",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Normalise raceId strings to a consistent dash-separated format so that",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-004",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Core scoring engine: fetches all predictions for a given race from Firestore",
      "security_notes": "CollectionGroup failure now throws instead of silently returning empty results. Race result validation added for null/duplicate drivers.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts"
      },
      "errorProfile": {
        "throws": [
          "PX-2010",
          "PX-2011",
          "PX-4005"
        ],
        "handles": [],
        "emits": {
          "PX-2010": {
            "key": "VALIDATION_NULL_DRIVER",
            "message": "Race result contains null or empty driver",
            "severity": "warning",
            "recovery": "Verify race results have no null/empty drivers. Check admin entry.",
            "failureModes": [
              "Admin submitted partial results",
              "Data corruption in race results"
            ]
          },
          "PX-2011": {
            "key": "VALIDATION_DUPLICATE_DRIVER",
            "message": "Race result contains duplicate drivers",
            "severity": "warning",
            "recovery": "Verify race results have no duplicate drivers. Check admin entry.",
            "failureModes": [
              "Same driver entered twice",
              "Copy-paste error in results"
            ]
          },
          "PX-4005": {
            "key": "FIRESTORE_COLLECTION_GROUP_FAILED",
            "message": "Collection group query failed",
            "severity": "error",
            "recovery": "Verify collectionGroup index exists for the queried collection.",
            "failureModes": [
              "Missing collectionGroup index",
              "Permission denied on subcollections"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-005",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Define auxiliary TypeScript interfaces for the score-with-team-name",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-006",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "End-to-end orchestrator: calculates scores for a race, persists each",
      "security_notes": "Removed oduserId typo field from Firestore writes. Score write failures now throw with correlation ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts",
        "functionName": "updateRaceScores"
      },
      "errorProfile": {
        "throws": [
          "PX-5006"
        ],
        "handles": [],
        "emits": {
          "PX-5006": {
            "key": "SCORE_WRITE_FAILED",
            "message": "Failed to write score to database",
            "severity": "error",
            "recovery": "Retry score submission. Check Firestore write permissions.",
            "failureModes": [
              "Firestore write permission denied",
              "Network timeout during write"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-007",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Delete all score documents for a given race from the 'scores' collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts",
        "functionName": "deleteRaceScores"
      },
      "errorProfile": {
        "throws": [
          "PX-5007"
        ],
        "handles": [],
        "emits": {
          "PX-5007": {
            "key": "SCORE_DELETE_FAILED",
            "message": "Failed to delete score from database",
            "severity": "error",
            "recovery": "Retry deletion. Check admin permissions.",
            "failureModes": [
              "Firestore delete permission denied",
              "Score document already deleted"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING-008",
      "version": 4,
      "logic_category": "TRANSFORMATION",
      "description": "Format a RaceResult into a compact display string showing position numbers",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring.ts",
        "functionName": "formatRaceResultSummary"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING_RULES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Single source of truth for all Prix Six scoring constants, rule descriptions,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring-rules.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING_RULES-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Define the concrete point values for the hybrid position-based scoring system.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring-rules.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING_RULES-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Derive computed constants (max points per race, number of drivers) from",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring-rules.ts",
        "functionName": "SCORING_DERIVED"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING_RULES-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Calculate the points a single driver prediction earns based on the",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring-rules.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING_RULES-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Provide human-readable rule descriptions for display on the rules page.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring-rules.ts",
        "functionName": "SCORING_RULES"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING_RULES-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Provide human-readable gameplay rule descriptions for the rules page,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring-rules.ts",
        "functionName": "GAMEPLAY_RULES"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING_RULES-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Define the tiebreaker rule text for end-of-season standings disputes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring-rules.ts",
        "functionName": "TIEBREAKER_RULE"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_SCORING_RULES-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Export TypeScript types derived from the SCORING_RULES and GAMEPLAY_RULES",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/scoring-rules.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_TEAM_NAME_SUGGESTIONS-000",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Shared module for dynamic F1-themed team name suggestions. Contains a curated pool of ~150 funny names, a function to generate filtered suggestions, and email-match detection to nudge users away from using their email as their team name. signup and complete-profile pages.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/team-name-suggestions.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_TEAM_NAME_SUGGESTIONS-001",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Curated pool of ~150 F1 personality + pop culture mashup team names.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/team-name-suggestions.ts",
        "functionName": "TEAM_NAME_POOL"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_TEAM_NAME_SUGGESTIONS-002",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Shuffles the name pool, removes names already taken, and returns `count` suggestions.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/team-name-suggestions.ts",
        "functionName": "generateSuggestions"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_TEAM_NAME_SUGGESTIONS-003",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Detects if a team name appears to be derived from the user's email address. Uses normalised containment and token matching to catch common patterns like \"Aaron Garcia\" from \"aaron@garcia.ltd\" or \"aarongarcia\" from \"aaron.garcia@email.com\".",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/team-name-suggestions.ts",
        "functionName": "doesTeamNameMatchEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_TRACED_ERROR-000",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Error creation and logging utilities for the traced-error system. Creates errors from registry definitions (code.json), assigns correlation IDs, and logs to Firestore (server) or /api/log-client-error (client). Every traced error carries full diagnostic metadata. viewer, and user-facing error displays. Correlation ID format affects support workflows.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/traced-error.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_TRACED_ERROR-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Generate a unique correlation ID with a module-specific prefix for error tracking. Format: [prefix]_[timestamp-base36]_[random-6-chars] -- short, unique, and copyable. catch blocks that need a correlation ID before creating the traced error. Changing the format requires updating any log queries that parse correlation IDs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/traced-error.ts",
        "functionName": "generateCorrelationId"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_TRACED_ERROR-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Factory function that creates a TracedError from an ErrorDefinition (sourced from the error registry). Attaches correlation ID, runtime context, and timestamp. The resulting error object answers all four diagnostic questions when logged. to UI components for user-facing display with selectable text.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/traced-error.ts",
        "functionName": "createTracedError"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_TRACED_ERROR-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Logs a TracedError with full diagnostic metadata to Firestore (server-side) or to api/log-client-error (client-side). Also writes a structured console.error for local debugging. The log entry answers all four diagnostic questions. The admin ErrorLogViewer reads these entries. Console output aids local debugging.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/traced-error.ts",
        "functionName": "logTracedError"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_UTILS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Utility module providing CSS class name merging for Tailwind CSS.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/utils.ts",
        "functionName": "changes"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_UTILS-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Merge multiple CSS class values into a single string, resolving Tailwind CSS conflicts.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/utils.ts",
        "functionName": "cn"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_VERSION-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Single source of truth for the application version number displayed in the UI.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/version.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "LIB_VERSION-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Export the current application version string for UI display and build verification.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/lib/version.ts",
        "functionName": "APP_VERSION"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "About page: public-facing informational page explaining Prix Six, F1 basics, scoring rules, and app features. Also manages the cinematic intro sequence for first-time visitors.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definition for user presence documents stored in Firestore 'presence' collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Session timeout threshold (15 minutes) for determining whether a user session is still considered active.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "localStorage key for tracking whether the user has already seen the cinematic intro animation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx",
        "functionName": "AboutPageClient"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main client component for the About page. Manages intro display state, fetches live user/team data from Firestore, and renders all informational sections (how to play, features, F1 primer, scoring, support).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx",
        "functionName": "AboutPageClient"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Check localStorage on mount to decide if cinematic intro should play. Prevents rendering the page content until the check is complete to avoid a visual flash.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Callback invoked when the cinematic intro finishes or is skipped. Persists the \"seen\" flag to localStorage so the intro does not replay on future visits.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx",
        "functionName": "handleIntroComplete"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Allows the user to replay the cinematic intro by clicking the \"Watch Intro\" button.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx",
        "functionName": "handleReplayIntro"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Memoised Firestore query for all user documents. Used to compute the total teams count.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Memoised Firestore query for all presence documents. Used to compute the online user count.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-010",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Computes total team count including secondary teams. Each user counts as 1 team, plus 1 more if they have a secondaryTeamName.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-011",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Computes the number of currently online users by checking presence documents for active sessions within the SESSION_TIMEOUT_MS window.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-012",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main JSX render of the About page: hero section with version badge and replay button, live stat cards, \"How to Play\" guide, scoring breakdown, features grid, F1 primer for newcomers, and support contact section.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Default page export wrapping the client component. Required by Next.js App Router for the /about route.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx",
        "functionName": "AboutPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ABOUT-014",
      "version": 3,
      "logic_category": "PRESENTATION",
      "description": "Prominent Rules Discovery card linking to the full rules page. Styled with primary gradient border to stand out after the How to Play section.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ADMIN-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin panel page \u00e2\u20ac\u201d tabbed interface providing access to all league management tools.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ADMIN-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Import LeaguesManager for the 16th admin tab.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ADMIN-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Import AttackMonitor component for security monitoring displayed above the tabs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ADMIN-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main admin page component \u00e2\u20ac\u201d enforces admin-only access, fetches all users,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx",
        "functionName": "AdminPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ADMIN-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore query for all users \u00e2\u20ac\u201d only created when user is confirmed admin.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ADMIN-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Admin access guard \u00e2\u20ac\u201d redirects non-admin users to /dashboard and logs an",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ADMIN-006",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Loading/access-denied guard render \u00e2\u20ac\u201d shows \"Verifying access...\" while auth loads",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ADMIN-007",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Main admin panel render \u00e2\u20ac\u201d AttackMonitor at top, then 16-tab interface covering",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Submission audit page \u00e2\u20ac\u201d displays a paginated table of all prediction submissions",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Page size constant for paginated audit log queries.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interface for audit log entries \u00e2\u20ac\u201d defines the shape of prediction_submitted events.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main audit page component \u00e2\u20ac\u201d manages paginated audit log fetching, user lookup,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx",
        "functionName": "AuditPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Real-time query for all users \u00e2\u20ac\u201d provides team name lookup for audit log entries.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx",
        "functionName": "for"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Paginated fetch function for audit logs \u00e2\u20ac\u201d queries prediction_submitted events",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx",
        "functionName": "for"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Initial data load \u00e2\u20ac\u201d triggers fetchAuditLogs once when Firestore is ready.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx",
        "functionName": "handleLoadMore"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Load more button handler \u00e2\u20ac\u201d fetches the next page of audit logs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx",
        "functionName": "handleLoadMore"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-008",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Formats a Firestore timestamp (or date string) to en-GB locale string.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx",
        "functionName": "formatTimestamp"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-009",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Wrapper around formatDriverPredictions to convert driver ID arrays to display names.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx",
        "functionName": "formatPredictions"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_AUDIT-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Joins audit log entries with user data to resolve team names. Falls back to",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/audit/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_COMPLETE_PROFILE-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Profile completion page for new OAuth users. After signing in with Google/Apple for the first time, the user lands here to enter their team name before they can access the main app. The Firebase Auth user already exists; this page creates the Firestore user document via the /api/auth/complete-oauth-profile API. with no Firestore doc). it up, and the user is redirected to /dashboard.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/complete-profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_COMPLETE_PROFILE-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod schema for team name \u2014 minimum 3 characters.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/complete-profile/page.tsx",
        "functionName": "formSchema"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_COMPLETE_PROFILE-003",
      "version": 3,
      "logic_category": "PRESENTATION",
      "description": "Main page component. Renders team name form for new OAuth users. Redirects to /login if accessed without valid state (no firebaseUser or not isNewOAuthUser). picks up the new Firestore doc and navigates to /dashboard.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/complete-profile/page.tsx",
        "functionName": "CompleteProfilePage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_COMPLETE_PROFILE-004",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch dynamic team name suggestions from the API on mount, then set the first suggestion in the form field. Falls back gracefully if the fetch fails.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/complete-profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_COMPLETE_PROFILE-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Redirect to /login if this page is accessed without valid OAuth state.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/complete-profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_COMPLETE_PROFILE-006",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Submit team name to complete-oauth-profile API. automatically via onAuthStateChanged detecting the new doc.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/complete-profile/page.tsx",
        "functionName": "onSubmit"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_DASHBOARD-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Server-rendered dashboard page. Displays next race info (qualifying/race dates),",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_DASHBOARD-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Pre-season flag \u00e2\u20ac\u201d controls visibility of the pre-season testing banner.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/page.tsx",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_DASHBOARD-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Force dynamic rendering to prevent Next.js from attempting Firestore access at build time.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/page.tsx",
        "functionName": "dynamic"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_DASHBOARD-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main dashboard page component \u00e2\u20ac\u201d computes next race dates, renders countdown client,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/dashboard/page.tsx",
        "functionName": "DashboardPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_DEV-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Developer info page \u00e2\u20ac\u201d displays current build information (version, framework, backend, AI)",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/dev/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_DEV-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Next.js page metadata for SEO \u00e2\u20ac\u201d sets title and description for the dev info page.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/dev/page.tsx",
        "functionName": "metadata"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_DEV-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main dev page component \u00e2\u20ac\u201d renders build info grid (version, framework, backend, AI),",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/about/dev/page.tsx",
        "functionName": "DevPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_FORGOT_PIN-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Forgot PIN page \u00e2\u20ac\u201d allows users to request a temporary PIN reset email.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/forgot-pin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_FORGOT_PIN-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod validation schema for forgot PIN form \u00e2\u20ac\u201d requires a valid email address.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/forgot-pin/page.tsx",
        "functionName": "ForgotPinPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_FORGOT_PIN-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main forgot PIN page component \u00e2\u20ac\u201d renders email input form, calls resetPin API,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/forgot-pin/page.tsx",
        "functionName": "ForgotPinPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_FORGOT_PIN-003",
      "version": 4,
      "logic_category": "RECOVERY",
      "description": "Form submission handler \u00e2\u20ac\u201d calls resetPin API, shows toast on success/failure,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/forgot-pin/page.tsx",
        "functionName": "onSubmit"
      },
      "errorProfile": {
        "throws": [
          "PX-9001"
        ],
        "handles": [],
        "emits": {
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Leagues listing page \u00e2\u20ac\u201d displays all leagues the current user belongs to as cards,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUES-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main page component that renders the league listing grid with create/join dialogs,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/page.tsx",
        "functionName": "LeaguesPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUES-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Creates a new league via Firestore and navigates to the new league detail page on success.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/page.tsx",
        "functionName": "handleCreate"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUES-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Joins an existing league using a 6-character invite code, with support for primary or secondary team selection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/page.tsx",
        "functionName": "handleJoin"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUES-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Removes the current user from a league they are a member of (non-owners only).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/page.tsx",
        "functionName": "handleLeave"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUES-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Permanently deletes a league (owners only), removing all member associations.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/page.tsx",
        "functionName": "handleDelete"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUES-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Copies a league invite code to the clipboard and confirms via toast.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/page.tsx",
        "functionName": "copyInviteCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUES-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Sets the selected league in context and navigates to the league detail page.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/page.tsx",
        "functionName": "handleViewLeague"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "League detail page \u00e2\u20ac\u201d displays a single league's information including name, invite code,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Defines the display shape for a league member, including secondary team detection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main page component that renders league details with real-time updates, inline name editing,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx",
        "functionName": "LeagueDetailPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Determines if the current user is a member of this league, checking both primary and secondary team IDs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-004",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Subscribes to real-time Firestore updates for the league document, and fetches member details",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx",
        "functionName": "for"
      },
      "errorProfile": {
        "throws": [
          "PX-1001",
          "PX-9001"
        ],
        "handles": [],
        "emits": {
          "PX-1001": {
            "key": "AUTH_INVALID_TOKEN",
            "message": "Invalid or missing authentication token",
            "severity": "error",
            "recovery": "User should log out and log in again. Check token expiry.",
            "failureModes": [
              "Token expired",
              "Token malformed",
              "Clock skew between client and server"
            ]
          },
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Regenerates the league invite code (owner-only action) and displays the new code via toast.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx",
        "functionName": "handleRegenerateCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Saves the edited league name (owner-only action) via Firestore update.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx",
        "functionName": "handleSaveName"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Removes a member from the league (owner-only action, cannot remove self).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx",
        "functionName": "handleRemoveMember"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Removes the current user from the league (non-owners only) and navigates back to leagues list.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx",
        "functionName": "handleLeave"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Permanently deletes the league (owner-only action) and navigates back to leagues list.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx",
        "functionName": "handleDelete"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LEAGUE_DETAIL-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Copies the league invite code to the clipboard and confirms via toast.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/leagues/[leagueId]/page.tsx",
        "functionName": "copyInviteCode"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LOGIN-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Login page for Prix Six. Authenticates users via email + 6-digit PIN,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/login/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LOGIN-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod validation schema for login form \u00e2\u20ac\u201d enforces valid email and exactly 6-digit PIN.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/login/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LOGIN-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main login page component \u00e2\u20ac\u201d renders email/PIN form, handles authentication,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/login/page.tsx",
        "functionName": "LoginPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LOGIN-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Form submission handler \u00e2\u20ac\u201d calls login API, manages submit/redirect states,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/login/page.tsx",
        "functionName": "onSubmit"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LOGIN-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Handle Google OAuth sign-in. If the user's email already has a PIN account, show linking dialog instead of auto-linking.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/login/page.tsx",
        "functionName": "handleGoogleSignIn"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LOGIN-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Handle Apple OAuth sign-in with same linking-dialog pattern as Google.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/login/page.tsx",
        "functionName": "handleAppleSignIn"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_LOGIN-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Redirect already-authenticated users to dashboard. Handles mobile redirect-based OAuth flows (Apple/Google) where getRedirectResult completes and the login page remounts with user already signed in.",
      "dependencies": [
        "FIREBASE_PROVIDER-031",
        "FIREBASE_PROVIDER-008"
      ],
      "location": {
        "filePath": "app/src/app/(auth)/login/page.tsx",
        "functionName": "useEffect (auth redirect)"
      },
      "callChain": {
        "calledBy": [
          "FIREBASE_PROVIDER-031"
        ],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-000",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "My Results page \u2014 displays the logged-in user's prediction results across ALL races, with colour-coded scoring breakdowns, season total, and team toggle for secondary teams. Includes bar chart, narrative stats, and team search to view other teams. No write operations \u2014 this is a read-only view.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-001",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "Type for a processed race card \u2014 one per race that has both results and user predictions.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx",
        "functionName": "MyRaceResult"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-002",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "Main page component \u2014 fetches all user predictions, race results, and scores, then renders per-race cards with scoring breakdowns ordered most recent first.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx",
        "functionName": "MyResultsPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-003",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Active team ID \u2014 primary is user.id, secondary is \"${user.id}-secondary\".",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-004",
      "version": 1,
      "logic_category": "TRANSFORMATION",
      "description": "Shared processing function to build MyRaceResult[] from Firestore data.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx",
        "functionName": "processResults"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-005",
      "version": 1,
      "logic_category": "IO",
      "description": "Fetch own team data when activeTeamId changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-006",
      "version": 1,
      "logic_category": "IO",
      "description": "Fetch other team's data when viewingTeam changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-007",
      "version": 1,
      "logic_category": "IO",
      "description": "Debounced team search handler \u2014 Firestore prefix query on teamName.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx",
        "functionName": "handleSearch"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-008",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Chart data \u2014 sort chronologically, compute running average.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx",
        "functionName": "chartData"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_MY_RESULTS-009",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Narrative stats \u2014 score-type breakdown, best race, bonus total, top drivers.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/my-results/page.tsx",
        "functionName": "narrativeStats"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-000",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Onboarding checklist page. Guides new users through five steps to get started: verify email, learn the game, make a prediction, explore the paddock, and join a league. Steps 1 & 3 auto-detect from auth/Firestore state; steps 2, 4, 5 are manual.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-001",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "localStorage key for persisting manual checklist progress.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-002",
      "version": 4,
      "logic_category": "VALIDATION",
      "description": "Type definition for onboarding progress state. Includes gameLearned boolean for the Learn the Game step.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-003",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Checklist item configuration. Defines label, description, icon, links, and whether the step is auto-detected or requires manual completion. Now includes 5 steps with Learn the Game at index 1.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-004",
      "version": 1,
      "logic_category": "PRESENTATION",
      "description": "Main onboarding page component. Renders hero, progress bar, and interactive checklist. persists manual completion to localStorage.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-005",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Load persisted progress from localStorage on mount.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-006",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Auto-detect email verification from auth state and sync to progress.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-007",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Query predictions subcollection to auto-detect if user has made any prediction.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-008",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Handler for manual step completion. Marks step as done, persists, then navigates.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-009",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "PAGE_ONBOARDING block PAGE_ONBOARDING-009",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-010",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "PAGE_ONBOARDING block PAGE_ONBOARDING-010",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ONBOARDING-011",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "PAGE_ONBOARDING block PAGE_ONBOARDING-011",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/onboarding/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Predictions page \u00e2\u20ac\u201d allows users to view, submit, and edit their driver predictions",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Inner content component encapsulating all prediction logic \u00e2\u20ac\u201d determines next open race,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx",
        "functionName": "PredictionsContent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Real-time query for all race_results documents to determine which races are complete.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Computes the next open race by finding the first race in the schedule without",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Determines if the pit lane is open (predictions allowed) by checking both",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Constructs the Firestore prediction document ID from team ID and race ID.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Memoised Firestore document reference for the user's prediction for the current race/team.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Query to fetch recent predictions for the selected team, used for carry-over logic",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Logs errors from the allPredictions query (e.g., missing composite index, permissions).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Finds the most recent previous prediction (not for the current race) to carry over",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-010",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Builds the initial 6-slot driver prediction array from either the current race",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-011",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Ensures selectedTeam is set once user data loads (handles initial mount race condition).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Determines why the pit lane is closed \u00e2\u20ac\u201d either race results entered or qualifying started.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PREDICTIONS-013",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Exported page wrapper that renders PredictionsContent.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/predictions/page.tsx",
        "functionName": "PredictionsPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Profile & Settings page \u00e2\u20ac\u201d allows users to manage their account, notification preferences,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod schema for email notification preferences form validation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-002",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript type inferred from profileFormSchema for type-safe form handling.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod schema for the secondary team name form \u00e2\u20ac\u201d enforces minimum 3-character name.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-004",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod schema for PIN change form \u00e2\u20ac\u201d enforces 6-digit length and match between new/confirm.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main Profile page component \u00e2\u20ac\u201d renders all profile management cards and handles all",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "ProfilePage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Initialise notification preferences form with user's saved values or sensible defaults.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Reset form values when user data loads or changes (e.g. after Firestore round-trip).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Initialise secondary team form with existing secondary team name if one exists.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Initialise change PIN form with empty defaults.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Sync secondary team name into form when user data loads.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Sync secondary email into local state when user data loads.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Save notification preferences to Firestore and log audit event.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "onProfileSubmit"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Request a new temporary PIN to be emailed to the user.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "which"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-014",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Permanently close the user's account by deleting presence and user documents, then logging out.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleCloseAccount"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-015",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Use AI to suggest a fun secondary team name based on the user's primary team name.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleSuggestName"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-016",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Create the user's secondary team via the auth context function.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "onSecondTeamSubmit"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-017",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Change the user's PIN and force re-login for security.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "onChangePinSubmit"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-018",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Send a verification email to the user's primary email address.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleSendVerificationEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-019",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Refresh the email verification status from Firebase Auth.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleRefreshVerificationStatus"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-020",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Save or update the user's secondary email address.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleSaveSecondaryEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-021",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Remove the user's secondary email by passing null to the update function.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleRemoveSecondaryEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-022",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Remove the user's secondary team by deleting the secondaryTeamName field from Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleRemoveSecondaryTeam"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-023",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Send a verification email to the user's secondary email address.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleSendSecondaryVerification"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-024",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Save a profile photo URL (from manual entry or preset selection) to Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleSavePhoto"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-025",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Handle file upload for profile photo \u00e2\u20ac\u201d validates, compresses, uploads to Firebase Storage,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleFileUpload"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-026",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Preset avatar options generated from external avatar services using the user's ID/team name.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-027",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Derive the current avatar URL \u00e2\u20ac\u201d user's saved photo or a fallback generated avatar.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-028",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Link Google account to current user from profile page.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleLinkGoogle"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-029",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Link Apple account to current user from profile page.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleLinkApple"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-030",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Unlink a provider from the current user, preventing unlinking the last provider.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx",
        "functionName": "handleUnlinkProvider"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-040",
      "version": 4,
      "logic_category": "DATA_FETCH",
      "description": "Memoised Firestore query for the current user's last 10 logon records from user_logons, ordered by logonTimestamp descending. Returns null when user is unavailable so useCollection gracefully waits.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_PROFILE-041",
      "version": 4,
      "logic_category": "DATA_FETCH",
      "description": "Fetch total logon count for badge display via getDocs. Uses a one-shot query instead of a real-time listener to avoid a second subscription for a simple count.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/profile/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-000",
      "version": 6,
      "logic_category": "ORCHESTRATION",
      "description": "Race Results page \u00e2\u20ac\u201d displays per-race points breakdowns for all teams' predictions,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Page size constant for Firestore query pagination of prediction documents.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "RaceRankBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-010",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Suspense loading fallback \u00e2\u20ac\u201d skeleton UI shown while ResultsContent loads (required by",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "ResultsLoadingFallback"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-011",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Main results content component \u00e2\u20ac\u201d fetches race results, scores, and predictions from",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "ResultsContent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch all race_results documents on mount to determine which races have admin-entered",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "fetchRacesWithResults"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Filter the full race events list to only those with admin-entered results.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-014",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Calculate the default race ID to display \u00e2\u20ac\u201d prioritises URL parameter, then most recent",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-015",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Sync selectedRaceId when the most recent result is fetched (only if no URL param).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-016",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Sync selectedRaceId when the URL ?race= parameter changes (e.g. browser navigation).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-018",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch the official race result document when the selected race changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "fetchRaceResult"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-020",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Build a formatted string of the official top-6 result (e.g. \"P1: Verstappen | P2: ...\").",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "getOfficialResult"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-022",
      "version": 5,
      "logic_category": "TRANSFORMATION",
      "description": "Parse a team's raw predictions (object or array format) and compare against actual",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-025",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch all data for the selected race in parallel \u00e2\u20ac\u201d count, scores, and first page of",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "fetchAllData"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-026",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Load the next page of prediction documents from Firestore using cursor-based pagination.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-027",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Filter teams by the selected league's member user IDs (or show all if global).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-028",
      "version": 5,
      "logic_category": "TRANSFORMATION",
      "description": "Calculate effective points for a team \u00e2\u20ac\u201d uses stored score if available, otherwise",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-029",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Sort teams by points (descending) or team name (ascending), and assign race ranks",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-030",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Toggle the sort order between points and team name.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "toggleSort"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RESULTS-031",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Exported page component \u00e2\u20ac\u201d wraps ResultsContent in a Suspense boundary as required by",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/results/page.tsx",
        "functionName": "ResultsPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ROOT-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Root page component \u00e2\u20ac\u201d renders the login page as the application entry point.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/page.tsx",
        "functionName": "Home"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_ROOT-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Default export that renders LoginPage as the home page content.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/page.tsx",
        "functionName": "Home"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RULES-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Rules page \u00e2\u20ac\u201d displays the league gameplay rules, scoring system, and tie-breaker rule",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/rules/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RULES-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Maps gameplay rule titles to Lucide icon components for visual differentiation in the rules list.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/rules/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_RULES-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main page component that renders three cards: Gameplay Rules, Scoring System, and Tie-Breaker,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/rules/page.tsx",
        "functionName": "RulesPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SCHEDULE-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Schedule page \u00e2\u20ac\u201d displays the full 2026 F1 race calendar with qualifying, sprint, and GP times.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/schedule/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SCHEDULE-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Converts an ISO 8601 date string into a localised date and time pair for display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/schedule/page.tsx",
        "functionName": "formatLocalDateTime"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SCHEDULE-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main page component that renders the full race schedule with next-race highlighting,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/schedule/page.tsx",
        "functionName": "SchedulePage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Signup page for Prix Six. Allows new players to register with a team name,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Blocklist of common weak PINs to prevent trivially guessable credentials.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Zod schema for signup form \u00e2\u20ac\u201d validates team name (min 3 chars), email,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main signup page component \u00e2\u20ac\u201d renders registration form with team name suggestion,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx",
        "functionName": "SignupPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-005",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Client-only effect to set a random team name suggestion after hydration,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-006",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Picks a random F1-themed team name from funnyNames and sets it in the form.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx",
        "functionName": "suggestName"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-007",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Form submission handler \u00e2\u20ac\u201d calls signup API, shows success toast and redirects",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx",
        "functionName": "onSubmit"
      },
      "errorProfile": {
        "throws": [
          "PX-9001"
        ],
        "handles": [],
        "emits": {
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Handle Google OAuth sign-in from signup page. New users go to /complete-profile; existing users are signed in directly.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx",
        "functionName": "handleGoogleSignIn"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SIGNUP-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Handle Apple OAuth sign-in from signup page.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/signup/page.tsx",
        "functionName": "handleAppleSignIn"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Season Standings page \u00e2\u20ac\u201d displays cumulative league standings after each race weekend,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Visual indicator for rank changes between race weekends \u00e2\u20ac\u201d shows arrows/chevrons based",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "RankChangeIndicator"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Badge for top-3 ranked teams \u00e2\u20ac\u201d gold for 1st, silver for 2nd, bronze for 3rd.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "RankBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-003",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Small \"Winner\" badge shown next to the team(s) that scored highest in the selected race's",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "RaceWinnerBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Constant identifying the 2025 season defending champion team for special badge display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "DefendingChampionBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Purple badge identifying the defending 2025 season champion in the standings table.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "DefendingChampionBadge"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Type for raw score documents fetched from Firestore scores collection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Type for a single row in the computed standings table.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-008",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Type for a completed race weekend \u00e2\u20ac\u201d tracks base, sprint, and GP race IDs along with",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Page size constant for client-side pagination of standings rows.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "StandingsPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-010",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Main Standings page component \u00e2\u20ac\u201d subscribes to scores in real-time, computes cumulative",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "StandingsPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-011",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Real-time subscription to the entire scores collection \u00e2\u20ac\u201d processes raw score documents,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "errorProfile": {
        "throws": [
          "PX-9001",
          "PX-4004",
          "PX-1001"
        ],
        "handles": [],
        "emits": {
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          },
          "PX-4004": {
            "key": "FIRESTORE_INDEX_REQUIRED",
            "message": "Database index required",
            "severity": "error",
            "recovery": "Create the required composite index in Firebase Console.",
            "failureModes": [
              "Missing composite index for query"
            ]
          },
          "PX-1001": {
            "key": "AUTH_INVALID_TOKEN",
            "message": "Invalid or missing authentication token",
            "severity": "error",
            "recovery": "User should log out and log in again. Check token expiry.",
            "failureModes": [
              "Token expired",
              "Token malformed",
              "Clock skew between client and server"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Filter raw scores by the selected league's member user IDs (or pass all if global).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-013",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Calculate cumulative standings for the selected race weekend \u00e2\u20ac\u201d computes old/new overall",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-014",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Determine the race winners (highest GP and Sprint points) for the selected race weekend,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-015",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Build chart data for season progression \u00e2\u20ac\u201d cumulative points per team after each race",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-016",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Derive the current user's primary and secondary userIds for chart line filtering.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-017",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Filter chart lines to approximately 11 teams based on chartMode (top10 or myPosition).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-018",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Generate a deterministic HSL colour for each team name \u00e2\u20ac\u201d ensures the same team always",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "hue"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-019",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Calculate maximum points for the chart Y-axis with a 10% buffer for visual headroom.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-020",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Client-side pagination \u00e2\u20ac\u201d tracks how many standings rows to display and whether more exist.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-021",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Load the next page of standings rows with a small delay for smooth UX.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_STANDINGS-022",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Navigate to the Results page for a specific race, optionally filtering by team.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/standings/page.tsx",
        "functionName": "navigateToResults"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Submissions page \u00e2\u20ac\u201d displays locked-in predictions for all teams for a selected race in a sortable,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-001",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Defines the display shape for a single submission row in the table.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Union type for the two sortable columns: submission date or team name.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx",
        "functionName": "SubmissionsPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main page component that orchestrates the submissions table with race selection, sorting,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx",
        "functionName": "SubmissionsPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Determines the first unscored race by comparing all scores in Firestore against the RaceSchedule,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx",
        "functionName": "determineNextUnscored"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-005",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Formats a Firestore timestamp or Date into a human-readable en-GB date/time string.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx",
        "functionName": "formatTimestamp"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-006",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Delegates to the centralised formatDriverPredictions utility for consistent driver name formatting.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx",
        "functionName": "formatPredictions"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-007",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches the total prediction count for the selected race using Firestore server-side aggregation.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx",
        "functionName": "fetchCount"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-008",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches paginated submission data from the \"predictions\" collectionGroup filtered by raceId,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx"
      },
      "errorProfile": {
        "throws": [
          "PX-4004",
          "PX-1007",
          "PX-9001"
        ],
        "handles": [],
        "emits": {
          "PX-4004": {
            "key": "FIRESTORE_INDEX_REQUIRED",
            "message": "Database index required",
            "severity": "error",
            "recovery": "Create the required composite index in Firebase Console.",
            "failureModes": [
              "Missing composite index for query"
            ]
          },
          "PX-1007": {
            "key": "AUTH_PERMISSION_DENIED",
            "message": "Permission denied",
            "severity": "error",
            "recovery": "Check Firestore security rules and user permissions.",
            "failureModes": [
              "Firestore rules deny access",
              "User role downgraded"
            ]
          },
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-009",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Triggers fetchSubmissions on initial page load and whenever the race or sort field changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx",
        "functionName": "loadMore"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Delegates to fetchSubmissions with isLoadMore=true for paginated loading.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx",
        "functionName": "loadMore"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_SUBMISSIONS-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Filters the full submissions list to only members of the selected league (or shows all if global).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/submissions/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Teams page \u00e2\u20ac\u201d displays all team predictions for a selected race in an expandable accordion.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Represents a basic team record with user association, used before predictions are loaded.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Extends TeamBasic with prediction data and loading state for on-demand prediction fetching.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-003",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Determines the most recent race that has scored results, used to set the default race selection.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx",
        "functionName": "findMostRecentRaceWithResults"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Main page component that orchestrates team listing, race selection, on-demand prediction loading,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx",
        "functionName": "TeamsPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches race_results on mount to determine which race to show by default (most recent with results).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx",
        "functionName": "fetchDefaultRace"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-006",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches the total user count using Firestore server-side aggregation (no document downloads).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx",
        "functionName": "fetchCount"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-007",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Converts raw Firestore prediction data into an array of F1Driver objects for display.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-008",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches paginated team list from Firestore users collection WITHOUT predictions (fast initial load).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "errorProfile": {
        "throws": [
          "PX-4004",
          "PX-1001",
          "PX-9001"
        ],
        "handles": [],
        "emits": {
          "PX-4004": {
            "key": "FIRESTORE_INDEX_REQUIRED",
            "message": "Database index required",
            "severity": "error",
            "recovery": "Create the required composite index in Firebase Console.",
            "failureModes": [
              "Missing composite index for query"
            ]
          },
          "PX-1001": {
            "key": "AUTH_INVALID_TOKEN",
            "message": "Invalid or missing authentication token",
            "severity": "error",
            "recovery": "User should log out and log in again. Check token expiry.",
            "failureModes": [
              "Token expired",
              "Token malformed",
              "Clock skew between client and server"
            ]
          },
          "PX-9001": {
            "key": "UNKNOWN_ERROR",
            "message": "An unexpected error occurred",
            "severity": "error",
            "recovery": "Check server logs with the correlation ID for root cause.",
            "failureModes": [
              "Unclassified error",
              "Third-party library exception"
            ]
          }
        }
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-009",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Checks whether a team's createdAt timestamp is after the selected race's qualifying time.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-010",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetches predictions for a single team on-demand when the user expands an accordion item.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-011",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Handles accordion open/close events and triggers on-demand prediction fetching for the opened team.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-012",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Triggers the initial team list fetch once the default race has been determined.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-013",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Resets all team prediction data and closes the accordion when the selected race changes.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-014",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Delegates to fetchTeams with isLoadMore=true for paginated loading.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx",
        "functionName": "loadMore"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_TEAMS-015",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Filters the full teams list to only members of the selected league (or shows all if global).",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/teams/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_EMAIL-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Email verification landing page. Processes the token+uid from a verification link,",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-email/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_EMAIL-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Union type representing all possible verification states for UI rendering.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-email/page.tsx",
        "functionName": "VerifyEmailContent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_EMAIL-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Inner content component that reads search params (token, uid), calls the",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-email/page.tsx",
        "functionName": "VerifyEmailContent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_EMAIL-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Effect that fires on mount to validate token/uid params and call the verify API.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-email/page.tsx",
        "functionName": "verifyEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_EMAIL-004",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Loading fallback component shown while useSearchParams() resolves inside Suspense.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-email/page.tsx",
        "functionName": "LoadingFallback"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_EMAIL-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Exported page component wrapping VerifyEmailContent in Suspense boundary",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-email/page.tsx",
        "functionName": "VerifyEmailPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_SECONDARY_EMAIL-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Secondary email verification landing page. Processes the token+uid from a",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-secondary-email/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_SECONDARY_EMAIL-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Union type representing all possible verification states for UI rendering.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-secondary-email/page.tsx",
        "functionName": "VerifySecondaryEmailContent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_SECONDARY_EMAIL-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Inner content component that reads search params (token, uid), calls the",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-secondary-email/page.tsx",
        "functionName": "VerifySecondaryEmailContent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_SECONDARY_EMAIL-003",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Effect that fires on mount to validate token/uid params and call the verify API.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-secondary-email/page.tsx",
        "functionName": "verifyEmail"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_SECONDARY_EMAIL-004",
      "version": 3,
      "logic_category": "RECOVERY",
      "description": "Loading fallback component shown while useSearchParams() resolves inside Suspense.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-secondary-email/page.tsx",
        "functionName": "LoadingFallback"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PAGE_VERIFY_SECONDARY_EMAIL-005",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Exported page component wrapping VerifySecondaryEmailContent in Suspense boundary",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(auth)/verify-secondary-email/page.tsx",
        "functionName": "VerifySecondaryEmailPage"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PUBCHAT_ADMIN_TAB-001",
      "version": 1,
      "logic_category": "ORCHESTRATION",
      "description": "Import PubChatPanel component for the 15th admin tab.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/page.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PUBCHAT_PANEL-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Admin panel for the PubChat tab. Renders the ThePaddockPubChat",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/PubChatPanel.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PUBCHAT_PANEL-001",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "PubChatPanel component \u00e2\u20ac\u201d centres the pub chat animation and shows",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/PubChatPanel.tsx",
        "functionName": "PubChatPanel"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PUBCHAT_PANEL-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch newsletter content and timing data from Firestore on mount / refresh.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/PubChatPanel.tsx",
        "functionName": "fetchContent"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PUBCHAT_PANEL-003",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch meeting list from OpenF1 via the proxy API route for the current year.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/PubChatPanel.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PUBCHAT_PANEL-004",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch session list from OpenF1 when a meeting is selected.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/PubChatPanel.tsx"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "PUBCHAT_PANEL-005",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Fetch timing data from OpenF1 and write to Firestore via the API route. from Firestore to update the ThePaddockPubChat component.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/app/(app)/admin/_components/PubChatPanel.tsx",
        "functionName": "handleFetchTimingData"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-000",
      "version": 5,
      "logic_category": "ORCHESTRATION",
      "description": "Client-side OAuth authentication service for Google and Apple sign-in. Provides popup-with-redirect-fallback sign-in, provider linking/unlinking, Apple nonce generation, and mobile detection. All OAuth must happen client-side because Firebase OAuth requires browser interaction. sign-in, linking, and unlinking operations. the user profile. New OAuth users (no Firestore doc) are routed to complete-profile by the provider's auth state handler.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Type definitions for OAuth operation results, providing structured success/error responses with optional pending credential for account-linking flows. conditional rendering of success, error, and linking prompts.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "OAuthSignInResult"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-002",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Detect mobile devices via userAgent and viewport width to determine whether to use signInWithPopup (desktop) or signInWithRedirect (mobile). Mobile Safari blocks popups, so redirect is mandatory on mobile. would cause popup-blocked errors on mobile.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "isMobileDevice"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-003",
      "version": 1,
      "logic_category": "IO",
      "description": "Detect Gmail plus-addressing (e.g. user+tag@gmail.com) which shares the same Google account as the base address (user@gmail.com). When linking Google OAuth, Firebase sees the base address, causing auth/credential-already-in-use if another Firebase Auth user already has that Google credential linked.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "isGmailPlusAddress"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-004",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Extract the list of provider IDs from a Firebase Auth user's providerData array. components that display linked provider status.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "getProviderIds"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-005",
      "version": 3,
      "logic_category": "PRESENTATION",
      "description": "Sign in with Google using popup (desktop) or redirect (mobile). Handles popup-blocked errors by falling back to redirect. Detects account-exists-with-different-credential for linking flows. returns pendingCredential for the UI to prompt PIN sign-in first.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "signInWithGoogle"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-006",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Sign in with Apple using popup on all platforms. Apple Sign-In on iOS uses the native system authentication sheet (not a browser popup), so signInWithPopup works reliably on mobile. The previous signInWithRedirect approach was broken by Safari ITP clearing the auth session during redirect.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "signInWithApple"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-007",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Link a Google account to the currently signed-in user. Uses popup on desktop with redirect fallback. handler will sync the new providers list to Firestore.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "linkGoogleToAccount"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-008",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Link an Apple account to the currently signed-in user.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "linkAppleToAccount"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-009",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Unlink a sign-in provider from the current user. Caller must verify this isn't the last provider before calling.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "unlinkProvider"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-010",
      "version": 4,
      "logic_category": "ORCHESTRATION",
      "description": "Central error handler for OAuth sign-in errors. Maps Firebase error codes to application error codes and handles popup-blocked fallback to redirect.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "handleOAuthError"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SERVICE_AUTH_OAUTH-011",
      "version": 5,
      "logic_category": "IO",
      "description": "Central error handler for provider linking errors. Detects Gmail plus-addressing to provide specific guidance when auth/credential-already-in-use occurs.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/services/authService.ts",
        "functionName": "handleLinkError"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "SESSION_FUNCTIONS-000",
      "version": 3,
      "logic_category": "ORCHESTRATION",
      "description": "Scheduled Cloud Function (every 15 min) that expires stale Active sessions in user_logons after 24 hours. Queries sessionStatus=='Active' with logonTimestamp older than cutoff, batch-updates to 'Session Expired'.",
      "dependencies": [],
      "location": {
        "filePath": "functions/index.js",
        "functionName": "expireStaleLogons"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      },
      "errorProfile": {
        "throws": [
          "PX-6006"
        ],
        "handles": [],
        "emits": {
          "PX-6006": {
            "key": "LOGON_EXPIRY_FAILED",
            "message": "Failed to expire stale session",
            "severity": "error",
            "recovery": "Function retries on next 15-minute schedule. Stale sessions remain Active until next successful run.",
            "failureModes": [
              "Firestore query failure",
              "Batch update failure",
              "Function timeout"
            ]
          }
        }
      }
    },
    {
      "guid": "TYPES_ERRORS-000",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "TypeScript interfaces for the traced-error system. Defines the shape of error definitions (from code.json), traced error instances (runtime), and severity levels. Every error in the system answers four diagnostic questions: Where? What? Known failures? Who triggered it?",
      "dependencies": [],
      "location": {
        "filePath": "app/src/types/errors.ts"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "TYPES_ERRORS-001",
      "version": 3,
      "logic_category": "VALIDATION",
      "description": "Defines the full shape of an error definition sourced from code.json's errorProfile.emits entries. Each field answers one of the four diagnostic questions required by Golden Rule #7.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/types/errors.ts",
        "functionName": "ErrorDefinition"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    },
    {
      "guid": "TYPES_ERRORS-002",
      "version": 3,
      "logic_category": "TRANSFORMATION",
      "description": "Extends the standard Error with traced-error metadata. Created at runtime by createTracedError() and passed to logTracedError() for persistence. The correlationId links user reports to server logs. must remain parseable by support workflows.",
      "dependencies": [],
      "location": {
        "filePath": "app/src/types/errors.ts",
        "functionName": "TracedError"
      },
      "callChain": {
        "calledBy": [],
        "calls": []
      }
    }
  ]
}