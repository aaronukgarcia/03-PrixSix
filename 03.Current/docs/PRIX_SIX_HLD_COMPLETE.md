# Prix Six - Comprehensive High-Level Design Document

**Version:** 1.10.0
**Last Updated:** January 2026
**Document Status:** As-Built Technical Specification
**Prepared By:** Technical Architecture Team

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [System Architecture Overview](#2-system-architecture-overview)
3. [Technology Stack](#3-technology-stack)
4. [Authentication System](#4-authentication-system)
5. [User-Facing Pages](#5-user-facing-pages)
6. [Admin Dashboard](#6-admin-dashboard)
7. [Database Architecture](#7-database-architecture)
8. [Scoring System](#8-scoring-system)
9. [Email Notification System](#9-email-notification-system)
10. [WhatsApp Integration System](#10-whatsapp-integration-system)
11. [WhatsApp Worker Service](#11-whatsapp-worker-service)
12. [Consistency Checker](#12-consistency-checker)
13. [Audit System](#13-audit-system)
14. [Claude Coordination System](#14-claude-coordination-system)
15. [ID Conventions and Data Standards](#15-id-conventions-and-data-standards)
16. [Security Architecture](#16-security-architecture)
17. [Deployment Architecture](#17-deployment-architecture)
18. [API Reference](#18-api-reference)

---

# 1. Executive Summary

## 1.1 Project Overview

Prix Six is a fantasy Formula 1 prediction league application designed for a community of approximately 20 players who compete via a WhatsApp group. The application enables players to predict the top 6 finishers for each F1 race, with automated scoring, standings tracking, and multi-channel notifications.

## 1.2 Key Features

| Feature | Description |
|---------|-------------|
| **User Registration** | PIN-based authentication with team name selection |
| **Race Predictions** | Drag-and-drop interface for selecting top 6 drivers |
| **Automated Scoring** | Position-based scoring with bonus points |
| **Live Standings** | Real-time league standings with historical data |
| **Email Notifications** | Welcome emails, results notifications, hot news |
| **WhatsApp Integration** | Automated group notifications for race events |
| **Admin Dashboard** | 10-tab comprehensive management interface |
| **AI Hot News** | Google Gemini-powered F1 news generation |
| **Data Consistency** | Automated validation across all data entities |

## 1.3 User Roles

| Role | Capabilities |
|------|-------------|
| **Player** | Make predictions, view standings, update profile |
| **Admin** | All player capabilities plus: manage results, scores, users, send notifications |

## 1.4 Two Human Developers

The system is maintained by two developers:
- **Will** - Development and features
- **Aaron** - Architecture and administration

---

# 2. System Architecture Overview

## 2.1 High-Level Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PRIX SIX ARCHITECTURE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Browser   â”‚â”€â”€â”€â”€â–¶â”‚            Next.js 15 Application               â”‚   â”‚
â”‚  â”‚   (React)   â”‚     â”‚         (Firebase Hosting - Europe)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚                                   â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                      â–¼                  â–¼                  â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        Firebase Services                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Firestore  â”‚  â”‚    Auth     â”‚  â”‚   Hosting   â”‚  â”‚  Functions â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (NoSQL DB) â”‚  â”‚  (Firebase) â”‚  â”‚  (CDN/SSR)  â”‚  â”‚ (Serverless)â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚                                   â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚            â–¼                            â–¼                            â–¼     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Microsoft 365  â”‚    â”‚    Azure Container      â”‚    â”‚  Google Gemini â”‚ â”‚
â”‚  â”‚  Graph API      â”‚    â”‚    Instance             â”‚    â”‚  (Genkit AI)   â”‚ â”‚
â”‚  â”‚  (Email Send)   â”‚    â”‚  (WhatsApp Worker)      â”‚    â”‚  (Hot News)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                                       â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                         â–¼                       â–¼                          â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚               â”‚  Azure Blob     â”‚    â”‚   WhatsApp Web  â”‚                   â”‚
â”‚               â”‚  Storage        â”‚    â”‚   (via Puppeteer)â”‚                   â”‚
â”‚               â”‚  (Session)      â”‚    â”‚                 â”‚                   â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2.2 Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PREDICTION FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  User Opens App                                                          â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Login Page  â”‚â”€â”€â”€â–¶â”‚  Dashboard  â”‚â”€â”€â”€â–¶â”‚ Predictions â”‚                  â”‚
â”‚  â”‚ (PIN Auth)  â”‚    â”‚ (Next Race) â”‚    â”‚   Page      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                               â”‚                          â”‚
â”‚                                               â–¼                          â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                  â”‚  Drag & Drop Interface â”‚              â”‚
â”‚                                  â”‚  - 22 F1 Drivers       â”‚              â”‚
â”‚                                  â”‚  - 6 Position Slots    â”‚              â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                              â”‚                           â”‚
â”‚                                              â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    FIRESTORE WRITES                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚  â”‚ users/{uid}/predictions â”‚  â”‚   prediction_submissions      â”‚ â”‚    â”‚
â”‚  â”‚  â”‚ (Subcollection)         â”‚  â”‚   (Flat Collection Mirror)    â”‚ â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SCORING FLOW                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Admin Enters Race Results                                               â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚   ResultsManager Tab    â”‚                                            â”‚
â”‚  â”‚   - Select Race         â”‚                                            â”‚
â”‚  â”‚   - Select P1-P6        â”‚                                            â”‚
â”‚  â”‚   - Submit Results      â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚              â”‚                                                           â”‚
â”‚              â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    API: /api/admin/update-scores                 â”‚    â”‚
â”‚  â”‚  1. Store race_results document                                  â”‚    â”‚
â”‚  â”‚  2. Query all predictions for this race                          â”‚    â”‚
â”‚  â”‚  3. Calculate scores per Prix Six rules                          â”‚    â”‚
â”‚  â”‚  4. Write scores collection                                      â”‚    â”‚
â”‚  â”‚  5. Return standings                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚              â”‚                                                           â”‚
â”‚              â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    OPTIONAL NOTIFICATIONS                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ Email All   â”‚  â”‚ WhatsApp    â”‚  â”‚ Hot News Generation    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ Players     â”‚  â”‚ Group Post  â”‚  â”‚ (AI Summary)           â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2.3 Module Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MODULE DEPENDENCIES                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                         â”‚   App Layout    â”‚                             â”‚
â”‚                         â”‚  (AuthGuard)    â”‚                             â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                  â”‚                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â–¼                        â–¼                        â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Auth       â”‚         â”‚  Firebase   â”‚         â”‚   Lib       â”‚       â”‚
â”‚  â”‚  Context    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Context    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Modules    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                        â”‚                        â”‚            â”‚
â”‚         â–¼                        â–¼                        â–¼            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ useAuth()   â”‚         â”‚ useFirestoreâ”‚         â”‚ scoring.ts  â”‚       â”‚
â”‚  â”‚ hook        â”‚         â”‚ hook        â”‚         â”‚ email.ts    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ audit.ts    â”‚       â”‚
â”‚                                                  â”‚ data.ts     â”‚       â”‚
â”‚                                                  â”‚ consistency â”‚       â”‚
â”‚                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 3. Technology Stack

## 3.1 Frontend Technologies

| Technology | Version | Purpose |
|------------|---------|---------|
| **Next.js** | 15.5.9 | React framework with App Router |
| **React** | 19.2.1 | UI component library |
| **TypeScript** | 5.x | Type-safe JavaScript |
| **Tailwind CSS** | 3.4.1 | Utility-first CSS framework |
| **Radix UI** | Various | Accessible UI primitives |
| **Lucide React** | 0.475.0 | Icon library |
| **Recharts** | 2.15.1 | Charts and visualizations |
| **React Hook Form** | 7.54.2 | Form state management |
| **Zod** | 3.24.2 | Schema validation |
| **date-fns** | 3.6.0 | Date manipulation |

## 3.2 Backend Technologies

| Technology | Version | Purpose |
|------------|---------|---------|
| **Firebase** | 11.9.1 | BaaS platform |
| **Firebase Admin** | 13.4.0 | Server-side Firebase SDK |
| **Genkit** | 1.20.0 | Google AI framework |
| **@genkit-ai/google-genai** | 1.20.0 | Gemini integration |

## 3.3 External Services

| Service | Purpose | Authentication |
|---------|---------|----------------|
| **Firebase Auth** | User authentication | Email/Password with PIN |
| **Firestore** | NoSQL database | Firebase SDK |
| **Firebase Hosting** | Static hosting + SSR | Automatic |
| **Microsoft Graph API** | Email sending | OAuth2 Client Credentials |
| **Google Gemini 2.5** | AI content generation | API Key |
| **Azure Blob Storage** | WhatsApp session persistence | Connection String |
| **Azure Container Instances** | WhatsApp worker hosting | Managed Identity |

## 3.4 Development Environment

| Component | Value |
|-----------|-------|
| **Platform** | Windows |
| **Node.js Path** | `C:\Program Files\nodejs\node.exe` |
| **NPM Path** | `C:\Program Files\nodejs\npm.cmd` |
| **Project Root** | `E:\GoogleDrive\Papers\03-PrixSix\03.Current` |
| **Service Account** | `E:\GoogleDrive\Papers\03-PrixSix\03.Current\service-account.json` |
| **Firebase Project ID** | `studio-6033436327-281b1` |
| **Hosting Region** | `europe-west4` |

## 3.5 Package.json Scripts

```json
{
  "scripts": {
    "dev": "next dev --turbopack -p 9002",
    "genkit:dev": "genkit start -- tsx src/ai/dev.ts",
    "genkit:watch": "genkit start -- tsx --watch src/ai/dev.ts",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "typecheck": "tsc --noEmit",
    "seed:big-shakedown": "npx ts-node --project tsconfig.scripts.json scripts/seed-big-shakedown.ts",
    "verify:admin": "npx ts-node --project tsconfig.scripts.json scripts/verify-admin.ts"
  }
}
```

---

# 4. Authentication System

## 4.1 Authentication Architecture

Prix Six uses a custom PIN-based authentication system built on Firebase Authentication. Instead of traditional passwords, users authenticate with a 6-digit PIN that is more suitable for the casual fantasy league context.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATION FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚   /login     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Firebase    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   /dashboard â”‚ â”‚
â”‚   â”‚   Page       â”‚          â”‚  Auth        â”‚          â”‚   Page       â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                          â”‚                                    â”‚
â”‚         â”‚ signInWithEmailAndPassword(email, PIN)                       â”‚
â”‚         â”‚                          â”‚                                    â”‚
â”‚         â”‚                          â–¼                                    â”‚
â”‚         â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚         â”‚                   â”‚   Firestore  â”‚                           â”‚
â”‚         â”‚                   â”‚   users/     â”‚                           â”‚
â”‚         â”‚                   â”‚   {uid}      â”‚                           â”‚
â”‚         â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚         â”‚                          â”‚                                    â”‚
â”‚         â”‚ Check: badLoginAttempts < 5                                  â”‚
â”‚         â”‚ Check: mustChangePin === false                               â”‚
â”‚         â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4.2 Login Page (`/login`)

### 4.2.1 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                         â”‚    PRIX SIX LOGO    â”‚                         â”‚
â”‚                         â”‚    (Racing Theme)   â”‚                         â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                         â”‚                     â”‚                         â”‚
â”‚                         â”‚    LOGIN CARD       â”‚                         â”‚
â”‚                         â”‚                     â”‚                         â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚                         â”‚  â”‚ Email Input   â”‚  â”‚                         â”‚
â”‚                         â”‚  â”‚ @email.com    â”‚  â”‚                         â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚                         â”‚                     â”‚                         â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚                         â”‚  â”‚ PIN Input     â”‚  â”‚                         â”‚
â”‚                         â”‚  â”‚ â— â— â— â— â— â—   â”‚  â”‚                         â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚                         â”‚                     â”‚                         â”‚
â”‚                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                         â”‚
â”‚                         â”‚  â”‚   LOGIN BTN   â”‚  â”‚                         â”‚
â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                         â”‚
â”‚                         â”‚                     â”‚                         â”‚
â”‚                         â”‚  Forgot PIN?        â”‚                         â”‚
â”‚                         â”‚  Create Account     â”‚                         â”‚
â”‚                         â”‚                     â”‚                         â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2.2 Field Specifications

| Field | Type | Validation | Description |
|-------|------|------------|-------------|
| `email` | Input (email) | Required, valid email format | User's registered email address |
| `pin` | Input (password) | Required, exactly 6 digits | 6-digit PIN code |

### 4.2.3 Validation Rules

```typescript
// Email Validation
- Must be non-empty
- Must match email regex pattern
- Case-insensitive matching

// PIN Validation
- Must be exactly 6 characters
- Must contain only digits (0-9)
- Masked display (â— characters)
```

### 4.2.4 Error States

| Error Code | Display Message | Recovery Action |
|------------|-----------------|-----------------|
| `auth/user-not-found` | "No account found with this email" | Link to signup |
| `auth/wrong-password` | "Incorrect PIN" | Increment badLoginAttempts |
| `auth/too-many-requests` | "Too many attempts. Try again later" | Wait period |
| `account-locked` | "Account locked. Contact admin" | Admin reset required |

### 4.2.5 Security Features

- **Bad Login Counter**: Tracks failed login attempts in `users/{uid}.badLoginAttempts`
- **Account Lockout**: After 5 failed attempts, account requires admin intervention
- **Forced PIN Change**: `mustChangePin` flag redirects to PIN reset flow
- **Session Persistence**: Firebase handles session tokens automatically

## 4.3 Signup Page (`/signup`)

### 4.3.1 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                         â”‚    CREATE ACCOUNT   â”‚                         â”‚
â”‚                         â”‚    (Signup Card)    â”‚                         â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  Step 1: Account Details                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Email Address                                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ [________________________________]                          â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Team Name (Primary)                                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ [________________________________]                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â„¹ï¸ This will be your display name in standings              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Secondary Team Name (Optional)                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ [________________________________]                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â„¹ï¸ Alternative name for display                             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  Step 2: Security                                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Create PIN (6 digits)                                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ [â— â— â— â— â— â—]                                               â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Confirm PIN                                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ [â— â— â— â— â— â—]                                               â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚              CREATE ACCOUNT                               â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  Already have an account? Login                                  â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3.2 Field Specifications

| Field | Type | Required | Validation | Database Field |
|-------|------|----------|------------|----------------|
| `email` | Input (email) | Yes | Valid email, unique | `users/{uid}.email` |
| `teamName` | Input (text) | Yes | 2-50 chars, unique | `users/{uid}.teamName` |
| `secondaryTeamName` | Input (text) | No | 2-50 chars if provided | `users/{uid}.secondaryTeamName` |
| `pin` | Input (password) | Yes | Exactly 6 digits | Firebase Auth password |
| `confirmPin` | Input (password) | Yes | Must match `pin` | N/A (validation only) |

### 4.3.3 Signup Process Flow

```typescript
// Step 1: Validate all inputs
validateEmail(email)           // Format check
checkEmailUnique(email)        // Firestore query
validateTeamName(teamName)     // Length + uniqueness
validatePin(pin, confirmPin)   // Match check

// Step 2: Create Firebase Auth account
const userCredential = await createUserWithEmailAndPassword(auth, email, pin)

// Step 3: Create Firestore user document
await setDoc(doc(db, 'users', userCredential.user.uid), {
  email: email,
  teamName: teamName,
  secondaryTeamName: secondaryTeamName || null,
  isAdmin: false,
  mustChangePin: false,
  badLoginAttempts: 0,
  emailPreferences: {
    rankingChanges: true,
    raceReminders: true,
    newsFeed: true,
    resultsNotifications: true
  },
  createdAt: serverTimestamp(),
  updatedAt: serverTimestamp()
})

// Step 4: Send welcome email
await sendWelcomeEmail(email, teamName)

// Step 5: Log audit event
await logAuditEvent(db, uid, 'user_signup', { email, teamName })

// Step 6: Redirect to dashboard
router.push('/dashboard')
```

### 4.3.4 Uniqueness Validation

The system ensures no duplicate team names exist:

```typescript
// Check primary team name uniqueness
const primaryQuery = query(
  collection(db, 'users'),
  where('teamName', '==', teamName)
)
const primarySnapshot = await getDocs(primaryQuery)
if (!primarySnapshot.empty) {
  throw new Error('Team name already taken')
}

// Check secondary team name doesn't conflict
const secondaryQuery = query(
  collection(db, 'users'),
  where('secondaryTeamName', '==', teamName)
)
```

## 4.4 Forgot PIN Page (`/forgot-pin`)

### 4.4.1 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                         â”‚    RESET YOUR PIN   â”‚                         â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  Enter your email address and we'll send you a link to reset    â”‚ â”‚
â”‚  â”‚  your PIN.                                                       â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Email Address                                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ [________________________________]                          â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚              SEND RESET LINK                              â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  âœ… Success: Check your email for the reset link                â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â”‚  Back to Login                                                   â”‚ â”‚
â”‚  â”‚                                                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4.2 Reset Process

```typescript
// Firebase handles the password reset flow
await sendPasswordResetEmail(auth, email)

// User receives email with reset link
// Link directs to Firebase-hosted reset page
// User enters new PIN
// Firebase updates the password

// On next login, user uses new PIN
```

## 4.5 AuthGuard Component

The AuthGuard wraps all protected pages and handles authentication state:

```typescript
// Location: src/components/AuthGuard.tsx

export function AuthGuard({ children }: { children: React.ReactNode }) {
  const { firebaseUser, userData, loading } = useAuth()
  const router = useRouter()
  const pathname = usePathname()

  useEffect(() => {
    if (!loading) {
      if (!firebaseUser) {
        // Not logged in - redirect to login
        router.push('/login')
      } else if (userData?.mustChangePin) {
        // Must change PIN - redirect to reset
        router.push('/reset-pin')
      } else if (pathname.startsWith('/admin') && !userData?.isAdmin) {
        // Not admin trying to access admin - redirect
        router.push('/dashboard')
      }
    }
  }, [firebaseUser, userData, loading, pathname, router])

  if (loading) {
    return <LoadingSpinner />
  }

  return <>{children}</>
}
```

## 4.6 Protected Routes

| Route Pattern | Protection Level | Admin Required |
|---------------|------------------|----------------|
| `/login` | Public | No |
| `/signup` | Public | No |
| `/forgot-pin` | Public | No |
| `/dashboard` | Authenticated | No |
| `/predictions` | Authenticated | No |
| `/standings` | Authenticated | No |
| `/results` | Authenticated | No |
| `/teams` | Authenticated | No |
| `/submissions` | Authenticated | No |
| `/schedule` | Authenticated | No |
| `/rules` | Authenticated | No |
| `/profile` | Authenticated | No |
| `/about` | Authenticated | No |
| `/admin` | Authenticated | **Yes** |
| `/admin/*` | Authenticated | **Yes** |

---

# 5. User-Facing Pages

## 5.1 Dashboard Page (`/dashboard`)

### 5.1.1 Purpose
The dashboard serves as the main landing page after login, providing quick access to the next race and important league information.

### 5.1.2 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         HEADER / NAV                             â”‚   â”‚
â”‚  â”‚  [Logo]  Dashboard | Predictions | Standings | ... | [Profile]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     WELCOME BANNER                               â”‚   â”‚
â”‚  â”‚  Welcome back, {teamName}!                                       â”‚   â”‚
â”‚  â”‚  Your current position: #{rank}                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚     NEXT RACE CARD         â”‚  â”‚     YOUR STATS CARD              â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚  ğŸï¸ Australian Grand Prix  â”‚  â”‚  Total Points: 145               â”‚ â”‚
â”‚  â”‚  ğŸ“ Melbourne              â”‚  â”‚  Races Predicted: 5              â”‚ â”‚
â”‚  â”‚  ğŸ“… March 8, 2026          â”‚  â”‚  Best Finish: 2nd                â”‚ â”‚
â”‚  â”‚  â° Predictions lock in:   â”‚  â”‚  Avg Points/Race: 29             â”‚ â”‚
â”‚  â”‚     2d 14h 32m             â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚  [View Full Standings]           â”‚ â”‚
â”‚  â”‚  [Make Prediction â†’]       â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     RECENT ACTIVITY                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Results published for Chinese GP - You scored 28 points!     â”‚   â”‚
â”‚  â”‚  â€¢ New prediction submitted for Japanese GP                      â”‚   â”‚
â”‚  â”‚  â€¢ League standings updated                                      â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     HOT NEWS FEED                                â”‚   â”‚
â”‚  â”‚                     (AI-Generated F1 News)                       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ”¥ Breaking: Hamilton fastest in Ferrari testing...            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.1.3 Data Sources

| Component | Data Source | Update Frequency |
|-----------|-------------|------------------|
| Welcome Banner | `users/{uid}` | Real-time |
| Next Race Card | `RaceSchedule` (static) | Static |
| Countdown Timer | Client-side calculation | Every second |
| Your Stats | Aggregated from `scores` | Real-time |
| Recent Activity | Derived from user actions | Real-time |
| Hot News Feed | `app-settings/hot-news` | Real-time |

### 5.1.4 Key Functions

```typescript
// Find next upcoming race
const nextRace = findNextRace() // From lib/data.ts

// Calculate countdown
const countdownToQualifying = formatDistance(
  new Date(nextRace.qualifyingTime),
  new Date(),
  { addSuffix: true }
)

// Check if predictions are locked
const predictionsLocked = new Date() > new Date(nextRace.qualifyingTime)

// Get user's total points
const userScores = await getDocs(
  query(collection(db, 'scores'), where('userId', '==', uid))
)
const totalPoints = userScores.docs.reduce(
  (sum, doc) => sum + doc.data().totalPoints, 0
)
```

## 5.2 Predictions Page (`/predictions`)

### 5.2.1 Purpose
Allows users to make their race predictions by selecting and ordering 6 drivers they think will finish in the top 6 positions.

### 5.2.2 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  RACE PREDICTION                                 â”‚   â”‚
â”‚  â”‚  Australian Grand Prix - Melbourne                               â”‚   â”‚
â”‚  â”‚  Predictions lock: March 7, 2026 at 06:00 UTC                   â”‚   â”‚
â”‚  â”‚  â° Time remaining: 2d 14h 32m                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              â”‚  â”‚                                â”‚ â”‚
â”‚  â”‚   AVAILABLE DRIVERS          â”‚  â”‚   YOUR PREDICTION              â”‚ â”‚
â”‚  â”‚   (Drag from here)           â”‚  â”‚   (Drop here)                  â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚                                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ ğŸï¸ Verstappen (3)     â”‚  â”‚  â”‚  â”‚ P1: [Drop Driver Here]   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    Red Bull Racing     â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚ P2: [Drop Driver Here]   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ğŸï¸ Hamilton (44)      â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â”‚    Ferrari             â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚ P3: [Drop Driver Here]   â”‚ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â”‚ ğŸï¸ Norris (1)         â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚    McLaren             â”‚  â”‚  â”‚  â”‚ P4: [Drop Driver Here]   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ ğŸï¸ Leclerc (16)       â”‚  â”‚  â”‚  â”‚ P5: [Drop Driver Here]   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚    Ferrari             â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  ... (22 drivers total)      â”‚  â”‚  â”‚ P6: [Drop Driver Here]   â”‚ â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚                                     â”‚  â”‚    SUBMIT PREDICTION     â”‚ â”‚ â”‚
â”‚                                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚                                     â”‚                                â”‚ â”‚
â”‚                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2.3 Driver Cards

Each driver card displays:

| Element | Source | Example |
|---------|--------|---------|
| Driver Photo | `PlaceHolderImages[imageId]` | Driver headshot |
| Driver Name | `F1Drivers[id].name` | "Verstappen" |
| Car Number | `F1Drivers[id].number` | 3 |
| Team Name | `F1Drivers[id].team` | "Red Bull Racing" |
| Team Colour | CSS based on team | Red Bull blue |

### 5.2.4 F1 Drivers Data Structure

```typescript
// Location: src/lib/data.ts

export interface Driver {
  id: string;        // Unique identifier (lowercase)
  name: string;      // Display name
  number: number;    // Car number
  team: string;      // Team name
  imageId: string;   // Reference to PlaceHolderImages
}

export const F1Drivers: Driver[] = [
  // Red Bull Racing
  { id: 'verstappen', name: 'Verstappen', number: 3, team: 'Red Bull Racing', imageId: 'max-verstappen' },
  { id: 'hadjar', name: 'Hadjar', number: 6, team: 'Red Bull Racing', imageId: 'isack-hadjar' },
  // Ferrari
  { id: 'leclerc', name: 'Leclerc', number: 16, team: 'Ferrari', imageId: 'charles-leclerc' },
  { id: 'hamilton', name: 'Hamilton', number: 44, team: 'Ferrari', imageId: 'lewis-hamilton' },
  // McLaren
  { id: 'norris', name: 'Norris', number: 1, team: 'McLaren', imageId: 'lando-norris' },
  { id: 'piastri', name: 'Piastri', number: 81, team: 'McLaren', imageId: 'oscar-piastri' },
  // Mercedes
  { id: 'russell', name: 'Russell', number: 63, team: 'Mercedes', imageId: 'george-russell' },
  { id: 'antonelli', name: 'Antonelli', number: 12, team: 'Mercedes', imageId: 'kimi-antonelli' },
  // Aston Martin
  { id: 'alonso', name: 'Alonso', number: 14, team: 'Aston Martin', imageId: 'fernando-alonso' },
  { id: 'stroll', name: 'Stroll', number: 18, team: 'Aston Martin', imageId: 'lance-stroll' },
  // Alpine
  { id: 'gasly', name: 'Gasly', number: 10, team: 'Alpine', imageId: 'pierre-gasly' },
  { id: 'colapinto', name: 'Colapinto', number: 43, team: 'Alpine', imageId: 'franco-colapinto' },
  // Williams
  { id: 'albon', name: 'Albon', number: 23, team: 'Williams', imageId: 'alexander-albon' },
  { id: 'sainz', name: 'Sainz', number: 55, team: 'Williams', imageId: 'carlos-sainz' },
  // Racing Bulls
  { id: 'lawson', name: 'Lawson', number: 30, team: 'Racing Bulls', imageId: 'liam-lawson' },
  { id: 'lindblad', name: 'Lindblad', number: 41, team: 'Racing Bulls', imageId: 'arvid-lindblad' },
  // Audi (formerly Sauber)
  { id: 'hulkenberg', name: 'Hulkenberg', number: 27, team: 'Audi', imageId: 'nico-hulkenberg' },
  { id: 'bortoleto', name: 'Bortoleto', number: 5, team: 'Audi', imageId: 'gabriel-bortoleto' },
  // Haas F1 Team
  { id: 'ocon', name: 'Ocon', number: 31, team: 'Haas F1 Team', imageId: 'esteban-ocon' },
  { id: 'bearman', name: 'Bearman', number: 87, team: 'Haas F1 Team', imageId: 'oliver-bearman' },
  // Cadillac F1 Team
  { id: 'perez', name: 'Perez', number: 11, team: 'Cadillac F1 Team', imageId: 'sergio-perez' },
  { id: 'bottas', name: 'Bottas', number: 77, team: 'Cadillac F1 Team', imageId: 'valtteri-bottas' },
];
```

### 5.2.5 Prediction Submission Process

```typescript
// Step 1: Validate 6 unique drivers selected
if (selectedDrivers.length !== 6) {
  throw new Error('Must select exactly 6 drivers')
}

// Step 2: Check predictions not locked
const race = findNextRace()
if (new Date() > new Date(race.qualifyingTime)) {
  throw new Error('Predictions are locked for this race')
}

// Step 3: Generate raceId
const raceId = race.name.replace(/\s+/g, '-') // "Australian-Grand-Prix"

// Step 4: Write to user's predictions subcollection
const predictionRef = doc(db, 'users', uid, 'predictions', raceId)
await setDoc(predictionRef, {
  raceId: raceId,
  predictions: selectedDrivers.map(d => d.id), // ['verstappen', 'hamilton', ...]
  createdAt: serverTimestamp(),
  updatedAt: serverTimestamp()
})

// Step 5: Mirror to prediction_submissions (for admin queries)
const submissionRef = doc(collection(db, 'prediction_submissions'))
await setDoc(submissionRef, {
  userId: uid,
  teamId: uid,
  teamName: userData.teamName,
  raceId: raceId,
  predictions: {
    P1: selectedDrivers[0].id,
    P2: selectedDrivers[1].id,
    P3: selectedDrivers[2].id,
    P4: selectedDrivers[3].id,
    P5: selectedDrivers[4].id,
    P6: selectedDrivers[5].id,
  },
  submittedAt: serverTimestamp()
})

// Step 6: Log audit event
await logAuditEvent(db, uid, 'prediction_submitted', {
  raceId,
  drivers: selectedDrivers.map(d => d.id)
})
```

### 5.2.6 Prediction Lock Logic

```typescript
// Predictions lock at qualifying time
const isLocked = (race: Race): boolean => {
  return new Date() > new Date(race.qualifyingTime)
}

// UI shows different states
if (isLocked) {
  // Show read-only view of existing prediction
  // "Your prediction for this race"
  // Cannot modify
} else {
  // Show drag-and-drop interface
  // Can submit or update prediction
}
```

## 5.3 Standings Page (`/standings`)

### 5.3.1 Purpose
Displays the current league standings with all teams ranked by total points.

### 5.3.2 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    LEAGUE STANDINGS                              â”‚   â”‚
â”‚  â”‚                    2026 Season                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  RANK  â”‚  TEAM                â”‚  POINTS  â”‚  RACES  â”‚  AVG      â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  ğŸ¥‡ 1  â”‚  Speed Demons        â”‚    185   â”‚    5    â”‚   37.0    â”‚   â”‚
â”‚  â”‚  ğŸ¥ˆ 2  â”‚  Racing Knights      â”‚    172   â”‚    5    â”‚   34.4    â”‚   â”‚
â”‚  â”‚  ğŸ¥‰ 3  â”‚  Grid Masters        â”‚    168   â”‚    5    â”‚   33.6    â”‚   â”‚
â”‚  â”‚     4  â”‚  Apex Hunters        â”‚    155   â”‚    5    â”‚   31.0    â”‚   â”‚
â”‚  â”‚     5  â”‚  The Podium Chasers  â”‚    149   â”‚    5    â”‚   29.8    â”‚   â”‚
â”‚  â”‚  â¡ï¸ 6  â”‚  **Your Team Name**  â”‚    145   â”‚    5    â”‚   29.0    â”‚   â”‚
â”‚  â”‚     7  â”‚  Pit Stop Warriors   â”‚    138   â”‚    5    â”‚   27.6    â”‚   â”‚
â”‚  â”‚     8  â”‚  DRS Zone Racers     â”‚    132   â”‚    5    â”‚   26.4    â”‚   â”‚
â”‚  â”‚     9  â”‚  Slipstream Squad    â”‚    125   â”‚    5    â”‚   25.0    â”‚   â”‚
â”‚  â”‚    10  â”‚  Tyre Whisperers     â”‚    118   â”‚    5    â”‚   23.6    â”‚   â”‚
â”‚  â”‚   ...  â”‚  ...                 â”‚   ...    â”‚   ...   â”‚   ...     â”‚   â”‚
â”‚  â”‚    20  â”‚  Backmarkers United  â”‚     42   â”‚    5    â”‚    8.4    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    STANDINGS CHART                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   Points â”‚                                                       â”‚   â”‚
â”‚  â”‚    200 â”¤                                           â—            â”‚   â”‚
â”‚  â”‚    180 â”¤                                    â—â”€â”€â”€â”€â”€â—             â”‚   â”‚
â”‚  â”‚    160 â”¤                             â—â”€â”€â”€â”€â”€â—                    â”‚   â”‚
â”‚  â”‚    140 â”¤                      â—â”€â”€â”€â”€â”€â—                           â”‚   â”‚
â”‚  â”‚    120 â”¤               â—â”€â”€â”€â”€â”€â—                                  â”‚   â”‚
â”‚  â”‚    100 â”¤        â—â”€â”€â”€â”€â”€â—                                         â”‚   â”‚
â”‚  â”‚     80 â”¤ â—â”€â”€â”€â”€â”€â—                                                â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚           R1    R2    R3    R4    R5    R6    R7    R8          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3.3 Standings Calculation

```typescript
// Location: Derived from scores collection

interface StandingsEntry {
  rank: number;
  teamName: string;
  userId: string;
  totalPoints: number;
  racesCompleted: number;
  averagePoints: number;
  isCurrentUser: boolean;
}

async function calculateStandings(db: Firestore, currentUserId: string): Promise<StandingsEntry[]> {
  // Get all scores
  const scoresSnapshot = await getDocs(collection(db, 'scores'))

  // Aggregate by user
  const userPoints = new Map<string, { total: number; races: number }>()
  scoresSnapshot.forEach(doc => {
    const data = doc.data()
    const userId = data.userId
    const existing = userPoints.get(userId) || { total: 0, races: 0 }
    userPoints.set(userId, {
      total: existing.total + data.totalPoints,
      races: existing.races + 1
    })
  })

  // Get user names
  const usersSnapshot = await getDocs(collection(db, 'users'))
  const userNames = new Map<string, string>()
  usersSnapshot.forEach(doc => {
    userNames.set(doc.id, doc.data().teamName)
  })

  // Build standings array
  const standings = Array.from(userPoints.entries())
    .map(([userId, stats]) => ({
      userId,
      teamName: userNames.get(userId) || 'Unknown',
      totalPoints: stats.total,
      racesCompleted: stats.races,
      averagePoints: stats.races > 0 ? stats.total / stats.races : 0,
      isCurrentUser: userId === currentUserId,
      rank: 0
    }))
    .sort((a, b) => b.totalPoints - a.totalPoints)

  // Assign ranks (with ties)
  let currentRank = 1
  standings.forEach((entry, index) => {
    if (index > 0 && entry.totalPoints < standings[index - 1].totalPoints) {
      currentRank = index + 1
    }
    entry.rank = currentRank
  })

  return standings
}
```

### 5.3.4 Tie-Breaking Rules

When teams have equal points:
1. Same rank is assigned to tied teams
2. Next rank skips (e.g., two teams tied at 2nd means next is 4th)
3. No secondary tie-breaker is currently implemented

## 5.4 Results Page (`/results`)

### 5.4.1 Purpose
Displays official race results and shows how each team scored.

### 5.4.2 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    RACE RESULTS                                  â”‚   â”‚
â”‚  â”‚  Select a race to view results and scores                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Race: [Australian Grand Prix        â–¼]                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              â”‚  â”‚                                â”‚ â”‚
â”‚  â”‚   OFFICIAL TOP 6             â”‚  â”‚   YOUR PREDICTION              â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚                                â”‚ â”‚
â”‚  â”‚   P1: ğŸï¸ Verstappen (+5)    â”‚  â”‚   P1: Verstappen âœ… +5         â”‚ â”‚
â”‚  â”‚   P2: ğŸï¸ Norris             â”‚  â”‚   P2: Hamilton   âŒ +3         â”‚ â”‚
â”‚  â”‚   P3: ğŸï¸ Leclerc            â”‚  â”‚   P3: Norris     âŒ +3         â”‚ â”‚
â”‚  â”‚   P4: ğŸï¸ Piastri            â”‚  â”‚   P4: Leclerc    âŒ +3         â”‚ â”‚
â”‚  â”‚   P5: ğŸï¸ Hamilton           â”‚  â”‚   P5: Piastri    âŒ +3         â”‚ â”‚
â”‚  â”‚   P6: ğŸï¸ Russell            â”‚  â”‚   P6: Russell    âœ… +5         â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚                                â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚   Total: 22 points             â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚   (5/6 in top 6, 2 exact)     â”‚ â”‚
â”‚  â”‚                              â”‚  â”‚                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ALL TEAM SCORES                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  TEAM              â”‚  PREDICTION                      â”‚  POINTS  â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  Speed Demons      â”‚  VER,NOR,LEC,PIA,HAM,RUS        â”‚    40    â”‚   â”‚
â”‚  â”‚  Racing Knights    â”‚  VER,HAM,NOR,LEC,PIA,RUS        â”‚    28    â”‚   â”‚
â”‚  â”‚  **Your Team**     â”‚  VER,HAM,NOR,LEC,PIA,RUS        â”‚    22    â”‚   â”‚
â”‚  â”‚  ...               â”‚  ...                            â”‚   ...    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4.3 Score Breakdown Display

| Symbol | Meaning | Points |
|--------|---------|--------|
| âœ… | Exact position match | +5 |
| âŒ | In top 6 but wrong position | +3 |
| â­• | Not in top 6 | +0 |
| ğŸ¯ | All 6 correct bonus | +10 |

## 5.5 Teams Page (`/teams`)

### 5.5.1 Purpose
Displays all registered teams/players in the league.

### 5.5.2 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    LEAGUE TEAMS                                  â”‚   â”‚
â”‚  â”‚                    20 Active Teams                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  Speed       â”‚  â”‚  Racing      â”‚  â”‚  Grid        â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  Demons      â”‚  â”‚  Knights     â”‚  â”‚  Masters     â”‚          â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  Rank: #1    â”‚  â”‚  Rank: #2    â”‚  â”‚  Rank: #3    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  185 pts     â”‚  â”‚  172 pts     â”‚  â”‚  168 pts     â”‚          â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚  Apex        â”‚  â”‚  Podium      â”‚  â”‚  Pit Stop    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  Hunters     â”‚  â”‚  Chasers     â”‚  â”‚  Warriors    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  Rank: #4    â”‚  â”‚  Rank: #5    â”‚  â”‚  Rank: #6    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  155 pts     â”‚  â”‚  149 pts     â”‚  â”‚  138 pts     â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ... (more team cards)                                          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5.6 Submissions Page (`/submissions`)

### 5.6.1 Purpose
Shows all predictions submitted for a selected race (visibility may be restricted until after qualifying).

### 5.6.2 Layout and Fields

| Column | Description |
|--------|-------------|
| Team Name | Team who submitted |
| P1-P6 | Driver predictions in order |
| Submitted At | Timestamp of submission |
| Status | Submitted / Pending |

## 5.7 Schedule Page (`/schedule`)

### 5.7.1 Purpose
Displays the full 2026 F1 race calendar with all 24 races.

### 5.7.2 Race Schedule Data

```typescript
// Location: src/lib/data.ts

export interface Race {
  name: string;          // "Australian Grand Prix"
  qualifyingTime: string; // UTC ISO string - when predictions lock
  sprintTime?: string;    // UTC ISO string (only for sprint weekends)
  raceTime: string;       // UTC ISO string - main GP time
  location: string;       // "Melbourne"
  hasSprint: boolean;     // true for sprint weekends
  results: (string | null)[]; // Not used (results in Firestore)
}

export const RaceSchedule: Race[] = [
  // 2026 Official F1 Calendar (24 races)
  { name: "Australian Grand Prix", location: "Melbourne",
    raceTime: "2026-03-08T05:00:00Z", qualifyingTime: "2026-03-07T06:00:00Z",
    hasSprint: false, results: [] },
  { name: "Chinese Grand Prix", location: "Shanghai",
    raceTime: "2026-03-15T07:00:00Z", qualifyingTime: "2026-03-13T07:00:00Z",
    sprintTime: "2026-03-14T07:00:00Z", hasSprint: true, results: [] },
  { name: "Japanese Grand Prix", location: "Suzuka",
    raceTime: "2026-03-29T06:00:00Z", qualifyingTime: "2026-03-28T07:00:00Z",
    hasSprint: false, results: [] },
  // ... 21 more races
  { name: "Abu Dhabi Grand Prix", location: "Yas Marina",
    raceTime: "2026-12-06T13:00:00Z", qualifyingTime: "2026-12-05T14:00:00Z",
    hasSprint: false, results: [] },
];
```

### 5.7.3 Sprint Weekends (6 total in 2026)

| Race | Location | Sprint Date |
|------|----------|-------------|
| Chinese GP | Shanghai | March 14 |
| Miami GP | Miami | May 2 |
| Canadian GP | Montreal | May 23 |
| British GP | Silverstone | July 4 |
| Dutch GP | Zandvoort | August 22 |
| Singapore GP | Singapore | October 10 |

## 5.8 Rules Page (`/rules`)

### 5.8.1 Purpose
Displays the Prix Six scoring rules and league guidelines.

### 5.8.2 Scoring Rules Content

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    PRIX SIX RULES                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  SCORING SYSTEM                                                  â”‚   â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                 â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  For each race, predict the top 6 finishers in order:           â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ +5 points for each driver in their EXACT predicted position  â”‚   â”‚
â”‚  â”‚  â€¢ +3 points for each driver in the top 6 but WRONG position    â”‚   â”‚
â”‚  â”‚  â€¢ +10 BONUS points if all 6 predictions are in the top 6       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚  MAXIMUM POSSIBLE SCORE PER RACE: 40 POINTS                 â”‚â”‚   â”‚
â”‚  â”‚  â”‚  (6 exact Ã— 5) + 10 bonus = 30 + 10 = 40                    â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  PREDICTION DEADLINE                                             â”‚   â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ Predictions lock at the START of Qualifying                  â”‚   â”‚
â”‚  â”‚  â€¢ For sprint weekends, predictions lock at Sprint Qualifying   â”‚   â”‚
â”‚  â”‚  â€¢ You can update your prediction until the deadline            â”‚   â”‚
â”‚  â”‚  â€¢ No predictions accepted after the deadline                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  EXAMPLE                                                         â”‚   â”‚
â”‚  â”‚  â•â•â•â•â•â•â•                                                         â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Your prediction: VER, HAM, NOR, LEC, PIA, RUS                  â”‚   â”‚
â”‚  â”‚  Actual result:   VER, NOR, LEC, PIA, HAM, RUS                  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Scoring breakdown:                                              â”‚   â”‚
â”‚  â”‚  â€¢ VER P1: Exact match â†’ +5                                     â”‚   â”‚
â”‚  â”‚  â€¢ HAM P2: In top 6, wrong position â†’ +3                        â”‚   â”‚
â”‚  â”‚  â€¢ NOR P3: In top 6, wrong position â†’ +3                        â”‚   â”‚
â”‚  â”‚  â€¢ LEC P4: In top 6, wrong position â†’ +3                        â”‚   â”‚
â”‚  â”‚  â€¢ PIA P5: In top 6, wrong position â†’ +3                        â”‚   â”‚
â”‚  â”‚  â€¢ RUS P6: Exact match â†’ +5                                     â”‚   â”‚
â”‚  â”‚  â€¢ All 6 in top 6 â†’ +10 bonus                                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Total: 5+3+3+3+3+5+10 = 32 points                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5.9 Profile Page (`/profile`)

### 5.9.1 Purpose
Allows users to view and update their account settings and preferences.

### 5.9.2 Page Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    YOUR PROFILE                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚   ACCOUNT DETAILS          â”‚  â”‚   EMAIL PREFERENCES              â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚   Email:                   â”‚  â”‚   â˜‘ï¸ Ranking Changes              â”‚ â”‚
â”‚  â”‚   user@email.com           â”‚  â”‚      Get notified when your     â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚      rank changes                â”‚ â”‚
â”‚  â”‚   Team Name:               â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚   Speed Demons             â”‚  â”‚   â˜‘ï¸ Race Reminders               â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚      Reminders before each       â”‚ â”‚
â”‚  â”‚   Secondary Team:          â”‚  â”‚      race weekend                â”‚ â”‚
â”‚  â”‚   The Demons               â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚   â˜‘ï¸ News Feed                    â”‚ â”‚
â”‚  â”‚   Member Since:            â”‚  â”‚      Hot news and updates        â”‚ â”‚
â”‚  â”‚   January 2026             â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚   â˜‘ï¸ Results Notifications        â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚      When race results are       â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚      published                   â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚   [Save Preferences]             â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   SECURITY                                                       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   [Change PIN]                                                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   [Sign Out]                                                     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.9.3 Email Preferences Structure

```typescript
// Location: users/{uid}.emailPreferences

interface EmailPreferences {
  rankingChanges: boolean;      // Notify on rank change
  raceReminders: boolean;       // Reminder before races
  newsFeed: boolean;            // Hot news emails
  resultsNotifications: boolean; // When results published
}

// Default values (set at signup)
const defaultPreferences: EmailPreferences = {
  rankingChanges: true,
  raceReminders: true,
  newsFeed: true,
  resultsNotifications: true
}
```

## 5.10 About Page (`/about`)

### 5.10.1 Purpose
Displays application version and credits.

### 5.10.2 Content

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ABOUT PRIX SIX                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   Version: 1.10.0                                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   Prix Six is a fantasy Formula 1 prediction league            â”‚   â”‚
â”‚  â”‚   application. Predict the top 6 finishers for each race       â”‚   â”‚
â”‚  â”‚   and compete against your friends!                             â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   Built with:                                                   â”‚   â”‚
â”‚  â”‚   â€¢ Next.js 15                                                  â”‚   â”‚
â”‚  â”‚   â€¢ React 19                                                    â”‚   â”‚
â”‚  â”‚   â€¢ Firebase                                                    â”‚   â”‚
â”‚  â”‚   â€¢ Tailwind CSS                                                â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   Â© 2026 Prix Six. All rights reserved.                        â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# 6. Admin Dashboard

## 6.1 Overview

The Admin Dashboard is a comprehensive 10-tab interface for managing all aspects of the Prix Six application. Access is restricted to users with `isAdmin: true` in their user document.

### 6.1.1 Access Control

```typescript
// Admin check in AuthGuard
if (pathname.startsWith('/admin') && !userData?.isAdmin) {
  router.push('/dashboard')
  return
}

// Protected admin accounts
const PROTECTED_ADMIN_EMAILS = [
  'aaron@garcia.ltd',      // Primary admin
  'aaron.garcia@hotmail.co.uk' // Secondary admin
]
```

### 6.1.2 Tab Overview

| Tab # | Tab Name | Purpose | Key Actions |
|-------|----------|---------|-------------|
| 1 | Site Functions | Global site controls | Lock predictions, toggle features |
| 2 | Team Manager | User management | View/edit users, reset PINs |
| 3 | Results Manager | Race results entry | Enter P1-P6, calculate scores |
| 4 | Scoring Manager | Score management | View/recalculate scores |
| 5 | Hot News Manager | AI news content | Generate/edit/publish news |
| 6 | Online Users | User presence | View who's online |
| 7 | Email Log | Email history | View sent emails |
| 8 | Audit Manager | Audit trail | View user actions |
| 9 | WhatsApp Manager | WhatsApp alerts | Send messages, configure alerts |
| 10 | Consistency Checker | Data validation | Run checks, view issues |

## 6.2 Tab 1: Site Functions Manager

### 6.2.1 Purpose
Controls global site settings including prediction locks and feature toggles.

### 6.2.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    SITE FUNCTIONS                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  PREDICTION CONTROLS                                             â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Lock Status: ğŸ”“ Unlocked                                        â”‚   â”‚
â”‚  â”‚  Next Race: Australian Grand Prix                                â”‚   â”‚
â”‚  â”‚  Auto-lock at: March 7, 2026 06:00 UTC                          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  [ğŸ”’ Lock Predictions Now]  [ğŸ”“ Unlock Predictions]             â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  FEATURE TOGGLES                                                 â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â˜‘ï¸ Hot News Feed Enabled                                        â”‚   â”‚
â”‚  â”‚  â˜‘ï¸ Email Notifications Enabled                                  â”‚   â”‚
â”‚  â”‚  â˜ Maintenance Mode                                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2.3 Firestore Document

```typescript
// Collection: app-settings
// Document: hot-news

interface HotNewsSettings {
  isLocked: boolean;           // Predictions locked
  hotNewsFeedEnabled: boolean; // AI news toggle
  content: string;             // Current hot news content
  lastUpdated: Timestamp;      // Last modification time
}
```

## 6.3 Tab 2: Team Manager

### 6.3.1 Purpose
Manage all registered users/teams in the league.

### 6.3.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    TEAM MANAGER                                  â”‚   â”‚
â”‚  â”‚                    20 Teams Registered                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Search: [________________________]  [Filter: All â–¼]            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  TEAM          â”‚ EMAIL              â”‚ ADMIN â”‚ ACTIONS           â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  Speed Demons  â”‚ user1@email.com    â”‚  No   â”‚ [Edit] [Reset PIN]â”‚   â”‚
â”‚  â”‚  Racing Knightsâ”‚ user2@email.com    â”‚  No   â”‚ [Edit] [Reset PIN]â”‚   â”‚
â”‚  â”‚  Admin Team    â”‚ aaron@garcia.ltd   â”‚  Yes  â”‚ [Protected]       â”‚   â”‚
â”‚  â”‚  ...           â”‚ ...                â”‚  ...  â”‚ ...               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3.3 Available Actions

| Action | Description | Firestore Update |
|--------|-------------|------------------|
| Edit Team Name | Change display name | `users/{uid}.teamName` |
| Reset PIN | Force PIN change | `users/{uid}.mustChangePin = true` |
| Toggle Admin | Grant/revoke admin | `users/{uid}.isAdmin` |
| Clear Bad Logins | Reset lockout | `users/{uid}.badLoginAttempts = 0` |

### 6.3.4 Protected Users

The following users cannot be modified:
- `aaron@garcia.ltd` (Primary admin)
- `aaron.garcia@hotmail.co.uk` (Secondary admin)

## 6.4 Tab 3: Results Manager

### 6.4.1 Purpose
Enter official race results which triggers score calculation.

### 6.4.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    RESULTS MANAGER                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Select Race: [Australian Grand Prix           â–¼]               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ENTER TOP 6 FINISHERS                                          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  P1 (Winner):    [Verstappen              â–¼]                    â”‚   â”‚
â”‚  â”‚  P2 (2nd Place): [Norris                  â–¼]                    â”‚   â”‚
â”‚  â”‚  P3 (3rd Place): [Leclerc                 â–¼]                    â”‚   â”‚
â”‚  â”‚  P4 (4th Place): [Piastri                 â–¼]                    â”‚   â”‚
â”‚  â”‚  P5 (5th Place): [Hamilton                â–¼]                    â”‚   â”‚
â”‚  â”‚  P6 (6th Place): [Russell                 â–¼]                    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  âš ï¸ Warning: Submitting will calculate scores for all players  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â˜ Send email notifications to all players                      â”‚   â”‚
â”‚  â”‚  â˜ Send WhatsApp notification to group                         â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  [Submit Results & Calculate Scores]                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  EXISTING RESULTS                                                â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  RACE                  â”‚ RESULT                    â”‚ ACTIONS    â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  Australian GP         â”‚ VER, NOR, LEC, PIA, HAM.. â”‚ [Delete]   â”‚   â”‚
â”‚  â”‚  Chinese GP            â”‚ (No results yet)          â”‚ -          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4.3 Results Submission API

```typescript
// API: POST /api/admin/update-scores

interface UpdateScoresRequest {
  raceId: string;
  results: {
    driver1: string;
    driver2: string;
    driver3: string;
    driver4: string;
    driver5: string;
    driver6: string;
  };
  sendEmails?: boolean;
  sendWhatsApp?: boolean;
}

interface UpdateScoresResponse {
  success: boolean;
  scoresUpdated: number;
  scores: Array<{
    teamName: string;
    prediction: string;
    points: number;
  }>;
  standings: Array<{
    rank: number;
    teamName: string;
    totalPoints: number;
  }>;
}
```

### 6.4.4 Race Results Firestore Document

```typescript
// Collection: race_results
// Document ID: {raceId} (e.g., "Australian-Grand-Prix")

interface RaceResultData {
  id: string;           // Document ID
  raceId: string;       // Race identifier
  driver1: string;      // P1 driver ID
  driver2: string;      // P2 driver ID
  driver3: string;      // P3 driver ID
  driver4: string;      // P4 driver ID
  driver5: string;      // P5 driver ID
  driver6: string;      // P6 driver ID
  submittedAt: Timestamp;
  submittedBy: string;  // Admin user ID
}
```

## 6.5 Tab 4: Scoring Manager

### 6.5.1 Purpose
View and manage calculated scores for each race.

### 6.5.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    SCORING MANAGER                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Select Race: [Australian Grand Prix           â–¼]               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  RACE SCORES                                                     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  TEAM           â”‚ PREDICTION                    â”‚ POINTS â”‚ BRDN â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  Speed Demons   â”‚ VER,NOR,LEC,PIA,HAM,RUS      â”‚   40   â”‚ 6Ã—5  â”‚   â”‚
â”‚  â”‚  Racing Knights â”‚ VER,HAM,NOR,LEC,PIA,RUS      â”‚   28   â”‚ 2Ã—5  â”‚   â”‚
â”‚  â”‚  ...            â”‚ ...                          â”‚  ...   â”‚ ...  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  [Recalculate All Scores]                                       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5.3 Score Document Structure

```typescript
// Collection: scores
// Document ID: {raceId}_{userId}

interface ScoreData {
  id: string;           // Document ID
  userId: string;       // User reference
  oduserId: string;     // Alternate user ref (legacy)
  raceId: string;       // Race reference
  totalPoints: number;  // Calculated score (0-40)
  breakdown: string;    // Human-readable breakdown
  calculatedAt?: Timestamp;
}

// Example breakdown:
// "Verstappen+5, Hamilton+3, Norris+3, Leclerc+3, Piastri+3, Russell+5, BonusAll6+10"
```

## 6.6 Tab 5: Hot News Manager

### 6.6.1 Purpose
Manage AI-generated F1 news content displayed on the dashboard.

### 6.6.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    HOT NEWS MANAGER                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  STATUS                                                          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€                                                          â”‚   â”‚
â”‚  â”‚  Hot News Enabled: â˜‘ï¸ Yes                                        â”‚   â”‚
â”‚  â”‚  Last Updated: January 20, 2026 14:30                           â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  CURRENT CONTENT                                                 â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ Breaking news from the F1 paddock! Hamilton has shown       â”‚â”‚   â”‚
â”‚  â”‚  â”‚ impressive pace in his first Ferrari testing sessions...    â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚ (Editable text area)                                        â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  [Save Changes]                                                  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  AI GENERATION                                                   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Topic/Prompt: [________________________________]               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  [ğŸ¤– Generate with Gemini]                                      â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  âš ï¸ This will replace current content                          â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.6.3 AI Integration (Genkit + Gemini)

```typescript
// Location: src/ai/flows/hot-news.ts

import { genkit } from 'genkit';
import { googleGenAI } from '@genkit-ai/google-genai';

const ai = genkit({
  plugins: [googleGenAI()],
});

export const generateHotNews = ai.defineFlow(
  {
    name: 'generateHotNews',
    inputSchema: z.object({
      topic: z.string().optional(),
      style: z.enum(['breaking', 'analysis', 'preview']).default('breaking'),
    }),
    outputSchema: z.string(),
  },
  async (input) => {
    const prompt = `Generate exciting F1 news content about ${input.topic || 'current F1 developments'}.
    Style: ${input.style}
    Keep it under 500 words, engaging, and suitable for a fantasy F1 league audience.`;

    const response = await ai.generate({
      model: 'gemini-2.5-flash',
      prompt,
    });

    return response.text();
  }
);
```

## 6.7 Tab 6: Online Users Manager

### 6.7.1 Purpose
View real-time user presence and activity.

### 6.7.2 Presence Tracking

```typescript
// Collection: presence
// Document ID: {userId}

interface PresenceData {
  id: string;
  oduserId: string;     // User ID
  online: boolean;      // Currently online
  lastSeen: Timestamp;  // Last activity
  currentPage: string;  // Current route
}

// Real-time listener
const presenceQuery = query(
  collection(db, 'presence'),
  where('online', '==', true)
)

onSnapshot(presenceQuery, (snapshot) => {
  const onlineUsers = snapshot.docs.map(doc => doc.data())
  setOnlineUsers(onlineUsers)
})
```

## 6.8 Tab 7: Email Log Manager

### 6.8.1 Purpose
View history of all emails sent by the system.

### 6.8.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    EMAIL LOG                                     â”‚   â”‚
â”‚  â”‚                    Last 50 Emails                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  DATE       â”‚ TYPE     â”‚ RECIPIENT        â”‚ SUBJECT    â”‚ STATUS â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  2026-01-20 â”‚ welcome  â”‚ user@email.com   â”‚ Welcome... â”‚ âœ…sent â”‚   â”‚
â”‚  â”‚  2026-01-19 â”‚ results  â”‚ user2@email.com  â”‚ Results... â”‚ âœ…sent â”‚   â”‚
â”‚  â”‚  2026-01-19 â”‚ results  â”‚ user3@email.com  â”‚ Results... â”‚ âŒfail â”‚   â”‚
â”‚  â”‚  ...        â”‚ ...      â”‚ ...              â”‚ ...        â”‚ ...    â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.8.3 Email Log Document

```typescript
// Collection: email_logs

interface EmailLogEntry {
  id: string;
  toEmail: string;        // Recipient
  subject: string;        // Subject line
  type: string;           // welcome | results | hot_news
  teamName: string;       // User's team name
  emailGuid: string;      // Unique tracking GUID
  sentAt: Timestamp;
  status: 'sent' | 'failed';
}
```

## 6.9 Tab 8: Audit Manager

### 6.9.1 Purpose
View comprehensive audit trail of all user actions.

### 6.9.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    AUDIT LOG                                     â”‚   â”‚
â”‚  â”‚                    User Activity Trail                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Filter by User: [All Users              â–¼]                     â”‚   â”‚
â”‚  â”‚  Filter by Action: [All Actions          â–¼]                     â”‚   â”‚
â”‚  â”‚  Date Range: [2026-01-01] to [2026-01-21]                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  TIMESTAMP           â”‚ USER   â”‚ ACTION      â”‚ DETAILS           â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  2026-01-20 14:32:01 â”‚ user1  â”‚ navigate    â”‚ /predictions      â”‚   â”‚
â”‚  â”‚  2026-01-20 14:30:45 â”‚ user1  â”‚ prediction  â”‚ Australian GP     â”‚   â”‚
â”‚  â”‚  2026-01-20 14:28:12 â”‚ user2  â”‚ login       â”‚ success           â”‚   â”‚
â”‚  â”‚  2026-01-20 14:25:00 â”‚ admin  â”‚ admin_actionâ”‚ results_entered   â”‚   â”‚
â”‚  â”‚  ...                 â”‚ ...    â”‚ ...         â”‚ ...               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.9.3 Audit Log Document

```typescript
// Collection: audit_logs

interface AuditLogEntry {
  id: string;
  userId: string;         // Acting user
  action: string;         // Action type
  details: object;        // Action metadata
  correlationId: string;  // Session correlation ID
  timestamp: Timestamp;
}

// Common action types:
// - navigate: Page navigation
// - prediction_submitted: User made prediction
// - login: User logged in
// - signup: New user registered
// - admin_action: Admin performed action
// - email_sent: Email was sent
// - settings_changed: User changed settings
```

## 6.10 Tab 9: WhatsApp Manager

### 6.10.1 Purpose
Configure and send WhatsApp notifications to the league group.

### 6.10.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    WHATSAPP MANAGER                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚   CONNECTION STATUS        â”‚  â”‚   ALERT SETTINGS                 â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚   Status: ğŸŸ¢ Connected     â”‚  â”‚   Master Switch: [ON]           â”‚ â”‚
â”‚  â”‚   Storage: Azure           â”‚  â”‚   Test Mode: â˜                  â”‚ â”‚
â”‚  â”‚   Groups: 3 available      â”‚  â”‚   Target Group: [Prix Six â–¼]    â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚   [Refresh Status]         â”‚  â”‚                                  â”‚ â”‚
â”‚  â”‚                            â”‚  â”‚                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ALERT TYPES (Accordion)                                        â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â–¼ Race Weekend                                                  â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ Qualifying Reminder                                        â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ Race Reminder                                               â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ Results Published                                           â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â–¼ Player Activity                                               â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ New Player Joined                                           â”‚   â”‚
â”‚  â”‚    â˜ Prediction Submitted (disabled by default)                  â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ Late Prediction Warning                                     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â–¼ League Summary                                                â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ Weekly Standings Update                                     â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ End of Season Summary                                       â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â–¼ Admin/Manual                                                  â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ Hot News Published                                          â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ Admin Announcements                                         â”‚   â”‚
â”‚  â”‚    â˜‘ï¸ Custom Messages                                             â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  CUSTOM MESSAGE                                                  â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ Type your message here...                                   â”‚â”‚   â”‚
â”‚  â”‚  â”‚                                                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚ (500 character limit)                                       â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Characters: 0/500                                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  [Send Message]                                                 â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ALERT HISTORY                                                   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  TIME      â”‚ TYPE        â”‚ STATUS  â”‚ MESSAGE                    â”‚   â”‚
â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚
â”‚  â”‚  14:30     â”‚ custom      â”‚ âœ… SENT â”‚ Good luck everyone!        â”‚   â”‚
â”‚  â”‚  10:00     â”‚ race_remind â”‚ âœ… SENT â”‚ Race starts in 4 hours!    â”‚   â”‚
â”‚  â”‚  09:00     â”‚ custom      â”‚ âŒ FAIL â”‚ Error: Group not found     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.10.3 WhatsApp Alert Configuration

```typescript
// Collection: admin_configuration
// Document: whatsapp_alerts

interface WhatsAppAlertToggles {
  // Race Weekend
  qualifyingReminder: boolean;
  raceReminder: boolean;
  resultsPublished: boolean;
  // Player Activity
  newPlayerJoined: boolean;
  predictionSubmitted: boolean;
  latePredictionWarning: boolean;
  // League Summary
  weeklyStandingsUpdate: boolean;
  endOfSeasonSummary: boolean;
  // Admin/Manual
  hotNewsPublished: boolean;
  adminAnnouncements: boolean;
  customMessages: boolean;
}

interface WhatsAppAlertSettings {
  masterEnabled: boolean;    // Global on/off
  testMode: boolean;         // Test mode flag
  targetGroup: string;       // Default group name
  alerts: WhatsAppAlertToggles;
  lastUpdated: Timestamp;
  updatedBy: string;         // Admin user ID
}
```

## 6.11 Tab 10: Consistency Checker

### 6.11.1 Purpose
Validate data integrity across all collections and identify issues.

### 6.11.2 Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    CONSISTENCY CHECKER                           â”‚   â”‚
â”‚  â”‚                    Data Validation Tool                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Run Full Check]                                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  Last Run: January 20, 2026 14:30:00                            â”‚   â”‚
â”‚  â”‚  Correlation ID: cc_1768954664712_1u8qrk                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  SUMMARY                                                         â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€                                                         â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚  TOTAL  â”‚  â”‚ PASSED  â”‚  â”‚ WARNINGSâ”‚  â”‚ ERRORS  â”‚            â”‚   â”‚
â”‚  â”‚  â”‚    7    â”‚  â”‚    5    â”‚  â”‚    1    â”‚  â”‚    1    â”‚            â”‚   â”‚
â”‚  â”‚  â”‚         â”‚  â”‚   âœ…    â”‚  â”‚   âš ï¸    â”‚  â”‚   âŒ    â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  CHECK RESULTS                                                   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ âœ… USERS           â”‚ 20/20 valid â”‚ 0 issues                 â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ âœ… DRIVERS         â”‚ 22/22 valid â”‚ 0 issues                 â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ âœ… RACES           â”‚ 24/24 valid â”‚ 0 issues                 â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ âš ï¸ PREDICTIONS     â”‚ 958/962 valid â”‚ 4 warnings             â”‚â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€ Warning: 4 orphan submissions in prediction_submissionsâ”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ âœ… RESULTS         â”‚ 5/5 valid â”‚ 0 issues                   â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ âŒ SCORES          â”‚ 98/100 valid â”‚ 2 errors                â”‚â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€ Error: Score mismatch for user xyz                     â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚ âœ… STANDINGS       â”‚ 20/20 valid â”‚ 0 issues                 â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.11.3 Check Categories

| Category | Checks Performed |
|----------|------------------|
| **Users** | Required fields, email format, unique team names, admin flags |
| **Drivers** | All 22 drivers present, valid IDs, no duplicates |
| **Races** | All 24 races, valid dates, chronological order |
| **Predictions** | Valid driver IDs, 6 drivers per prediction, user exists |
| **Results** | Valid race ID, 6 unique drivers, driver IDs exist |
| **Scores** | Correct calculation, user exists, race result exists |
| **Standings** | Points sum correctly, no orphan entries |

---

# 7. Database Architecture

## 7.1 Firestore Collections Overview

```
firestore/
â”œâ”€â”€ users/                          # User accounts
â”‚   â””â”€â”€ {userId}/
â”‚       â””â”€â”€ predictions/            # User's race predictions (subcollection)
â”‚           â””â”€â”€ {raceId}/
â”œâ”€â”€ prediction_submissions/         # Flat mirror of predictions (for admin queries)
â”œâ”€â”€ race_results/                   # Official race results
â”œâ”€â”€ scores/                         # Calculated scores per user per race
â”œâ”€â”€ app-settings/                   # Application settings
â”‚   â””â”€â”€ hot-news                    # Hot news configuration
â”œâ”€â”€ admin_configuration/            # Admin settings
â”‚   â””â”€â”€ whatsapp_alerts             # WhatsApp alert config
â”œâ”€â”€ whatsapp_queue/                 # Pending WhatsApp messages
â”œâ”€â”€ whatsapp_alert_history/         # Sent WhatsApp alerts audit
â”œâ”€â”€ email_queue/                    # Pending emails
â”œâ”€â”€ email_logs/                     # Sent email log
â”œâ”€â”€ email_daily_stats/              # Daily email statistics
â”œâ”€â”€ mail/                           # Firebase Extension trigger collection
â”œâ”€â”€ presence/                       # User online status
â”œâ”€â”€ audit_logs/                     # User action audit trail
â”œâ”€â”€ error_logs/                     # Application error tracking
â””â”€â”€ coordination/                   # Claude Code session coordination
    â””â”€â”€ claude-state                # Shared state document
```

## 7.2 Collection: users

### 7.2.1 Document Structure

```typescript
// Path: users/{userId}
// Document ID: Firebase Auth UID

interface UserDocument {
  // Identity
  id: string;                    // Firebase Auth UID
  email: string;                 // User email (unique)
  teamName: string;              // Primary display name (unique)
  secondaryTeamName?: string;    // Optional alternate name

  // Permissions
  isAdmin: boolean;              // Admin flag

  // Security
  mustChangePin: boolean;        // Force PIN reset on login
  badLoginAttempts: number;      // Failed login counter (max 5)

  // Preferences
  emailPreferences: {
    rankingChanges: boolean;     // Notify on rank changes
    raceReminders: boolean;      // Race reminder emails
    newsFeed: boolean;           // Hot news emails
    resultsNotifications: boolean; // Results published emails
  };

  // Timestamps
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

### 7.2.2 Subcollection: predictions

```typescript
// Path: users/{userId}/predictions/{raceId}
// Document ID: Race name with dashes (e.g., "Australian-Grand-Prix")

interface PredictionDocument {
  raceId: string;                // Race identifier
  predictions: string[];         // Array of 6 driver IDs in order
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

// Example:
{
  raceId: "Australian-Grand-Prix",
  predictions: ["verstappen", "hamilton", "norris", "leclerc", "piastri", "russell"],
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

## 7.3 Collection: prediction_submissions

This is a flat collection that mirrors the predictions subcollection for efficient admin queries.

```typescript
// Path: prediction_submissions/{autoId}
// Document ID: Auto-generated

interface PredictionSubmission {
  userId: string;                // User ID reference
  teamId: string;                // Alias for userId
  teamName: string;              // Team name snapshot (denormalized)
  raceId: string;                // Race identifier
  predictions: {                 // Object format (differs from subcollection)
    P1: string;
    P2: string;
    P3: string;
    P4: string;
    P5: string;
    P6: string;
  };
  submittedAt: Timestamp;
}
```

## 7.4 Collection: race_results

```typescript
// Path: race_results/{raceId}
// Document ID: Normalized race ID (e.g., "Australian-Grand-Prix")

interface RaceResultDocument {
  id: string;           // Document ID
  raceId: string;       // Race identifier
  driver1: string;      // P1 driver ID
  driver2: string;      // P2 driver ID
  driver3: string;      // P3 driver ID
  driver4: string;      // P4 driver ID
  driver5: string;      // P5 driver ID
  driver6: string;      // P6 driver ID
  submittedAt: Timestamp;
  submittedBy: string;  // Admin user ID who entered results
}
```

## 7.5 Collection: scores

```typescript
// Path: scores/{raceId}_{userId}
// Document ID: Composite key "{raceId}_{userId}"

interface ScoreDocument {
  id: string;           // Document ID
  userId: string;       // User reference
  oduserId: string;     // Alternate user reference (legacy)
  raceId: string;       // Race reference
  totalPoints: number;  // Calculated score (0-40)
  breakdown: string;    // Human-readable breakdown
  calculatedAt?: Timestamp;
}

// Example:
{
  id: "Australian-Grand-Prix_abc123xyz",
  userId: "abc123xyz",
  oduserId: "abc123xyz",
  raceId: "Australian-Grand-Prix",
  totalPoints: 32,
  breakdown: "Verstappen+5, Hamilton+3, Norris+3, Leclerc+3, Piastri+3, Russell+5, BonusAll6+10"
}
```

## 7.6 Collection: whatsapp_queue

```typescript
// Path: whatsapp_queue/{autoId}
// Document ID: Auto-generated

interface WhatsAppQueueMessage {
  id: string;
  groupName?: string;    // Target group name (e.g., "Prix Six")
  chatId?: string;       // Direct chat ID if known
  message: string;       // Message content
  status: 'PENDING' | 'PROCESSING' | 'SENT' | 'FAILED';
  testMode?: boolean;    // If true, don't actually send
  sentBy: string;        // Admin user ID
  retryCount: number;    // Retry attempts (max 3)
  createdAt: Timestamp;
  processedAt?: Timestamp;
  error?: string;        // Error message if failed
}
```

## 7.7 Collection: coordination

```typescript
// Path: coordination/claude-state
// Document ID: "claude-state" (singleton)

interface ClaudeCoordinationState {
  sessions: {
    [sessionId: string]: {
      name: string;        // "Bob" or "Bill"
      branch: string;      // Git branch
      status: 'active' | 'ended' | 'force-ended';
      startedAt: string;   // ISO timestamp
      lastActivity: string;
      endedAt?: string;
    };
  };
  claimedFiles: {
    [filePath: string]: {
      sessionId: string;
      name: string;
      claimedBy: string;
      branch: string;
      claimedAt: string;
    };
  };
  branches: {
    [branchName: string]: {
      description: string;
      registeredAt: string;
    };
  };
  activityLog: Array<{
    sessionId: string;
    name: string;
    branch: string;
    message: string;
    timestamp: string;
  }>;
  initialisedAt?: string;
}
```

---

# 8. Scoring System

## 8.1 Prix Six Scoring Rules

The Prix Six scoring system rewards accuracy in predicting the top 6 race finishers.

### 8.1.1 Point Values

| Scenario | Points | Description |
|----------|--------|-------------|
| **Exact Position** | +5 | Driver finishes in the exact predicted position |
| **Wrong Position** | +3 | Driver finishes in top 6 but different position |
| **Not in Top 6** | +0 | Driver finishes outside top 6 |
| **All 6 Bonus** | +10 | All 6 predicted drivers finish in top 6 |

### 8.1.2 Maximum Score

```
Maximum per race: 40 points
= (6 drivers Ã— 5 exact) + 10 bonus
= 30 + 10
= 40 points
```

### 8.1.3 Scoring Constants

```typescript
// Location: src/lib/scoring.ts

const PRIX_SIX_SCORING = {
  exactPosition: 5,     // +5 for exact position
  wrongPosition: 3,     // +3 for wrong position in top 6
  bonusAll6: 10,        // +10 if all 6 in top 6
  maxPoints: 40,        // Maximum possible score
};
```

## 8.2 Score Calculation Algorithm

```typescript
// Location: src/lib/scoring.ts

export async function calculateRaceScores(
  firestore: any,
  raceResult: RaceResult
): Promise<{ userId: string; totalPoints: number; breakdown: string }[]> {

  // Extract actual top 6 from race result
  const actualResults = [
    raceResult.driver1,
    raceResult.driver2,
    raceResult.driver3,
    raceResult.driver4,
    raceResult.driver5,
    raceResult.driver6
  ];

  // Normalize race ID for prediction lookup
  const normalizedRaceId = normalizeRaceId(raceResult.raceId);

  // Query all predictions for this race
  const predictionsQuery = query(
    collectionGroup(firestore, 'predictions'),
    where('raceId', '==', normalizedRaceId)
  );
  const predictionsSnapshot = await getDocs(predictionsQuery);

  const scores = [];

  predictionsSnapshot.forEach((predDoc) => {
    const data = predDoc.data();
    const userPredictions = data.predictions; // Array of 6 driver IDs
    const userId = extractUserIdFromPath(predDoc.ref.path);

    let totalPoints = 0;
    let correctCount = 0;
    const breakdownParts = [];

    // Check each prediction
    userPredictions.forEach((driverId, index) => {
      const driverName = getDriverName(driverId);
      const actualPosition = actualResults.indexOf(driverId);

      if (actualPosition === index) {
        // Exact position match
        totalPoints += PRIX_SIX_SCORING.exactPosition;
        correctCount++;
        breakdownParts.push(`${driverName}+5`);
      } else if (actualPosition !== -1) {
        // In top 6 but wrong position
        totalPoints += PRIX_SIX_SCORING.wrongPosition;
        correctCount++;
        breakdownParts.push(`${driverName}+3`);
      } else {
        // Not in top 6
        breakdownParts.push(`${driverName}+0`);
      }
    });

    // Bonus for all 6 correct
    if (correctCount === 6) {
      totalPoints += PRIX_SIX_SCORING.bonusAll6;
      breakdownParts.push(`BonusAll6+10`);
    }

    scores.push({
      userId,
      totalPoints,
      breakdown: breakdownParts.join(', ')
    });
  });

  return scores;
}
```

## 8.3 Race ID Normalization

```typescript
// Location: src/lib/scoring.ts

/**
 * Normalize raceId to match the format used by predictions.
 * Admin results may use "Australian Grand Prix - GP"
 * Predictions use "Australian-Grand-Prix"
 */
function normalizeRaceId(raceId: string): string {
  return raceId
    .replace(/\s*-\s*GP$/i, '')      // Remove " - GP" suffix
    .replace(/\s*-\s*Sprint$/i, '')  // Remove " - Sprint" suffix
    .replace(/\s+/g, '-');            // Replace spaces with dashes
}

// Examples:
// "Australian Grand Prix - GP" â†’ "Australian-Grand-Prix"
// "Chinese Grand Prix - Sprint" â†’ "Chinese-Grand-Prix"
// "Japanese Grand Prix" â†’ "Japanese-Grand-Prix"
```

## 8.4 Scoring Example

```
User's Prediction:  VER, HAM, NOR, LEC, PIA, RUS
Actual Result:      VER, NOR, LEC, PIA, HAM, RUS

Position Analysis:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Slot   â”‚ Predicted  â”‚ Actual     â”‚ Match  â”‚ Points â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ P1     â”‚ VER        â”‚ VER        â”‚ Exact  â”‚ +5     â”‚
â”‚ P2     â”‚ HAM        â”‚ NOR        â”‚ Wrong  â”‚ +3     â”‚
â”‚ P3     â”‚ NOR        â”‚ LEC        â”‚ Wrong  â”‚ +3     â”‚
â”‚ P4     â”‚ LEC        â”‚ PIA        â”‚ Wrong  â”‚ +3     â”‚
â”‚ P5     â”‚ PIA        â”‚ HAM        â”‚ Wrong  â”‚ +3     â”‚
â”‚ P6     â”‚ RUS        â”‚ RUS        â”‚ Exact  â”‚ +5     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚            â”‚ 6/6 in T6  â”‚ Bonus  â”‚ +10    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL  â”‚            â”‚            â”‚        â”‚ 32     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Breakdown: "Verstappen+5, Hamilton+3, Norris+3, Leclerc+3, Piastri+3, Russell+5, BonusAll6+10"
```

---

# 9. Email Notification System

## 9.1 Architecture Overview

The email system uses Microsoft Graph API to send emails through a Microsoft 365 account.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EMAIL SYSTEM ARCHITECTURE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ App Action  â”‚â”€â”€â”€â”€â–¶â”‚           sendEmail()                       â”‚  â”‚
â”‚   â”‚ (e.g.       â”‚     â”‚           lib/email.ts                      â”‚  â”‚
â”‚   â”‚ Results)    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚                            â”‚
â”‚                                           â–¼                            â”‚
â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                       â”‚           Rate Limit Check                  â”‚  â”‚
â”‚                       â”‚           email-tracking.ts                 â”‚  â”‚
â”‚                       â”‚           - 30/day global                   â”‚  â”‚
â”‚                       â”‚           - 5/day per address               â”‚  â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                           â”‚                            â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚              â”‚ Can Send                   â”‚ Rate Limited           â”‚   â”‚
â”‚              â–¼                            â–¼                        â”‚   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚  Microsoft Graph    â”‚     â”‚        email_queue              â”‚  â”‚   â”‚
â”‚   â”‚  API Send           â”‚     â”‚        (Firestore)              â”‚  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚        status: 'pending'        â”‚  â”‚   â”‚
â”‚              â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚              â–¼                                                      â”‚   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚   â”‚
â”‚   â”‚    email_logs       â”‚                                          â”‚   â”‚
â”‚   â”‚    (Firestore)      â”‚                                          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚   â”‚
â”‚                                                                     â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 9.2 Email Types

| Type | Trigger | Template |
|------|---------|----------|
| `welcome` | New user signup | Welcome with login instructions |
| `results` | Race results entered | Results summary with scores |
| `hot_news` | Manual admin send | F1 news content |
| `race_reminder` | Scheduled | Prediction reminder before race |
| `ranking_change` | Score calculation | Rank change notification |

## 9.3 Rate Limiting

```typescript
// Location: src/lib/email-tracking.ts

const DAILY_GLOBAL_LIMIT = 30;      // Max emails per day (entire app)
const DAILY_PER_ADDRESS_LIMIT = 5;  // Max emails per recipient per day
const ADMIN_EMAIL = 'aaron@garcia.ltd'; // Exempt from per-address limit

interface DailyEmailStats {
  date: string;          // YYYY-MM-DD
  totalSent: number;
  emailsSent: EmailLogEntry[];
  summaryEmailSent: boolean;
}

export async function canSendEmail(firestore: any, toEmail: string): Promise<{ canSend: boolean; reason?: string }> {
  const stats = await getDailyStats(firestore);

  // Check global limit
  if (stats.totalSent >= DAILY_GLOBAL_LIMIT) {
    return { canSend: false, reason: `Daily global limit of ${DAILY_GLOBAL_LIMIT} reached` };
  }

  // Check per-address limit (skip for admin)
  if (toEmail.toLowerCase() !== ADMIN_EMAIL.toLowerCase()) {
    const addressCount = stats.emailsSent.filter(
      e => e.toEmail.toLowerCase() === toEmail.toLowerCase()
    ).length;

    if (addressCount >= DAILY_PER_ADDRESS_LIMIT) {
      return { canSend: false, reason: `Daily limit of ${DAILY_PER_ADDRESS_LIMIT} to ${toEmail} reached` };
    }
  }

  return { canSend: true };
}
```

## 9.4 Microsoft Graph Integration

```typescript
// Location: src/lib/email.ts

import { ClientSecretCredential } from '@azure/identity';
import { Client } from '@microsoft/microsoft-graph-client';

// OAuth2 Client Credentials Flow
const credential = new ClientSecretCredential(
  process.env.AZURE_TENANT_ID!,
  process.env.AZURE_CLIENT_ID!,
  process.env.AZURE_CLIENT_SECRET!
);

export async function sendEmail(
  toEmail: string,
  subject: string,
  htmlContent: string,
  teamName?: string
): Promise<{ success: boolean; emailGuid: string }> {

  const emailGuid = generateGuid();

  // Add footer with reference GUID
  const contentWithFooter = `
    ${htmlContent}
    <hr style="margin-top: 30px;">
    <p style="font-size: 11px; color: #666;">
      Reference: ${emailGuid}
    </p>
  `;

  const message = {
    subject,
    body: {
      contentType: 'HTML',
      content: contentWithFooter,
    },
    toRecipients: [
      { emailAddress: { address: toEmail } }
    ],
  };

  // Get access token
  const tokenResponse = await credential.getToken('https://graph.microsoft.com/.default');

  // Create Graph client
  const client = Client.init({
    authProvider: (done) => {
      done(null, tokenResponse.token);
    },
  });

  // Send email
  await client.api('/users/noreply@yourdomain.com/sendMail').post({
    message,
    saveToSentItems: true,
  });

  return { success: true, emailGuid };
}
```

## 9.5 Welcome Email Template

```typescript
export async function sendWelcomeEmail(toEmail: string, teamName: string): Promise<void> {
  const htmlContent = `
    <!DOCTYPE html>
    <html>
    <head>
      <style>
        body { font-family: Arial, sans-serif; }
        .header { background: linear-gradient(135deg, #e10600, #1e1e1e); color: white; padding: 20px; }
        .content { padding: 20px; }
        .cta-button { background: #e10600; color: white; padding: 15px 30px; text-decoration: none; }
      </style>
    </head>
    <body>
      <div class="header">
        <h1>Welcome to Prix Six!</h1>
      </div>
      <div class="content">
        <h2>Hey ${teamName}!</h2>
        <p>Welcome to the Prix Six Fantasy F1 League. You're now part of the competition!</p>
        <p>Here's how to get started:</p>
        <ol>
          <li>Login to your account using your email and 6-digit PIN</li>
          <li>Head to the Predictions page</li>
          <li>Select your top 6 drivers for the next race</li>
          <li>Submit before qualifying starts!</li>
        </ol>
        <p><a href="https://prixsix.com/predictions" class="cta-button">Make Your First Prediction</a></p>
        <p>Good luck!</p>
      </div>
    </body>
    </html>
  `;

  await sendEmail(toEmail, 'Welcome to Prix Six!', htmlContent, teamName);
}
```

---

# 10. WhatsApp Integration System

## 10.1 Architecture Overview

The WhatsApp system consists of two main components:
1. **WhatsApp Manager** (Admin UI) - Configures alerts and sends messages
2. **WhatsApp Worker** (Azure Container) - Processes queue and sends via WhatsApp Web

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHATSAPP SYSTEM ARCHITECTURE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚  â”‚  Admin Panel    â”‚                                                   â”‚
â”‚  â”‚  (WhatsApp      â”‚                                                   â”‚
â”‚  â”‚   Manager Tab)  â”‚                                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚           â”‚                                                             â”‚
â”‚           â”‚ Write message to queue                                     â”‚
â”‚           â–¼                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    FIRESTORE                                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚  whatsapp_queue     â”‚  â”‚  admin_configuration/              â”‚â”‚   â”‚
â”‚  â”‚  â”‚  - status: PENDING  â”‚  â”‚  whatsapp_alerts                   â”‚â”‚   â”‚
â”‚  â”‚  â”‚  - groupName        â”‚  â”‚  - masterEnabled                   â”‚â”‚   â”‚
â”‚  â”‚  â”‚  - message          â”‚  â”‚  - testMode                        â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - alerts: {...}                   â”‚â”‚   â”‚
â”‚  â”‚           â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                                                          â”‚
â”‚              â”‚ Real-time listener (onSnapshot)                         â”‚
â”‚              â–¼                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 AZURE CONTAINER INSTANCE                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚  â”‚  â”‚                 WHATSAPP WORKER                             â”‚â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Queue       â”‚  â”‚ WhatsApp    â”‚  â”‚  Azure Blob Store   â”‚ â”‚â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ Processor   â”‚â”€â–¶â”‚ Client      â”‚â—€â”€â”‚  (Session Persist)  â”‚ â”‚â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚  â”‚                             â”‚                                    â”‚   â”‚
â”‚  â”‚                             â”‚ Puppeteer + Chromium               â”‚   â”‚
â”‚  â”‚                             â–¼                                    â”‚   â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚
â”‚  â”‚                    â”‚  WhatsApp Web   â”‚                          â”‚   â”‚
â”‚  â”‚                    â”‚  (Browser)      â”‚                          â”‚   â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â”‚                             â”‚                                    â”‚   â”‚
â”‚  â”‚                             â”‚ Send to group                      â”‚   â”‚
â”‚  â”‚                             â–¼                                    â”‚   â”‚
â”‚  â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚
â”‚  â”‚                    â”‚  WhatsApp Group â”‚                          â”‚   â”‚
â”‚  â”‚                    â”‚  "Prix Six"     â”‚                          â”‚   â”‚
â”‚  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 10.2 Message Flow

1. Admin enters message in WhatsApp Manager tab
2. Message written to `whatsapp_queue` with status `PENDING`
3. WhatsApp Worker (Azure) listens for new `PENDING` documents
4. Worker marks message as `PROCESSING`
5. Worker sends via WhatsApp Web (Puppeteer)
6. Worker updates status to `SENT` or `FAILED`
7. Entry created in `whatsapp_alert_history`

## 10.3 Alert Types (11 Categories)

```typescript
interface WhatsAppAlertToggles {
  // Race Weekend (3)
  qualifyingReminder: boolean;    // Before qualifying
  raceReminder: boolean;          // Before race
  resultsPublished: boolean;      // After results entered

  // Player Activity (3)
  newPlayerJoined: boolean;       // New signup
  predictionSubmitted: boolean;   // Each prediction (disabled by default)
  latePredictionWarning: boolean; // 1 hour before deadline

  // League Summary (2)
  weeklyStandingsUpdate: boolean; // Weekly summary
  endOfSeasonSummary: boolean;    // Final standings

  // Admin/Manual (3)
  hotNewsPublished: boolean;      // New hot news
  adminAnnouncements: boolean;    // General announcements
  customMessages: boolean;        // Free-form messages
}
```

---

# 11. WhatsApp Worker Service

## 11.1 Service Overview

The WhatsApp Worker is a Node.js service running in an Azure Container Instance that:
- Maintains a WhatsApp Web session via Puppeteer
- Listens for messages in the Firestore queue
- Sends messages to WhatsApp groups
- Persists session to Azure Blob Storage for restart resilience

## 11.2 Directory Structure

```
whatsapp-worker/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # Main entry point
â”‚   â”œâ”€â”€ whatsapp-client.ts    # WhatsApp Web client wrapper
â”‚   â”œâ”€â”€ queue-processor.ts    # Firestore queue listener
â”‚   â”œâ”€â”€ firebase-config.ts    # Firebase Admin init
â”‚   â””â”€â”€ azure-store.ts        # Azure Blob session storage
â”œâ”€â”€ Dockerfile                # Container build instructions
â”œâ”€â”€ package.json              # Dependencies
â””â”€â”€ tsconfig.json             # TypeScript config
```

## 11.3 Main Entry Point (index.ts)

```typescript
// Location: whatsapp-worker/src/index.ts

import express from 'express';
import { WhatsAppClient } from './whatsapp-client';
import { QueueProcessor } from './queue-processor';

const app = express();
const PORT = 3000;

let whatsappClient: WhatsAppClient;
let queueProcessor: QueueProcessor;

// Health check endpoint
app.get('/health', (req, res) => {
  const status = whatsappClient?.getStatus();
  res.json({
    status: 'ok',
    whatsapp: {
      connected: status?.ready,
      awaitingQR: !!status?.qrCode,
    },
  });
});

// Status with groups
app.get('/status', async (req, res) => {
  const status = whatsappClient?.getStatus();
  let groups = [];
  if (status?.ready) {
    groups = await whatsappClient.getGroups();
  }
  res.json({
    whatsapp: { connected: status?.ready, groups: groups.map(g => g.name) },
  });
});

// QR code endpoint (for initial setup)
app.get('/qr', (req, res) => {
  const status = whatsappClient?.getStatus();
  if (!status?.qrCode) {
    res.status(404).json({ error: 'No QR code available' });
    return;
  }
  res.type('text/plain').send(status.qrCode);
});

async function main() {
  console.log('Prix Six WhatsApp Worker Starting...');

  // Start Express server for health checks
  app.listen(PORT);

  // Initialize WhatsApp client
  whatsappClient = new WhatsAppClient();
  await whatsappClient.initialize();

  // Wait for WhatsApp ready
  await waitForReady();

  // Start queue processor
  queueProcessor = new QueueProcessor(whatsappClient);
  queueProcessor.startListening();

  console.log('WhatsApp Worker is running!');
}

main();
```

## 11.4 WhatsApp Client (whatsapp-client.ts)

```typescript
// Location: whatsapp-worker/src/whatsapp-client.ts

import { Client, LocalAuth, RemoteAuth } from 'whatsapp-web.js';
import { AzureBlobStore } from './azure-store';

export class WhatsAppClient {
  private client: Client;
  private isReady = false;
  private qrCodeData: string | null = null;
  private azureStore: AzureBlobStore | null = null;

  constructor() {
    const useAzureStorage = !!process.env.AZURE_STORAGE_CONNECTION_STRING;

    // Auth strategy based on environment
    let authStrategy;
    if (useAzureStorage) {
      // Production: Use RemoteAuth with Azure
      this.azureStore = new AzureBlobStore('prixsix-whatsapp');
      authStrategy = new RemoteAuth({
        clientId: 'prixsix-whatsapp',
        dataPath: '/tmp/.wwebjs_auth',
        store: this.azureStore,
        backupSyncIntervalMs: 300000, // 5 minutes
      });
    } else {
      // Local dev: Use LocalAuth
      authStrategy = new LocalAuth({
        clientId: 'prixsix-whatsapp',
      });
    }

    this.client = new Client({
      authStrategy,
      puppeteer: {
        headless: true,
        args: ['--no-sandbox', '--disable-gpu'],
        executablePath: '/usr/bin/chromium',
      },
    });

    this.setupEventHandlers();
  }

  private setupEventHandlers() {
    this.client.on('qr', (qr) => {
      this.qrCodeData = qr;
      console.log('Scan QR code to authenticate');
    });

    this.client.on('ready', () => {
      this.isReady = true;
      this.qrCodeData = null;
      console.log('WhatsApp client ready');
    });

    this.client.on('remote_session_saved', () => {
      console.log('Session backed up to Azure');
    });
  }

  async sendToGroup(groupName: string, message: string): Promise<boolean> {
    if (!this.isReady) return false;

    const chats = await this.client.getChats();
    const group = chats.find(
      c => c.isGroup && c.name.toLowerCase().includes(groupName.toLowerCase())
    );

    if (!group) {
      console.error(`Group "${groupName}" not found`);
      return false;
    }

    await this.client.sendMessage(group.id._serialized, message, { sendSeen: false });
    return true;
  }

  getStatus() {
    return { ready: this.isReady, qrCode: this.qrCodeData };
  }

  async getGroups() {
    if (!this.isReady) return [];
    const chats = await this.client.getChats();
    return chats.filter(c => c.isGroup).map(c => ({ id: c.id._serialized, name: c.name }));
  }
}
```

## 11.5 Queue Processor (queue-processor.ts)

```typescript
// Location: whatsapp-worker/src/queue-processor.ts

import { Firestore, Timestamp } from 'firebase-admin/firestore';

export class QueueProcessor {
  private db: Firestore;
  private whatsapp: WhatsAppClient;
  private isProcessing = false;
  private unsubscribe: (() => void) | null = null;

  // Rate limiting
  private readonly MIN_DELAY_MS = 5000;  // 5 seconds between messages
  private readonly MAX_RETRIES = 3;

  constructor(whatsapp: WhatsAppClient) {
    this.db = getFirestore();
    this.whatsapp = whatsapp;
  }

  startListening() {
    const queueRef = this.db
      .collection('whatsapp_queue')
      .where('status', '==', 'PENDING')
      .orderBy('createdAt', 'asc');

    this.unsubscribe = queueRef.onSnapshot(async (snapshot) => {
      for (const change of snapshot.docChanges()) {
        if (change.type === 'added') {
          await this.processMessage(change.doc);
        }
      }
    });
  }

  private async processMessage(doc: any) {
    if (this.isProcessing) return;
    this.isProcessing = true;

    const docRef = this.db.collection('whatsapp_queue').doc(doc.id);
    const message = doc.data();

    try {
      // Mark as processing
      await docRef.update({ status: 'PROCESSING', processedAt: Timestamp.now() });

      // Rate limit
      await this.applyRateLimit();

      // Send message
      const success = await this.whatsapp.sendToGroup(message.groupName, message.message);

      if (success) {
        await docRef.update({ status: 'SENT', processedAt: Timestamp.now() });
      } else {
        throw new Error('Send failed');
      }

    } catch (error) {
      const retryCount = (message.retryCount || 0) + 1;

      if (retryCount < this.MAX_RETRIES) {
        await docRef.update({ status: 'PENDING', retryCount, error: error.message });
      } else {
        await docRef.update({ status: 'FAILED', retryCount, error: error.message });
      }
    } finally {
      this.isProcessing = false;
    }
  }

  private async applyRateLimit() {
    await new Promise(resolve => setTimeout(resolve, this.MIN_DELAY_MS));
  }
}
```

## 11.6 Azure Blob Store (azure-store.ts)

```typescript
// Location: whatsapp-worker/src/azure-store.ts

import { BlobServiceClient, ContainerClient } from '@azure/storage-blob';

export class AzureBlobStore {
  private containerClient: ContainerClient;
  private sessionId: string;

  constructor(sessionId: string = 'prixsix-whatsapp') {
    this.sessionId = sessionId;
    const connectionString = process.env.AZURE_STORAGE_CONNECTION_STRING;
    const containerName = process.env.AZURE_STORAGE_CONTAINER || 'whatsapp-session';

    const blobServiceClient = BlobServiceClient.fromConnectionString(connectionString);
    this.containerClient = blobServiceClient.getContainerClient(containerName);
  }

  // Required by RemoteAuth interface
  async sessionExists(options: { session: string }): Promise<boolean> {
    const blobClient = this.containerClient.getBlobClient(`${options.session}/session.zip`);
    return await blobClient.exists();
  }

  // Save session to Azure (called by RemoteAuth after zipping)
  async save(options: { session: string }): Promise<void> {
    const fs = await import('fs');
    const path = await import('path');

    const dataPath = process.env.REMOTE_AUTH_DATA_PATH || '/tmp/.wwebjs_auth';
    const zipPath = path.join(dataPath, `${options.session}.zip`);

    const zipBuffer = fs.readFileSync(zipPath);
    const blobName = `${options.session}/session.zip`;
    const blockBlobClient = this.containerClient.getBlockBlobClient(blobName);

    await blockBlobClient.upload(zipBuffer, zipBuffer.length, {
      blobHTTPHeaders: { blobContentType: 'application/zip' },
    });
  }

  // Extract session from Azure (called by RemoteAuth on startup)
  async extract(options: { session: string }): Promise<string | null> {
    const fs = await import('fs');
    const path = await import('path');

    const blobName = `${options.session}/session.zip`;
    const blobClient = this.containerClient.getBlobClient(blobName);

    if (!await blobClient.exists()) return null;

    const dataPath = process.env.REMOTE_AUTH_DATA_PATH || '/tmp/.wwebjs_auth';
    if (!fs.existsSync(dataPath)) {
      fs.mkdirSync(dataPath, { recursive: true });
    }

    const zipPath = path.join(dataPath, `${options.session}.zip`);
    const downloadResponse = await blobClient.download(0);

    // Stream to buffer
    const chunks = [];
    for await (const chunk of downloadResponse.readableStreamBody!) {
      chunks.push(Buffer.from(chunk));
    }

    fs.writeFileSync(zipPath, Buffer.concat(chunks));
    return zipPath;
  }

  async delete(options: { session: string }): Promise<void> {
    const blobName = `${options.session}/session.zip`;
    const blobClient = this.containerClient.getBlobClient(blobName);
    if (await blobClient.exists()) {
      await blobClient.delete();
    }
  }
}
```

## 11.7 Dockerfile

```dockerfile
# Location: whatsapp-worker/Dockerfile

FROM node:20-bookworm-slim

WORKDIR /app

# Install Chromium and dependencies
RUN apt-get update && apt-get install -y \
    chromium \
    fonts-liberation \
    fonts-noto-color-emoji \
    libasound2 \
    libatk-bridge2.0-0 \
    libatk1.0-0 \
    libcairo2 \
    libcups2 \
    libdbus-1-3 \
    libdrm2 \
    libgbm1 \
    libglib2.0-0 \
    libgtk-3-0 \
    libnspr4 \
    libnss3 \
    libpango-1.0-0 \
    libx11-6 \
    libxcb1 \
    libxcomposite1 \
    libxdamage1 \
    libxext6 \
    libxfixes3 \
    libxkbcommon0 \
    libxrandr2 \
    libxshmfence1 \
    xdg-utils \
    wget \
    ca-certificates \
    --no-install-recommends \
    && rm -rf /var/lib/apt/lists/*

ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true
ENV PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium

# Create non-root user
RUN groupadd -r pptruser && useradd -r -g pptruser pptruser \
    && mkdir -p /home/pptruser \
    && chown -R pptruser:pptruser /home/pptruser /app

COPY package*.json ./
RUN npm ci --only=production

COPY --chown=pptruser:pptruser . .
RUN npm run build

USER pptruser

EXPOSE 3000

HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
    CMD wget --spider http://localhost:3000/health || exit 1

CMD ["node", "dist/index.js"]
```

## 11.8 Azure Deployment

### 11.8.1 Required Azure Resources

| Resource | Purpose |
|----------|---------|
| **Azure Container Registry** | Store Docker image |
| **Azure Container Instance** | Run the worker |
| **Azure Blob Storage** | Persist WhatsApp session |

### 11.8.2 Environment Variables

```bash
# Firestore
GOOGLE_APPLICATION_CREDENTIALS=/app/service-account.json

# Azure Blob Storage
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=...
AZURE_STORAGE_CONTAINER=whatsapp-session

# Optional
PORT=3000
```

### 11.8.3 Deployment Commands

```bash
# Build and push Docker image
docker build -t prixsix-whatsapp-worker .
docker tag prixsix-whatsapp-worker <registry>.azurecr.io/prixsix-whatsapp-worker:latest
docker push <registry>.azurecr.io/prixsix-whatsapp-worker:latest

# Deploy to Azure Container Instance
az container create \
  --name prixsix-whatsapp-worker \
  --resource-group PrixSix \
  --image <registry>.azurecr.io/prixsix-whatsapp-worker:latest \
  --ports 3000 \
  --environment-variables \
    AZURE_STORAGE_CONNECTION_STRING="<connection-string>" \
  --restart-policy Always
```

---

# 12. Consistency Checker

## 12.1 Overview

The Consistency Checker (CC) is a comprehensive data validation tool that verifies integrity across all Firestore collections. It identifies issues like missing references, invalid data formats, calculation mismatches, and orphan records.

## 12.2 Check Categories (7 Total)

| Category | What It Checks | Total Expected |
|----------|----------------|----------------|
| **Users** | Required fields, email format, unique team names | ~20 |
| **Drivers** | All F1 drivers present, valid IDs, no duplicates | 22 |
| **Races** | All races in calendar, valid dates, chronological order | 24 |
| **Predictions** | Valid driver IDs, 6 drivers per prediction, user exists | Variable |
| **Results** | Valid race ID, 6 unique drivers, driver IDs exist | Variable |
| **Scores** | Correct calculation per Prix Six rules, references valid | Variable |
| **Standings** | Points sum correctly, no orphan entries | ~20 |

## 12.3 Issue Severity Levels

```typescript
export type IssueSeverity = 'error' | 'warning';
export type CheckStatus = 'pass' | 'warning' | 'error';

export interface Issue {
  severity: IssueSeverity;
  entity: string;       // Which entity has the issue
  field?: string;       // Which field is problematic
  message: string;      // Human-readable description
  details?: Record<string, unknown>; // Additional context
}
```

## 12.4 Correlation ID Format

Each consistency check run generates a unique correlation ID for tracking:

```typescript
// Format: cc_{timestamp}_{random}
// Example: cc_1768954664712_1u8qrk

export function generateConsistencyCorrelationId(): string {
  const timestamp = Date.now();
  const random = Math.random().toString(36).substring(2, 8);
  return `cc_${timestamp}_${random}`;
}
```

## 12.5 User Validation

```typescript
export function checkUsers(users: UserData[]): CheckResult {
  const issues: Issue[] = [];
  const seenTeamNames = new Map<string, string>();

  for (const user of users) {
    // Required field checks
    if (!user.id) {
      issues.push({ severity: 'error', entity: `User ${user.email}`, field: 'id', message: 'Missing id' });
    }

    if (!user.email) {
      issues.push({ severity: 'error', entity: `User ${user.id}`, field: 'email', message: 'Missing email' });
    } else if (!EMAIL_REGEX.test(user.email)) {
      issues.push({ severity: 'warning', entity: `User ${user.id}`, field: 'email', message: 'Invalid email format' });
    }

    if (!user.teamName) {
      issues.push({ severity: 'error', entity: `User ${user.id}`, field: 'teamName', message: 'Missing teamName' });
    }

    // Uniqueness checks
    const existingUser = seenTeamNames.get(user.teamName.toLowerCase());
    if (existingUser && existingUser !== user.id) {
      issues.push({
        severity: 'error',
        entity: `User ${user.id}`,
        field: 'teamName',
        message: `Duplicate teamName "${user.teamName}" also used by ${existingUser}`
      });
    }
    seenTeamNames.set(user.teamName.toLowerCase(), user.id);
  }

  return { category: 'users', status: getStatus(issues), total: users.length, valid: validCount, issues };
}
```

## 12.6 Prediction Validation

```typescript
export function checkPredictions(
  predictions: PredictionData[],
  users: UserData[],
  predictionSubmissions: PredictionData[] = []
): CheckResult {
  const validDriverIds = getValidDriverIds();  // Set of 22 driver IDs
  const validRaceIds = getValidRaceIds();      // Set of 24 race IDs
  const userIds = new Set(users.map(u => u.id));

  for (const pred of predictions) {
    // Check user exists
    const userId = pred.userId || pred.oduserId || pred.teamId;
    if (!userIds.has(userId)) {
      issues.push({ severity: 'error', entity: `Prediction ${pred.id}`, message: 'Invalid userId' });
    }

    // Check race exists
    if (!validRaceIds.has(pred.raceId)) {
      issues.push({ severity: 'warning', entity: `Prediction ${pred.id}`, message: 'Unknown raceId' });
    }

    // Check 6 valid unique drivers
    const drivers = extractDriverArray(pred.predictions);
    if (drivers.length !== 6) {
      issues.push({ severity: 'error', message: `Expected 6 drivers, found ${drivers.length}` });
    }

    for (const driverId of drivers) {
      if (!validDriverIds.has(driverId)) {
        issues.push({ severity: 'error', message: `Invalid driver ID: ${driverId}` });
      }
    }

    // Check for duplicates
    const seenDrivers = new Set();
    for (const d of drivers) {
      if (seenDrivers.has(d)) {
        issues.push({ severity: 'error', message: `Duplicate driver: ${d}` });
      }
      seenDrivers.add(d);
    }
  }

  // Cross-check: predictions vs prediction_submissions
  // Warn if mismatch between subcollection and flat collection
}
```

## 12.7 Score Calculation Verification

The consistency checker independently recalculates scores to verify stored values:

```typescript
function calculateExpectedScore(predictedDrivers: string[], actualTop6: string[]): { points: number; correctCount: number } {
  let points = 0;
  let correctCount = 0;

  for (let i = 0; i < predictedDrivers.length; i++) {
    const driver = predictedDrivers[i];
    const actualIndex = actualTop6.indexOf(driver);

    if (actualIndex === i) {
      // Exact position match
      points += 5;
      correctCount++;
    } else if (actualIndex !== -1) {
      // In top 6 but wrong position
      points += 3;
      correctCount++;
    }
  }

  // Bonus for all 6 correct
  if (correctCount === 6) {
    points += 10;
  }

  return { points, correctCount };
}

export function checkScores(scores, raceResults, predictions, users): CheckResult {
  for (const score of scores) {
    // Find corresponding prediction and result
    const prediction = findPrediction(score.userId, score.raceId);
    const result = findResult(score.raceId);

    if (prediction && result) {
      const expected = calculateExpectedScore(
        prediction.drivers,
        [result.driver1, result.driver2, result.driver3, result.driver4, result.driver5, result.driver6]
      );

      if (expected.points !== score.totalPoints) {
        issues.push({
          severity: 'error',
          entity: `Score ${score.id}`,
          field: 'totalPoints',
          message: `Score calculation mismatch: stored ${score.totalPoints}, expected ${expected.points}`,
          details: { stored: score.totalPoints, expected: expected.points }
        });
      }
    }
  }
}
```

## 12.8 Race ID Normalization

A common source of issues is mismatched race ID formats:

```typescript
/**
 * Normalize a race name to the ID format
 * "Australian Grand Prix - GP" â†’ "australian-grand-prix"
 * "Chinese Grand Prix - Sprint" â†’ "chinese-grand-prix"
 */
export function normalizeRaceId(raceName: string): string {
  return raceName
    .replace(/\s*-\s*GP$/i, '')      // Remove " - GP" suffix
    .replace(/\s*-\s*Sprint$/i, '')  // Remove " - Sprint" suffix
    .replace(/\s+/g, '-')            // Replace spaces with dashes
    .toLowerCase();                   // Lowercase
}
```

## 12.9 Summary Generation

```typescript
export interface ConsistencyCheckSummary {
  correlationId: string;      // e.g., "cc_1768954664712_1u8qrk"
  timestamp: Date;
  results: CheckResult[];     // Array of 7 check results
  totalChecks: number;        // 7
  passed: number;             // Count of passed categories
  warnings: number;           // Count of warning categories
  errors: number;             // Count of error categories
}

export function generateSummary(results: CheckResult[]): ConsistencyCheckSummary {
  let passed = 0, warnings = 0, errors = 0;

  for (const result of results) {
    if (result.status === 'pass') passed++;
    else if (result.status === 'warning') warnings++;
    else if (result.status === 'error') errors++;
  }

  return {
    correlationId: generateConsistencyCorrelationId(),
    timestamp: new Date(),
    results,
    totalChecks: results.length,
    passed,
    warnings,
    errors
  };
}
```

---

# 13. Audit System

## 13.1 Overview

The audit system tracks all significant user actions throughout the application, providing a complete activity trail for debugging and accountability.

## 13.2 Correlation ID Management

Each browser session gets a unique correlation ID that links all actions together:

```typescript
// Location: src/lib/audit.ts

let sessionCorrelationId: string | null = null;

function generateGuid(): string {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
    const r = Math.random() * 16 | 0;
    const v = c === 'x' ? r : (r & 0x3 | 0x8);
    return v.toString(16);
  });
}

/**
 * Gets the current session's correlation ID, generating one if needed.
 */
export function getCorrelationId(): string {
  if (!sessionCorrelationId) {
    sessionCorrelationId = generateGuid();
  }
  return sessionCorrelationId;
}
```

## 13.3 Audit Log Entry Structure

```typescript
// Collection: audit_logs

interface AuditLogEntry {
  id: string;              // Auto-generated document ID
  userId: string;          // Firebase Auth UID of acting user
  action: string;          // Action type identifier
  details: object;         // Action-specific metadata
  correlationId: string;   // Session correlation ID
  timestamp: Timestamp;    // Server timestamp
}
```

## 13.4 Audit Event Logging

```typescript
/**
 * Logs an audit event to Firestore.
 * This is a fire-and-forget operation (non-blocking).
 */
export async function logAuditEvent(
  firestore: any,
  userId: string | undefined,
  action: string,
  details: object
): Promise<void> {
  if (!userId) return;

  const auditLogRef = collection(firestore, 'audit_logs');
  const logData = {
    userId,
    action,
    details,
    correlationId: getCorrelationId(),
    timestamp: serverTimestamp(),
  };

  // Non-blocking add
  addDocumentNonBlocking(auditLogRef, logData);
}
```

## 13.5 Automatic Navigation Logging

The `useAuditNavigation` hook automatically logs all page navigations:

```typescript
/**
 * A client-side hook to automatically log page navigation events.
 */
export function useAuditNavigation(): void {
  const pathname = usePathname();
  const { firebaseUser } = useAuth();
  const firestore = useFirestore();
  const initialLogDone = useRef(false);

  useEffect(() => {
    // Log initial page load
    if (firebaseUser && firestore && !initialLogDone.current) {
      logAuditEvent(firestore, firebaseUser.uid, 'navigate', {
        path: pathname,
        initial_load: true
      });
      initialLogDone.current = true;
    }
  }, [firebaseUser, firestore, pathname]);

  useEffect(() => {
    // Log subsequent navigation
    if (firebaseUser && firestore && initialLogDone.current) {
      logAuditEvent(firestore, firebaseUser.uid, 'navigate', {
        path: pathname
      });
    }
  }, [pathname, firebaseUser, firestore]);
}
```

## 13.6 Common Action Types

| Action Type | Trigger | Details Logged |
|-------------|---------|----------------|
| `navigate` | Page change | `{ path: string, initial_load?: boolean }` |
| `login` | User login | `{ success: boolean }` |
| `signup` | New registration | `{ email: string, teamName: string }` |
| `prediction_submitted` | Submit prediction | `{ raceId: string, drivers: string[] }` |
| `admin_action` | Admin operation | `{ action: string, target?: string }` |
| `email_sent` | Email dispatched | `{ type: string, recipient: string }` |
| `settings_changed` | Profile update | `{ field: string, oldValue?, newValue? }` |

## 13.7 Error Logging

```typescript
// Collection: error_logs

interface ErrorLogEntry {
  id: string;
  correlationId: string;     // Links to audit trail
  type: string;              // Error category
  error: string;             // Error message
  stack: string;             // Stack trace
  context: {
    url: string;             // Page URL
    userAgent: string;       // Browser info
    userId?: string;         // If authenticated
    action?: string;         // What was being attempted
  };
  timestamp: Timestamp;
  createdAt: Timestamp;
}
```

## 13.8 Permission Error Handling

Permission errors are logged to console only (to avoid circular Firestore errors):

```typescript
export function logPermissionError(
  firestore: any,
  userId: string | undefined,
  error: FirestorePermissionError
): void {
  // Only log to console to avoid circular permission errors
  console.error('Permission error:', {
    userId,
    message: error.message,
    path: error.request?.path,
    method: error.request?.method,
  });
}
```

---

# 14. Claude Coordination System

## 14.1 Overview

The Claude Coordination System enables multiple Claude Code sessions to work on the same codebase without conflicts. It uses a shared Firestore document to track active sessions, claimed files, and activity.

## 14.2 Session Naming Convention

Sessions are assigned friendly names based on order of check-in:
- **First session:** Bob
- **Second session:** Bill
- **Third+ sessions:** Guest-3, Guest-4, etc.

## 14.3 Firestore Document Structure

```typescript
// Path: coordination/claude-state
// Single document for all coordination state

interface ClaudeCoordinationState {
  sessions: {
    [sessionId: string]: {
      name: string;         // "Bob", "Bill", "Guest-3"
      branch: string;       // Git branch name
      status: 'active' | 'ended' | 'force-ended';
      startedAt: string;    // ISO timestamp
      lastActivity: string; // ISO timestamp
      endedAt?: string;     // ISO timestamp
    };
  };

  claimedFiles: {
    [filePath: string]: {
      sessionId: string;
      name: string;         // "Bob" or "Bill"
      claimedBy: string;    // Same as sessionId
      branch: string;
      claimedAt: string;    // ISO timestamp
    };
  };

  branches: {
    [branchName: string]: {
      description: string;
      registeredAt: string;
    };
  };

  activityLog: Array<{
    sessionId: string;
    name: string;
    branch: string;
    message: string;
    timestamp: string;
  }>;

  initialisedAt?: string;
}
```

## 14.4 Available Commands

| Command | Usage | Description |
|---------|-------|-------------|
| `checkin` | `node claude-sync.js checkin` | Register session, get Bob/Bill name |
| `checkout` | `node claude-sync.js checkout` | End session, release all files |
| `checkout --force` | `node claude-sync.js checkout --force` | Force-end all sessions on branch |
| `read` | `node claude-sync.js read` | Display current state |
| `write` | `node claude-sync.js write "message"` | Log activity |
| `claim` | `node claude-sync.js claim /path/` | Claim file ownership |
| `release` | `node claude-sync.js release /path/` | Release file ownership |
| `register` | `node claude-sync.js register "description"` | Register branch |
| `init` | `node claude-sync.js init` | Initialize fresh state |

## 14.5 Check-In Process

```typescript
async function cmdCheckin() {
  const state = await getState();
  const branch = getCurrentBranch();
  const now = new Date().toISOString();

  // Generate unique session ID
  const sessionId = `session-${Date.now()}`;

  // Assign name based on active sessions
  const name = assignName(state.sessions, sessionId);

  // Register the session
  state.sessions[sessionId] = {
    name,
    branch,
    status: 'active',
    startedAt: now,
    lastActivity: now
  };

  // Log the check-in
  state.activityLog.push({
    sessionId,
    name,
    branch,
    message: `${name} checked in on branch '${branch}'`,
    timestamp: now
  });

  await saveState(state);

  console.log('='.repeat(60));
  console.log(`YOU ARE: ${name}`);
  console.log('='.repeat(60));
  console.log(`Session ID: ${sessionId}`);
  console.log(`Branch: ${branch}`);
}
```

## 14.6 File Claiming (NO-TOUCH ZONES)

When a session claims a file, other sessions cannot modify it:

```typescript
async function cmdClaim(filePath) {
  const state = await getState();
  const existing = state.claimedFiles[filePath];

  // Check if already claimed by someone else
  if (existing && existing.sessionId !== mySessionId) {
    console.error('='.repeat(60));
    console.error(`ERROR: ${filePath} is already claimed!`);
    console.error(`Claimed by: ${existing.name}`);
    console.error(`Since: ${formatTime(existing.claimedAt)}`);
    console.error('This is a NO-TOUCH ZONE. Ask the user before modifying.');
    console.error('='.repeat(60));
    process.exit(1);
  }

  // Claim the file
  state.claimedFiles[filePath] = {
    sessionId: mySessionId,
    name: myName,
    claimedBy: mySessionId,
    branch,
    claimedAt: now
  };

  await saveState(state);
  console.log(`${myName}> Claimed: ${filePath}`);
}
```

## 14.7 Read State Output

```
============================================================
CLAUDE CODE COORDINATION STATE
============================================================
Your branch: main
Timestamp: 21/01/2026, 14:30

ACTIVE SESSIONS:
----------------------------------------
  Bob <-- YOU?
    Branch: main
    Started: 21/01/2026, 14:00
    Last activity: 21/01/2026, 14:25

CLAIMED FILES (NO-TOUCH ZONES):
----------------------------------------
  /src/components/Predictions.tsx
    Claimed by: Bob
    Since: 21/01/2026, 14:10

REGISTERED BRANCHES:
----------------------------------------
  main: Production branch
  feature/whatsapp: WhatsApp integration

RECENT ACTIVITY (last 10):
----------------------------------------
  [21/01/2026, 14:25] Bob: Fixed prediction submission bug
  [21/01/2026, 14:10] Bob: Claimed: /src/components/Predictions.tsx
  [21/01/2026, 14:00] Bob: Bob checked in on branch 'main'

============================================================
```

## 14.8 Session Check-Out

```typescript
async function cmdCheckout() {
  const state = await getState();
  const sessionEntry = findActiveSession(state, branch);

  if (!sessionEntry) {
    console.log('No active session found on this branch.');
    return;
  }

  const [sessionId, session] = sessionEntry;
  const name = session.name;

  // Mark session as ended
  state.sessions[sessionId].status = 'ended';
  state.sessions[sessionId].endedAt = now;

  // Release all claimed files
  const releasedFiles = [];
  for (const [filePath, claim] of Object.entries(state.claimedFiles)) {
    if (claim.sessionId === sessionId) {
      releasedFiles.push(filePath);
      delete state.claimedFiles[filePath];
    }
  }

  // Log checkout
  state.activityLog.push({
    sessionId,
    name,
    message: `${name} checked out. Released ${releasedFiles.length} file(s).`,
    timestamp: now
  });

  await saveState(state);

  console.log('='.repeat(60));
  console.log(`${name} CHECKED OUT`);
  console.log(`Released files: ${releasedFiles.join(', ')}`);
  console.log('='.repeat(60));
}
```

---

# 15. ID Conventions and Data Standards

## 15.1 ID Format Summary

| Entity | ID Format | Example | Location |
|--------|-----------|---------|----------|
| **User** | Firebase Auth UID | `abc123xyz789` | `users/{uid}` |
| **Driver** | Lowercase name | `verstappen` | In-code constant |
| **Race** | Name with dashes | `Australian-Grand-Prix` | In-code constant |
| **Prediction** | Race ID (in subcollection) | `Australian-Grand-Prix` | `users/{uid}/predictions/{raceId}` |
| **Submission** | Auto-generated | `abc123...` | `prediction_submissions/{autoId}` |
| **Score** | Composite | `Australian-Grand-Prix_abc123xyz` | `scores/{raceId}_{userId}` |
| **Result** | Normalized race ID | `Australian-Grand-Prix` | `race_results/{raceId}` |
| **Audit Log** | Auto-generated | `abc123...` | `audit_logs/{autoId}` |
| **Email Log** | Auto-generated | `abc123...` | `email_logs/{autoId}` |
| **WhatsApp Queue** | Auto-generated | `abc123...` | `whatsapp_queue/{autoId}` |
| **Correlation ID** | Timestamped GUID | `cc_1768954664712_1u8qrk` | CC output |
| **Email GUID** | Standard GUID | `550e8400-e29b-41d4-a716-446655440000` | Email footer |
| **Session ID** | Timestamped | `session-1768954664712` | Claude coordination |

## 15.2 Race ID Normalization Rules

```typescript
// Input: "Australian Grand Prix" â†’ Output: "Australian-Grand-Prix"
// Input: "Australian Grand Prix - GP" â†’ Output: "Australian-Grand-Prix"
// Input: "Chinese Grand Prix - Sprint" â†’ Output: "Chinese-Grand-Prix"

function normalizeRaceId(raceName: string): string {
  return raceName
    .replace(/\s*-\s*GP$/i, '')      // Remove " - GP" suffix
    .replace(/\s*-\s*Sprint$/i, '')  // Remove " - Sprint" suffix
    .replace(/\s+/g, '-');            // Replace spaces with dashes
}
```

## 15.3 Case Sensitivity

**IMPORTANT:** Race IDs use mixed case with dashes. Always verify ID format before matching.

| Usage | Format | Example |
|-------|--------|---------|
| Race Schedule (code) | Title Case | `"Australian Grand Prix"` |
| Predictions (Firestore) | Dash-separated | `"Australian-Grand-Prix"` |
| Results (Firestore) | Dash-separated | `"Australian-Grand-Prix"` |
| Scores (Firestore) | Composite | `"Australian-Grand-Prix_userId"` |

## 15.4 Timestamp Formats

| Context | Format | Example |
|---------|--------|---------|
| Firestore | `Timestamp` object | `Timestamp.fromDate(new Date())` |
| ISO String | ISO 8601 | `"2026-01-21T14:30:00.000Z"` |
| Display (UK) | Localized | `"21/01/2026, 14:30"` |
| Date only | YYYY-MM-DD | `"2026-01-21"` |

## 15.5 Protected Records

These records should NEVER be modified without explicit approval:

```typescript
const PROTECTED_EMAILS = [
  'aaron@garcia.ltd',           // Primary admin
  'aaron.garcia@hotmail.co.uk'  // Secondary admin
];
```

## 15.6 Data Types

| Field Type | TypeScript | Firestore | Notes |
|------------|------------|-----------|-------|
| ID | `string` | string | Always string, never number |
| Email | `string` | string | Lowercase for comparison |
| Points | `number` | number | Integer 0-40 |
| Boolean | `boolean` | boolean | true/false |
| Timestamp | `Timestamp` | timestamp | Firestore Timestamp |
| Array | `string[]` | array | e.g., predictions |
| Object | `Record<string, T>` | map | e.g., emailPreferences |

---

# 16. Security Architecture

## 16.1 Authentication Security

| Feature | Implementation |
|---------|----------------|
| **PIN Storage** | Stored as Firebase Auth password (hashed) |
| **PIN Length** | Exactly 6 digits |
| **Lockout** | After 5 failed attempts |
| **Force Reset** | Admin can set `mustChangePin: true` |
| **Session** | Firebase Auth manages tokens |

## 16.2 Firestore Security Rules

```javascript
// firestore.rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Users collection
    match /users/{userId} {
      // Users can read/write their own document
      allow read, write: if request.auth != null && request.auth.uid == userId;

      // Predictions subcollection
      match /predictions/{predictionId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // Admin-only collections
    match /race_results/{doc} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    match /admin_configuration/{doc} {
      allow read, write: if isAdmin();
    }

    // Read-only for authenticated users
    match /scores/{doc} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    match /prediction_submissions/{doc} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if isAdmin();
    }

    // Helper function
    function isAdmin() {
      return request.auth != null &&
             get(/databases/$(database)/documents/users/$(request.auth.uid)).data.isAdmin == true;
    }
  }
}
```

## 16.3 API Security

| Endpoint | Protection | Method |
|----------|------------|--------|
| `/api/admin/*` | Admin check | Firestore `isAdmin` field |
| `/api/predictions/*` | Auth required | Firebase Auth token |
| Client actions | Firestore rules | Direct writes validated |

## 16.4 Rate Limiting

| Limit | Value | Purpose |
|-------|-------|---------|
| Email Global | 30/day | Prevent spam |
| Email Per-Address | 5/day | Prevent harassment |
| WhatsApp | 5 sec between | Avoid bans |
| Failed Logins | 5 attempts | Brute force protection |

## 16.5 Secrets Management

| Secret | Storage | Never In |
|--------|---------|----------|
| Firebase Service Account | Local file | Git |
| Azure Connection String | Environment variable | Git |
| Microsoft Graph Credentials | Environment variable | Git |
| Genkit API Key | Environment variable | Git |

---

# 17. Deployment Architecture

## 17.1 Firebase Deployment

```
Firebase Project: studio-6033436327-281b1
Region: europe-west4
Hosting URL: https://prixsix--studio-6033436327-281b1.europe-west4.hosted.app
```

### 17.1.1 Deploy Commands

```bash
# Build the Next.js app
npm run build

# Deploy to Firebase
firebase deploy

# Deploy only hosting
firebase deploy --only hosting

# Deploy only Firestore rules
firebase deploy --only firestore:rules
```

## 17.2 Azure WhatsApp Worker

### 17.2.1 Infrastructure

```
Resource Group: PrixSix
Container Registry: prixsixacr.azurecr.io
Container Instance: prixsix-whatsapp-worker
Storage Account: prixsixstorage
Blob Container: whatsapp-session
```

### 17.2.2 Deployment Steps

```bash
# 1. Build Docker image
docker build -t prixsix-whatsapp-worker ./whatsapp-worker

# 2. Tag for registry
docker tag prixsix-whatsapp-worker prixsixacr.azurecr.io/prixsix-whatsapp-worker:latest

# 3. Login to Azure Container Registry
az acr login --name prixsixacr

# 4. Push image
docker push prixsixacr.azurecr.io/prixsix-whatsapp-worker:latest

# 5. Restart container instance
az container restart --name prixsix-whatsapp-worker --resource-group PrixSix
```

## 17.3 Environment Variables

### 17.3.1 Next.js App (Firebase Hosting)

```bash
# Firebase (automatic in Firebase environment)
FIREBASE_PROJECT_ID=studio-6033436327-281b1

# Microsoft Graph (for email)
AZURE_TENANT_ID=<tenant-id>
AZURE_CLIENT_ID=<client-id>
AZURE_CLIENT_SECRET=<client-secret>

# Genkit AI
GOOGLE_GENAI_API_KEY=<api-key>
```

### 17.3.2 WhatsApp Worker (Azure Container)

```bash
# Firestore access
GOOGLE_APPLICATION_CREDENTIALS=/app/service-account.json

# Azure Storage (session persistence)
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=prixsixstorage;...
AZURE_STORAGE_CONTAINER=whatsapp-session

# Server
PORT=3000
```

## 17.4 Git Workflow

```
Branches:
  main     â†’ Production (deploys automatically)
  develop  â†’ Integration (no deploy)
  feature/ â†’ Feature work (no deploy)

Rules:
  - Never commit directly to main
  - Always branch from develop
  - Squash merge to main when ready
  - Bump version in package.json before merge
```

---

# 18. API Reference

## 18.1 Admin APIs

### 18.1.1 POST /api/admin/update-scores

Updates scores for a race after results are entered.

**Request:**
```typescript
interface UpdateScoresRequest {
  raceId: string;
  results: {
    driver1: string;
    driver2: string;
    driver3: string;
    driver4: string;
    driver5: string;
    driver6: string;
  };
  sendEmails?: boolean;
  sendWhatsApp?: boolean;
}
```

**Response:**
```typescript
interface UpdateScoresResponse {
  success: boolean;
  scoresUpdated: number;
  scores: Array<{
    teamName: string;
    prediction: string;
    points: number;
  }>;
  standings: Array<{
    rank: number;
    teamName: string;
    totalPoints: number;
  }>;
}
```

### 18.1.2 POST /api/admin/send-hot-news

Sends hot news email to all users with notifications enabled.

**Request:**
```typescript
interface SendHotNewsRequest {
  content: string;
  subject?: string;
}
```

### 18.1.3 GET /api/admin/consistency-check

Runs the consistency checker and returns results.

**Response:**
```typescript
interface ConsistencyCheckResponse {
  correlationId: string;
  timestamp: string;
  results: CheckResult[];
  totalChecks: number;
  passed: number;
  warnings: number;
  errors: number;
}
```

## 18.2 User APIs

### 18.2.1 POST /api/predictions/submit

Submits a race prediction.

**Request:**
```typescript
interface SubmitPredictionRequest {
  raceId: string;
  predictions: string[];  // Array of 6 driver IDs
}
```

### 18.2.2 GET /api/user/standings

Gets current league standings.

**Response:**
```typescript
interface StandingsResponse {
  standings: Array<{
    rank: number;
    teamName: string;
    totalPoints: number;
    racesCompleted: number;
  }>;
  userRank: number;
  userPoints: number;
}
```

## 18.3 AI APIs (Genkit)

### 18.3.1 POST /api/genkit/hot-news

Generates F1 news using Gemini AI.

**Request:**
```typescript
interface GenerateHotNewsRequest {
  topic?: string;
  style?: 'breaking' | 'analysis' | 'preview';
}
```

**Response:**
```typescript
interface GenerateHotNewsResponse {
  content: string;
  generatedAt: string;
}
```

## 18.4 WhatsApp Worker APIs

### 18.4.1 GET /health

Health check endpoint.

**Response:**
```json
{
  "status": "ok",
  "whatsapp": {
    "connected": true,
    "awaitingQR": false
  }
}
```

### 18.4.2 GET /status

Detailed status with available groups.

**Response:**
```json
{
  "whatsapp": {
    "connected": true,
    "groups": ["Prix Six", "Test Group"]
  }
}
```

### 18.4.3 GET /qr

Returns QR code for WhatsApp authentication (during initial setup).

---

# Appendix A: File Structure

```
E:\GoogleDrive\Papers\03-PrixSix\03.Current\
â”œâ”€â”€ app/                           # Next.js application
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/                   # App Router pages
â”‚   â”‚   â”‚   â”œâ”€â”€ (app)/             # Authenticated pages
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ admin/         # Admin dashboard
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ _components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ predictions/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ standings/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ (auth)/            # Auth pages
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ forgot-pin/
â”‚   â”‚   â”‚   â””â”€â”€ api/               # API routes
â”‚   â”‚   â”œâ”€â”€ components/            # React components
â”‚   â”‚   â”œâ”€â”€ firebase/              # Firebase config
â”‚   â”‚   â”œâ”€â”€ lib/                   # Utility modules
â”‚   â”‚   â”‚   â”œâ”€â”€ audit.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ consistency.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ data.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ email.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ email-tracking.ts
â”‚   â”‚   â”‚   â””â”€â”€ scoring.ts
â”‚   â”‚   â””â”€â”€ ai/                    # Genkit AI flows
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ firebase.json
â”œâ”€â”€ whatsapp-worker/               # Azure WhatsApp service
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ whatsapp-client.ts
â”‚   â”‚   â”œâ”€â”€ queue-processor.ts
â”‚   â”‚   â””â”€â”€ azure-store.ts
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ docs/                          # Documentation
â”‚   â”œâ”€â”€ PRIX_SIX_HLD_COMPLETE.md   # This document
â”‚   â””â”€â”€ PRIX_SIX_ER_DIAGRAM.md
â”œâ”€â”€ claude-sync.js                 # Claude coordination script
â”œâ”€â”€ service-account.json           # Firebase credentials (not in git)
â”œâ”€â”€ CLAUDE.md                      # Project brief for Claude
â””â”€â”€ CHANGELOG.md                   # Version history
```

---

# Appendix B: Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.10.0 | January 2026 | WhatsApp Alert Control Panel, 11 alert types |
| 1.9.x | January 2026 | WhatsApp integration, Azure deployment |
| 1.8.x | December 2025 | Hot News with Gemini AI |
| 1.7.x | December 2025 | Email notifications via Microsoft Graph |
| 1.6.x | November 2025 | Audit logging system |
| 1.5.x | November 2025 | Consistency checker |
| 1.4.x | October 2025 | Admin dashboard expansion |
| 1.3.x | September 2025 | Scoring system refinements |
| 1.2.x | August 2025 | User registration and profiles |
| 1.1.x | July 2025 | Prediction system |
| 1.0.0 | June 2025 | Initial release |

---

**End of Document**

*Prix Six - Comprehensive High-Level Design Document*
*Version 1.10.0 - January 2026*
*Total Sections: 18 + 2 Appendices*

